<!DOCTYPE html>
<html>
<head>
    <title>You shouldn't have been to this place</title>
    <style>
    .correctAnswer {
        color: green;
    }
    </style>
    </script>
    
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    
    <!-- qlib.js -->
    <script type="text/javascript" src="https://olm.vn/js/qlib/qlib2018.11.min.js"></script>
    
    <!-- kas.js -->
    <script>
    var p = {};
    
    (function(){var n=this,t=n._,r={},e=Array.prototype,u=Object.prototype,i=Function.prototype,a=e.push,o=e.slice,c=e.concat,l=u.toString,f=u.hasOwnProperty,s=e.forEach,p=e.map,h=e.reduce,v=e.reduceRight,g=e.filter,d=e.every,m=e.some,y=e.indexOf,b=e.lastIndexOf,x=Array.isArray,w=Object.keys,_=i.bind,j=function(n){return n instanceof j?n:this instanceof j?(this._wrapped=n,void 0):new j(n)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=j),exports._=j):n._=j,j.VERSION="1.5.2";var A=j.each=j.forEach=function(n,t,e){if(null!=n)if(s&&n.forEach===s)n.forEach(t,e);else if(n.length===+n.length){for(var u=0,i=n.length;i>u;u++)if(t.call(e,n[u],u,n)===r)return}else for(var a=j.keys(n),u=0,i=a.length;i>u;u++)if(t.call(e,n[a[u]],a[u],n)===r)return};j.map=j.collect=function(n,t,r){var e=[];return null==n?e:p&&n.map===p?n.map(t,r):(A(n,function(n,u,i){e.push(t.call(r,n,u,i))}),e)};var E="Reduce of empty array with no initial value";j.reduce=j.foldl=j.inject=function(n,t,r,e){var u=arguments.length>2;if(null==n&&(n=[]),h&&n.reduce===h)return e&&(t=j.bind(t,e)),u?n.reduce(t,r):n.reduce(t);if(A(n,function(n,i,a){u?r=t.call(e,r,n,i,a):(r=n,u=!0)}),!u)throw new TypeError(E);return r},j.reduceRight=j.foldr=function(n,t,r,e){var u=arguments.length>2;if(null==n&&(n=[]),v&&n.reduceRight===v)return e&&(t=j.bind(t,e)),u?n.reduceRight(t,r):n.reduceRight(t);var i=n.length;if(i!==+i){var a=j.keys(n);i=a.length}if(A(n,function(o,c,l){c=a?a[--i]:--i,u?r=t.call(e,r,n[c],c,l):(r=n[c],u=!0)}),!u)throw new TypeError(E);return r},j.find=j.detect=function(n,t,r){var e;return O(n,function(n,u,i){return t.call(r,n,u,i)?(e=n,!0):void 0}),e},j.filter=j.select=function(n,t,r){var e=[];return null==n?e:g&&n.filter===g?n.filter(t,r):(A(n,function(n,u,i){t.call(r,n,u,i)&&e.push(n)}),e)},j.reject=function(n,t,r){return j.filter(n,function(n,e,u){return!t.call(r,n,e,u)},r)},j.every=j.all=function(n,t,e){t||(t=j.identity);var u=!0;return null==n?u:d&&n.every===d?n.every(t,e):(A(n,function(n,i,a){return(u=u&&t.call(e,n,i,a))?void 0:r}),!!u)};var O=j.some=j.any=function(n,t,e){t||(t=j.identity);var u=!1;return null==n?u:m&&n.some===m?n.some(t,e):(A(n,function(n,i,a){return u||(u=t.call(e,n,i,a))?r:void 0}),!!u)};j.contains=j.include=function(n,t){return null==n?!1:y&&n.indexOf===y?n.indexOf(t)!=-1:O(n,function(n){return n===t})},j.invoke=function(n,t){var r=o.call(arguments,2),e=j.isFunction(t);return j.map(n,function(n){return(e?t:n[t]).apply(n,r)})},j.pluck=function(n,t){return j.map(n,function(n){return n[t]})},j.where=function(n,t,r){return j.isEmpty(t)?r?void 0:[]:j[r?"find":"filter"](n,function(n){for(var r in t)if(t[r]!==n[r])return!1;return!0})},j.findWhere=function(n,t){return j.where(n,t,!0)},j.max=function(n,t,r){if(!t&&j.isArray(n)&&n[0]===+n[0]&&n.length<65535)return Math.max.apply(Math,n);if(!t&&j.isEmpty(n))return-1/0;var e={computed:-1/0,value:-1/0};return A(n,function(n,u,i){var a=t?t.call(r,n,u,i):n;a>e.computed&&(e={value:n,computed:a})}),e.value},j.min=function(n,t,r){if(!t&&j.isArray(n)&&n[0]===+n[0]&&n.length<65535)return Math.min.apply(Math,n);if(!t&&j.isEmpty(n))return 1/0;var e={computed:1/0,value:1/0};return A(n,function(n,u,i){var a=t?t.call(r,n,u,i):n;a<e.computed&&(e={value:n,computed:a})}),e.value},j.shuffle=function(n){var t,r=0,e=[];return A(n,function(n){t=j.random(r++),e[r-1]=e[t],e[t]=n}),e},j.sample=function(n,t,r){return arguments.length<2||r?n[j.random(n.length-1)]:j.shuffle(n).slice(0,Math.max(0,t))};var k=function(n){return j.isFunction(n)?n:function(t){return t[n]}};j.sortBy=function(n,t,r){var e=k(t);return j.pluck(j.map(n,function(n,t,u){return{value:n,index:t,criteria:e.call(r,n,t,u)}}).sort(function(n,t){var r=n.criteria,e=t.criteria;if(r!==e){if(r>e||r===void 0)return 1;if(e>r||e===void 0)return-1}return n.index-t.index}),"value")};var F=function(n){return function(t,r,e){var u={},i=null==r?j.identity:k(r);return A(t,function(r,a){var o=i.call(e,r,a,t);n(u,o,r)}),u}};j.groupBy=F(function(n,t,r){(j.has(n,t)?n[t]:n[t]=[]).push(r)}),j.indexBy=F(function(n,t,r){n[t]=r}),j.countBy=F(function(n,t){j.has(n,t)?n[t]++:n[t]=1}),j.sortedIndex=function(n,t,r,e){r=null==r?j.identity:k(r);for(var u=r.call(e,t),i=0,a=n.length;a>i;){var o=i+a>>>1;r.call(e,n[o])<u?i=o+1:a=o}return i},j.toArray=function(n){return n?j.isArray(n)?o.call(n):n.length===+n.length?j.map(n,j.identity):j.values(n):[]},j.size=function(n){return null==n?0:n.length===+n.length?n.length:j.keys(n).length},j.first=j.head=j.take=function(n,t,r){return null==n?void 0:null==t||r?n[0]:o.call(n,0,t)},j.initial=function(n,t,r){return o.call(n,0,n.length-(null==t||r?1:t))},j.last=function(n,t,r){return null==n?void 0:null==t||r?n[n.length-1]:o.call(n,Math.max(n.length-t,0))},j.rest=j.tail=j.drop=function(n,t,r){return o.call(n,null==t||r?1:t)},j.compact=function(n){return j.filter(n,j.identity)};var M=function(n,t,r){return t&&j.every(n,j.isArray)?c.apply(r,n):(A(n,function(n){j.isArray(n)||j.isArguments(n)?t?a.apply(r,n):M(n,t,r):r.push(n)}),r)};j.flatten=function(n,t){return M(n,t,[])},j.without=function(n){return j.difference(n,o.call(arguments,1))},j.uniq=j.unique=function(n,t,r,e){j.isFunction(t)&&(e=r,r=t,t=!1);var u=r?j.map(n,r,e):n,i=[],a=[];return A(u,function(r,e){(t?e&&a[a.length-1]===r:j.contains(a,r))||(a.push(r),i.push(n[e]))}),i},j.union=function(){return j.uniq(j.flatten(arguments,!0))},j.intersection=function(n){var t=o.call(arguments,1);return j.filter(j.uniq(n),function(n){return j.every(t,function(t){return j.indexOf(t,n)>=0})})},j.difference=function(n){var t=c.apply(e,o.call(arguments,1));return j.filter(n,function(n){return!j.contains(t,n)})},j.zip=function(){for(var n=j.max(j.pluck(arguments,"length").concat(0)),t=new Array(n),r=0;n>r;r++)t[r]=j.pluck(arguments,""+r);return t},j.object=function(n,t){if(null==n)return{};for(var r={},e=0,u=n.length;u>e;e++)t?r[n[e]]=t[e]:r[n[e][0]]=n[e][1];return r},j.indexOf=function(n,t,r){if(null==n)return-1;var e=0,u=n.length;if(r){if("number"!=typeof r)return e=j.sortedIndex(n,t),n[e]===t?e:-1;e=0>r?Math.max(0,u+r):r}if(y&&n.indexOf===y)return n.indexOf(t,r);for(;u>e;e++)if(n[e]===t)return e;return-1},j.lastIndexOf=function(n,t,r){if(null==n)return-1;var e=null!=r;if(b&&n.lastIndexOf===b)return e?n.lastIndexOf(t,r):n.lastIndexOf(t);for(var u=e?r:n.length;u--;)if(n[u]===t)return u;return-1},j.range=function(n,t,r){arguments.length<=1&&(t=n||0,n=0),r=arguments[2]||1;for(var e=Math.max(Math.ceil((t-n)/r),0),u=0,i=new Array(e);e>u;)i[u++]=n,n+=r;return i};var R=function(){};j.bind=function(n,t){var r,e;if(_&&n.bind===_)return _.apply(n,o.call(arguments,1));if(!j.isFunction(n))throw new TypeError;return r=o.call(arguments,2),e=function(){if(!(this instanceof e))return n.apply(t,r.concat(o.call(arguments)));R.prototype=n.prototype;var u=new R;R.prototype=null;var i=n.apply(u,r.concat(o.call(arguments)));return Object(i)===i?i:u}},j.partial=function(n){var t=o.call(arguments,1);return function(){return n.apply(this,t.concat(o.call(arguments)))}},j.bindAll=function(n){var t=o.call(arguments,1);if(0===t.length)throw new Error("bindAll must be passed function names");return A(t,function(t){n[t]=j.bind(n[t],n)}),n},j.memoize=function(n,t){var r={};return t||(t=j.identity),function(){var e=t.apply(this,arguments);return j.has(r,e)?r[e]:r[e]=n.apply(this,arguments)}},j.delay=function(n,t){var r=o.call(arguments,2);return setTimeout(function(){return n.apply(null,r)},t)},j.defer=function(n){return j.delay.apply(j,[n,1].concat(o.call(arguments,1)))},j.throttle=function(n,t,r){var e,u,i,a=null,o=0;r||(r={});var c=function(){o=r.leading===!1?0:new Date,a=null,i=n.apply(e,u)};return function(){var l=new Date;o||r.leading!==!1||(o=l);var f=t-(l-o);return e=this,u=arguments,0>=f?(clearTimeout(a),a=null,o=l,i=n.apply(e,u)):a||r.trailing===!1||(a=setTimeout(c,f)),i}},j.debounce=function(n,t,r){var e,u,i,a,o;return function(){i=this,u=arguments,a=new Date;var c=function(){var l=new Date-a;t>l?e=setTimeout(c,t-l):(e=null,r||(o=n.apply(i,u)))},l=r&&!e;return e||(e=setTimeout(c,t)),l&&(o=n.apply(i,u)),o}},j.once=function(n){var t,r=!1;return function(){return r?t:(r=!0,t=n.apply(this,arguments),n=null,t)}},j.wrap=function(n,t){return function(){var r=[n];return a.apply(r,arguments),t.apply(this,r)}},j.compose=function(){var n=arguments;return function(){for(var t=arguments,r=n.length-1;r>=0;r--)t=[n[r].apply(this,t)];return t[0]}},j.after=function(n,t){return function(){return--n<1?t.apply(this,arguments):void 0}},j.keys=w||function(n){if(n!==Object(n))throw new TypeError("Invalid object");var t=[];for(var r in n)j.has(n,r)&&t.push(r);return t},j.values=function(n){for(var t=j.keys(n),r=t.length,e=new Array(r),u=0;r>u;u++)e[u]=n[t[u]];return e},j.pairs=function(n){for(var t=j.keys(n),r=t.length,e=new Array(r),u=0;r>u;u++)e[u]=[t[u],n[t[u]]];return e},j.invert=function(n){for(var t={},r=j.keys(n),e=0,u=r.length;u>e;e++)t[n[r[e]]]=r[e];return t},j.functions=j.methods=function(n){var t=[];for(var r in n)j.isFunction(n[r])&&t.push(r);return t.sort()},j.extend=function(n){return A(o.call(arguments,1),function(t){if(t)for(var r in t)n[r]=t[r]}),n},j.pick=function(n){var t={},r=c.apply(e,o.call(arguments,1));return A(r,function(r){r in n&&(t[r]=n[r])}),t},j.omit=function(n){var t={},r=c.apply(e,o.call(arguments,1));for(var u in n)j.contains(r,u)||(t[u]=n[u]);return t},j.defaults=function(n){return A(o.call(arguments,1),function(t){if(t)for(var r in t)n[r]===void 0&&(n[r]=t[r])}),n},j.clone=function(n){return j.isObject(n)?j.isArray(n)?n.slice():j.extend({},n):n},j.tap=function(n,t){return t(n),n};var S=function(n,t,r,e){if(n===t)return 0!==n||1/n==1/t;if(null==n||null==t)return n===t;n instanceof j&&(n=n._wrapped),t instanceof j&&(t=t._wrapped);var u=l.call(n);if(u!=l.call(t))return!1;switch(u){case"[object String]":return n==String(t);case"[object Number]":return n!=+n?t!=+t:0==n?1/n==1/t:n==+t;case"[object Date]":case"[object Boolean]":return+n==+t;case"[object RegExp]":return n.source==t.source&&n.global==t.global&&n.multiline==t.multiline&&n.ignoreCase==t.ignoreCase}if("object"!=typeof n||"object"!=typeof t)return!1;for(var i=r.length;i--;)if(r[i]==n)return e[i]==t;var a=n.constructor,o=t.constructor;if(a!==o&&!(j.isFunction(a)&&a instanceof a&&j.isFunction(o)&&o instanceof o))return!1;r.push(n),e.push(t);var c=0,f=!0;if("[object Array]"==u){if(c=n.length,f=c==t.length)for(;c--&&(f=S(n[c],t[c],r,e)););}else{for(var s in n)if(j.has(n,s)&&(c++,!(f=j.has(t,s)&&S(n[s],t[s],r,e))))break;if(f){for(s in t)if(j.has(t,s)&&!c--)break;f=!c}}return r.pop(),e.pop(),f};j.isEqual=function(n,t){return S(n,t,[],[])},j.isEmpty=function(n){if(null==n)return!0;if(j.isArray(n)||j.isString(n))return 0===n.length;for(var t in n)if(j.has(n,t))return!1;return!0},j.isElement=function(n){return!(!n||1!==n.nodeType)},j.isArray=x||function(n){return"[object Array]"==l.call(n)},j.isObject=function(n){return n===Object(n)},A(["Arguments","Function","String","Number","Date","RegExp"],function(n){j["is"+n]=function(t){return l.call(t)=="[object "+n+"]"}}),j.isArguments(arguments)||(j.isArguments=function(n){return!(!n||!j.has(n,"callee"))}),"function"!=typeof/./&&(j.isFunction=function(n){return"function"==typeof n}),j.isFinite=function(n){return isFinite(n)&&!isNaN(parseFloat(n))},j.isNaN=function(n){return j.isNumber(n)&&n!=+n},j.isBoolean=function(n){return n===!0||n===!1||"[object Boolean]"==l.call(n)},j.isNull=function(n){return null===n},j.isUndefined=function(n){return n===void 0},j.has=function(n,t){return f.call(n,t)},j.noConflict=function(){return n._=t,this},j.identity=function(n){return n},j.times=function(n,t,r){for(var e=Array(Math.max(0,n)),u=0;n>u;u++)e[u]=t.call(r,u);return e},j.random=function(n,t){return null==t&&(t=n,n=0),n+Math.floor(Math.random()*(t-n+1))};var I={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};I.unescape=j.invert(I.escape);var T={escape:new RegExp("["+j.keys(I.escape).join("")+"]","g"),unescape:new RegExp("("+j.keys(I.unescape).join("|")+")","g")};j.each(["escape","unescape"],function(n){j[n]=function(t){return null==t?"":(""+t).replace(T[n],function(t){return I[n][t]})}}),j.result=function(n,t){if(null==n)return void 0;var r=n[t];return j.isFunction(r)?r.call(n):r},j.mixin=function(n){A(j.functions(n),function(t){var r=j[t]=n[t];j.prototype[t]=function(){var n=[this._wrapped];return a.apply(n,arguments),z.call(this,r.apply(j,n))}})};var N=0;j.uniqueId=function(n){var t=++N+"";return n?n+t:t},j.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var q=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","   ":"t","\u2028":"u2028","\u2029":"u2029"},D=/\\|'|\r|\n|\t|\u2028|\u2029/g;j.template=function(n,t,r){var e;r=j.defaults({},r,j.templateSettings);var u=new RegExp([(r.escape||q).source,(r.interpolate||q).source,(r.evaluate||q).source].join("|")+"|$","g"),i=0,a="__p+='";n.replace(u,function(t,r,e,u,o){return a+=n.slice(i,o).replace(D,function(n){return"\\"+B[n]}),r&&(a+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'"),e&&(a+="'+\n((__t=("+e+"))==null?'':__t)+\n'"),u&&(a+="';\n"+u+"\n__p+='"),i=o+t.length,t}),a+="';\n",r.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{e=new Function(r.variable||"obj","_",a)}catch(o){throw o.source=a,o}if(t)return e(t,j);var c=function(n){return e.call(this,n,j)};return c.source="function("+(r.variable||"obj")+"){\n"+a+"}",c},j.chain=function(n){return j(n).chain()};var z=function(n){return this._chain?j(n).chain():n};j.mixin(j),A(["pop","push","reverse","shift","sort","splice","unshift"],function(n){var t=e[n];j.prototype[n]=function(){var r=this._wrapped;return t.apply(r,arguments),"shift"!=n&&"splice"!=n||0!==r.length||delete r[0],z.call(this,r)}}),A(["concat","join","slice"],function(n){var t=e[n];j.prototype[n]=function(){return z.call(this,t.apply(this._wrapped,arguments))}}),j.extend(j.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this);
    var _,KAS={};"object"==typeof module&&module.exports?(_=require("underscore"),module.exports=KAS):(_=window._,window.KAS=KAS),function(t){var e=function(){var t=function(t,e,n,i){for(n=n||{},i=t.length;i--;n[t[i]]=e);return n},e=[1,7],n=[1,17],i=[1,13],r=[1,14],s=[1,15],a=[1,32],o=[1,22],c=[1,23],u=[1,24],h=[1,25],l=[1,26],f=[1,33],p=[1,27],y=[1,28],d=[1,29],g=[1,30],m=[1,20],v=[1,36],x=[1,37],_=[5,6,8,10,33,35,41,43,45],w=[1,39],b=[1,40],k=[5,6,8,10,12,14,16,19,21,22,28,29,30,31,32,33,34,35,37,39,41,42,43,44,45,46],M=[10,16,19,21,22,28,29,30,31,32,34,37,39,42,43,44,46],S=[5,6,8,10,12,14,16,18,19,21,22,28,29,30,31,32,33,34,35,37,39,41,42,43,44,45,46],E={trace:function(){},yy:{},symbols_:{error:2,equation:3,expression:4,SIGN:5,EOF:6,additive:7,"+":8,multiplicative:9,"-":10,triglog:11,"*":12,negative:13,"/":14,trig:15,TRIG:16,trigfunc:17,"^":18,TRIGINV:19,logbase:20,ln:21,log:22,_:23,subscriptable:24,power:25,primitive:26,variable:27,VAR:28,CONST:29,INT:30,FLOAT:31,"{":32,"}":33,"(":34,")":35,function:36,FUNC:37,invocation:38,sqrt:39,"[":40,"]":41,abs:42,"|":43,"LEFT|":44,"RIGHT|":45,FRAC:46,$accept:0,$end:1},terminals_:{2:"error",5:"SIGN",6:"EOF",8:"+",10:"-",12:"*",14:"/",16:"TRIG",18:"^",19:"TRIGINV",21:"ln",22:"log",23:"_",28:"VAR",29:"CONST",30:"INT",31:"FLOAT",32:"{",33:"}",34:"(",35:")",37:"FUNC",39:"sqrt",40:"[",41:"]",42:"abs",43:"|",44:"LEFT|",45:"RIGHT|",46:"FRAC"},productions_:[0,[3,4],[3,2],[3,1],[4,1],[7,3],[7,3],[7,1],[9,2],[9,3],[9,3],[9,1],[13,2],[13,1],[15,1],[17,1],[17,3],[17,1],[20,1],[20,1],[20,3],[11,2],[11,2],[11,1],[25,3],[25,1],[27,1],[24,3],[24,1],[24,1],[24,1],[24,1],[24,3],[24,3],[36,1],[38,4],[38,4],[38,7],[38,4],[38,3],[38,3],[38,4],[26,1],[26,1],[26,7]],performAction:function(t,e,n,i,r,s,a){var o=s.length-1;switch(r){case 1:return new i.Eq(s[o-3],s[o-2],s[o-1]);case 2:return s[o-1];case 3:return new i.Add([]);case 4:case 7:case 11:case 13:case 15:case 20:case 23:case 25:case 42:case 43:this.$=s[o];break;case 5:this.$=i.Add.createOrAppend(s[o-2],s[o]);break;case 6:this.$=i.Add.createOrAppend(s[o-2],i.Mul.handleNegative(s[o],"subtract"));break;case 8:this.$=i.Mul.fold(i.Mul.createOrAppend(s[o-1],s[o]));break;case 9:this.$=i.Mul.fold(i.Mul.createOrAppend(s[o-2],s[o]));break;case 10:this.$=i.Mul.fold(i.Mul.handleDivide(s[o-2],s[o]));break;case 12:this.$=i.Mul.handleNegative(s[o]);break;case 14:case 17:this.$=[t];break;case 16:this.$=s[o-2].concat(s[o]);break;case 18:this.$=i.Log.natural();break;case 19:this.$=i.Log.common();break;case 21:this.$=i.Trig.create(s[o-1],s[o]);break;case 22:this.$=i.Log.create(s[o-1],s[o]);break;case 24:this.$=new i.Pow(s[o-2],s[o]);break;case 26:case 34:this.$=t;break;case 27:this.$=new i.Var(s[o-2],s[o]);break;case 28:this.$=new i.Var(s[o]);break;case 29:this.$=new i.Const(t.toLowerCase());break;case 30:this.$=i.Int.create(Number(t));break;case 31:this.$=i.Float.create(Number(t));break;case 32:this.$=s[o-1].completeParse();break;case 33:this.$=s[o-1].completeParse().addHint("parens");break;case 35:case 36:this.$=i.Pow.sqrt(s[o-1]);break;case 37:this.$=new i.Pow.nthroot(s[o-1],s[o-4]);break;case 38:case 39:case 40:this.$=new i.Abs(s[o-1]);break;case 41:this.$=new i.Func(s[o-3],s[o-1]);break;case 44:this.$=i.Mul.handleDivide(s[o-4],s[o-1])}},table:[{3:1,4:2,6:[1,3],7:4,9:5,10:e,11:8,13:6,15:12,16:n,17:9,19:i,20:10,21:r,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:h,34:l,36:31,37:f,38:19,39:p,42:y,43:d,44:g,46:m},{1:[3]},{5:[1,34],6:[1,35]},{1:[2,3]},t([5,6],[2,4],{8:v,10:x}),t(_,[2,7],{17:9,20:10,25:11,15:12,26:16,24:18,38:19,27:21,36:31,11:38,12:w,14:b,16:n,19:i,21:r,22:s,28:a,29:o,30:c,31:u,32:h,34:l,37:f,39:p,42:y,44:g,46:m}),t(k,[2,11]),{10:e,11:8,13:41,15:12,16:n,17:9,19:i,20:10,21:r,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:h,34:l,36:31,37:f,38:19,39:p,42:y,43:d,44:g,46:m},t(k,[2,13]),{10:e,11:8,13:42,15:12,16:n,17:9,19:i,20:10,21:r,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:h,34:l,36:31,37:f,38:19,39:p,42:y,43:d,44:g,46:m},{10:e,11:8,13:43,15:12,16:n,17:9,19:i,20:10,21:r,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:h,34:l,36:31,37:f,38:19,39:p,42:y,43:d,44:g,46:m},t(k,[2,23]),t(M,[2,15],{18:[1,44]}),t(M,[2,17]),t(M,[2,18]),t(M,[2,19],{23:[1,45]}),t(k,[2,25],{18:[1,46]}),t([10,16,18,19,21,22,28,29,30,31,32,34,37,39,42,43,44,46],[2,14]),t(S,[2,42]),t(S,[2,43]),{32:[1,47]},t(S,[2,28],{23:[1,48]}),t(S,[2,29]),t(S,[2,30]),t(S,[2,31]),{7:49,9:5,10:e,11:8,13:6,15:12,16:n,17:9,19:i,20:10,21:r,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:h,34:l,36:31,37:f,38:19,39:p,42:y,43:d,44:g,46:m},{7:50,9:5,10:e,11:8,13:6,15:12,16:n,17:9,19:i,20:10,21:r,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:h,34:l,36:31,37:f,38:19,39:p,42:y,43:d,44:g,46:m},{32:[1,52],34:[1,51],40:[1,53]},{34:[1,54]},{7:55,9:5,10:e,11:8,13:6,15:12,16:n,17:9,19:i,20:10,21:r,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:h,34:l,36:31,37:f,38:19,39:p,42:y,43:d,44:g,46:m},{7:56,9:5,10:e,11:8,13:6,15:12,16:n,17:9,19:i,20:10,21:r,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:h,34:l,36:31,37:f,38:19,39:p,42:y,43:d,44:g,46:m},{34:[1,57]},t([5,6,8,10,12,14,16,18,19,21,22,23,28,29,30,31,32,33,34,35,37,39,41,42,43,44,45,46],[2,26]),{34:[2,34]},{4:58,7:4,9:5,10:e,11:8,13:6,15:12,16:n,17:9,19:i,20:10,21:r,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:h,34:l,36:31,37:f,38:19,39:p,42:y,43:d,44:g,46:m},{1:[2,2]},{9:59,10:e,11:8,13:6,15:12,16:n,17:9,19:i,20:10,21:r,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:h,34:l,36:31,37:f,38:19,39:p,42:y,43:d,44:g,46:m},{9:60,10:e,11:8,13:6,15:12,16:n,17:9,19:i,20:10,21:r,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:h,34:l,36:31,37:f,38:19,39:p,42:y,43:d,44:g,46:m},t(k,[2,8]),{10:e,11:8,13:61,15:12,16:n,17:9,19:i,20:10,21:r,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:h,34:l,36:31,37:f,38:19,39:p,42:y,43:d,44:g,46:m},{10:e,11:8,13:62,15:12,16:n,17:9,19:i,20:10,21:r,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:h,34:l,36:31,37:f,38:19,39:p,42:y,43:d,44:g,46:m},t(k,[2,12]),t(k,[2,21]),t(k,[2,22]),{10:e,11:8,13:63,15:12,16:n,17:9,19:i,20:10,21:r,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:h,34:l,36:31,37:f,38:19,39:p,42:y,43:d,44:g,46:m},{24:64,27:21,28:a,29:o,30:c,31:u,32:h,34:l},{10:e,11:8,13:65,15:12,16:n,17:9,19:i,20:10,21:r,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:h,34:l,36:31,37:f,38:19,39:p,42:y,43:d,44:g,46:m},{7:66,9:5,10:e,11:8,13:6,15:12,16:n,17:9,19:i,20:10,21:r,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:h,34:l,36:31,37:f,38:19,39:p,42:y,43:d,44:g,46:m},{24:67,27:21,28:a,29:o,30:c,31:u,32:h,34:l},{8:v,10:x,33:[1,68]},{8:v,10:x,35:[1,69]},{7:70,9:5,10:e,11:8,13:6,15:12,16:n,17:9,19:i,20:10,21:r,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:h,34:l,36:31,37:f,38:19,39:p,42:y,43:d,44:g,46:m},{7:71,9:5,10:e,11:8,13:6,15:12,16:n,17:9,19:i,20:10,21:r,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:h,34:l,36:31,37:f,38:19,39:p,42:y,43:d,44:g,46:m},{7:72,9:5,10:e,11:8,13:6,15:12,16:n,17:9,19:i,20:10,21:r,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:h,34:l,36:31,37:f,38:19,39:p,42:y,43:d,44:g,46:m},{7:73,9:5,10:e,11:8,13:6,15:12,16:n,17:9,19:i,20:10,21:r,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:h,34:l,36:31,37:f,38:19,39:p,42:y,43:d,44:g,46:m},{8:v,10:x,43:[1,74]},{8:v,10:x,45:[1,75]},{7:76,9:5,10:e,11:8,13:6,15:12,16:n,17:9,19:i,20:10,21:r,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:h,34:l,36:31,37:f,38:19,39:p,42:y,43:d,44:g,46:m},{6:[1,77]},t(_,[2,5],{17:9,20:10,25:11,15:12,26:16,24:18,38:19,27:21,36:31,11:38,12:w,14:b,16:n,19:i,21:r,22:s,28:a,29:o,30:c,31:u,32:h,34:l,37:f,39:p,42:y,44:g,46:m}),t(_,[2,6],{17:9,20:10,25:11,15:12,26:16,24:18,38:19,27:21,36:31,11:38,12:w,14:b,16:n,19:i,21:r,22:s,28:a,29:o,30:c,31:u,32:h,34:l,37:f,39:p,42:y,44:g,46:m}),t(k,[2,9]),t(k,[2,10]),t(M,[2,16]),t(M,[2,20]),t(k,[2,24]),{8:v,10:x,33:[1,78]},t(S,[2,27]),t(S,[2,32]),t(S,[2,33]),{8:v,10:x,35:[1,79]},{8:v,10:x,33:[1,80]},{8:v,10:x,41:[1,81]},{8:v,10:x,35:[1,82]},t(S,[2,39]),t(S,[2,40]),{8:v,10:x,35:[1,83]},{1:[2,1]},{32:[1,84]},t(S,[2,35]),t(S,[2,36]),{32:[1,85]},t(S,[2,38]),t(S,[2,41]),{7:86,9:5,10:e,11:8,13:6,15:12,16:n,17:9,19:i,20:10,21:r,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:h,34:l,36:31,37:f,38:19,39:p,42:y,43:d,44:g,46:m},{7:87,9:5,10:e,11:8,13:6,15:12,16:n,17:9,19:i,20:10,21:r,22:s,24:18,25:11,26:16,27:21,28:a,29:o,30:c,31:u,32:h,34:l,36:31,37:f,38:19,39:p,42:y,43:d,44:g,46:m},{8:v,10:x,33:[1,88]},{8:v,10:x,33:[1,89]},t(S,[2,44]),t(S,[2,37])],defaultActions:{3:[2,3],33:[2,34],35:[2,2],77:[2,1]},parseError:function(t,e){if(!e.recoverable)throw new Error(t);this.trace(t)},parse:function(t){var e=this,n=[0],i=[null],r=[],s=this.table,a="",o=0,c=0,u=0,h=1,l=r.slice.call(arguments,1),f=Object.create(this.lexer),p={yy:{}};for(var y in this.yy)Object.prototype.hasOwnProperty.call(this.yy,y)&&(p.yy[y]=this.yy[y]);f.setInput(t,p.yy),p.yy.lexer=f,p.yy.parser=this,void 0===f.yylloc&&(f.yylloc={});var d=f.yylloc;r.push(d);var g=f.options&&f.options.ranges;"function"==typeof p.yy.parseError?this.parseError=p.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var m,v,x,_,w,b,k,M,S,E,I={};;){if(x=n[n.length-1],this.defaultActions[x]?_=this.defaultActions[x]:(null==m&&(E=void 0,"number"!=typeof(E=f.lex()||h)&&(E=e.symbols_[E]||E),m=E),_=s[x]&&s[x][m]),void 0===_||!_.length||!_[0]){var A="";for(b in S=[],s[x])this.terminals_[b]&&2<b&&S.push("'"+this.terminals_[b]+"'");A=f.showPosition?"Parse error on line "+(o+1)+":\n"+f.showPosition()+"\nExpecting "+S.join(", ")+", got '"+(this.terminals_[m]||m)+"'":"Parse error on line "+(o+1)+": Unexpected "+(m==h?"end of input":"'"+(this.terminals_[m]||m)+"'"),this.parseError(A,{text:f.match,token:this.terminals_[m]||m,line:f.yylineno,loc:d,expected:S})}if(_[0]instanceof Array&&1<_.length)throw new Error("Parse Error: multiple actions possible at state: "+x+", token: "+m);switch(_[0]){case 1:n.push(m),i.push(f.yytext),r.push(f.yylloc),n.push(_[1]),m=null,v?(m=v,v=null):(c=f.yyleng,a=f.yytext,o=f.yylineno,d=f.yylloc,0<u&&u--);break;case 2:if(k=this.productions_[_[1]][1],I.$=i[i.length-k],I._$={first_line:r[r.length-(k||1)].first_line,last_line:r[r.length-1].last_line,first_column:r[r.length-(k||1)].first_column,last_column:r[r.length-1].last_column},g&&(I._$.range=[r[r.length-(k||1)].range[0],r[r.length-1].range[1]]),void 0!==(w=this.performAction.apply(I,[a,c,o,p.yy,_[1],i,r].concat(l))))return w;k&&(n=n.slice(0,-1*k*2),i=i.slice(0,-1*k),r=r.slice(0,-1*k)),n.push(this.productions_[_[1]][0]),i.push(I.$),r.push(I._$),M=s[n[n.length-2]][n[n.length-1]],n.push(M);break;case 3:return!0}}return!0}},I={EOF:1,parseError:function(t,e){if(!this.yy.parser)throw new Error(t);this.yy.parser.parseError(t,e)},setInput:function(t,e){return this.yy=e||this.yy||{},this._input=t,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var t=this._input[0];return this.yytext+=t,this.yyleng++,this.offset++,this.match+=t,this.matched+=t,t.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),t},unput:function(t){var e=t.length,n=t.split(/(?:\r\n?|\n)/g);this._input=t+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-e),this.offset-=e;var i=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var r=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===i.length?this.yylloc.first_column:0)+i[i.length-n.length].length-n[0].length:this.yylloc.first_column-e},this.options.ranges&&(this.yylloc.range=[r[0],r[0]+this.yyleng-e]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(t){this.unput(this.match.slice(t))},pastInput:function(){var t=this.matched.substr(0,this.matched.length-this.match.length);return(20<t.length?"...":"")+t.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var t=this.match;return t.length<20&&(t+=this._input.substr(0,20-t.length)),(t.substr(0,20)+(20<t.length?"...":"")).replace(/\n/g,"")},showPosition:function(){var t=this.pastInput(),e=new Array(t.length+1).join("-");return t+this.upcomingInput()+"\n"+e+"^"},test_match:function(t,e){var n,i,r;if(this.options.backtrack_lexer&&(r={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(r.yylloc.range=this.yylloc.range.slice(0))),(i=t[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=i.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:i?i[i.length-1].length-i[i.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],n=this.performAction.call(this,this.yy,this,e,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),n)return n;if(this._backtrack){for(var s in r)this[s]=r[s];return!1}return!1},next:function(){if(this.done)return this.EOF;var t,e,n,i;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var r=this._currentRules(),s=0;s<r.length;s++)if((n=this._input.match(this.rules[r[s]]))&&(!e||n[0].length>e[0].length)){if(e=n,i=s,this.options.backtrack_lexer){if(!1!==(t=this.test_match(n,r[s])))return t;if(this._backtrack){e=!1;continue}return!1}if(!this.options.flex)break}return e?!1!==(t=this.test_match(e,r[i]))&&t:""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var t=this.next();return t||this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){return 0<this.conditionStack.length-1?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(t){return 0<=(t=this.conditionStack.length-1-Math.abs(t||0))?this.conditionStack[t]:"INITIAL"},pushState:function(t){this.begin(t)},stateStackSize:function(){return this.conditionStack.length},options:{flex:!0},performAction:function(t,e,n,i){switch(n){case 0:case 1:case 2:break;case 3:return"INT";case 4:return"FLOAT";case 5:return"^";case 6:case 7:case 8:case 9:return"*";case 10:case 11:return"/";case 12:case 13:return"-";case 14:return"+";case 15:return"^";case 16:return"(";case 17:return")";case 18:return"(";case 19:return")";case 20:return"[";case 21:return"]";case 22:return"{";case 23:return"}";case 24:return"{";case 25:return"}";case 26:return"_";case 27:return"|";case 28:return"LEFT|";case 29:return"RIGHT|";case 30:return"!";case 31:return"SIGN";case 32:return e.yytext="<=","SIGN";case 33:return e.yytext=">=","SIGN";case 34:return e.yytext="<=","SIGN";case 35:return e.yytext=">=","SIGN";case 36:case 37:case 38:case 39:return e.yytext="<>","SIGN";case 40:return e.yytext="<=","SIGN";case 41:return e.yytext=">=","SIGN";case 42:case 43:return"FRAC";case 44:return"sqrt";case 45:return"abs";case 46:return"ln";case 47:return"log";case 48:case 49:case 50:case 51:return"TRIG";case 52:return e.yytext="sin","TRIG";case 53:return e.yytext="cos","TRIG";case 54:return e.yytext="tan","TRIG";case 55:return e.yytext="csc","TRIG";case 56:return e.yytext="sec","TRIG";case 57:return e.yytext="cot","TRIG";case 58:return e.yytext="arcsin","TRIG";case 59:return e.yytext="arccos","TRIG";case 60:return e.yytext="arctan","TRIG";case 61:return e.yytext="arccsc","TRIG";case 62:return e.yytext="arcsec","TRIG";case 63:return e.yytext="arccot","TRIG";case 64:case 65:return"TRIGINV";case 66:return e.yytext="sinh","TRIG";case 67:return e.yytext="cosh","TRIG";case 68:return e.yytext="tanh","TRIG";case 69:return e.yytext="csch","TRIG";case 70:return e.yytext="sech","TRIG";case 71:return e.yytext="tanh","TRIG";case 72:return"CONST";case 73:case 74:return e.yytext="pi","CONST";case 75:return"VAR";case 76:case 77:return e.yytext="theta","VAR";case 78:return"VAR";case 79:case 80:return e.yytext="phi","VAR";case 81:return t.symbolLexer(e.yytext);case 82:return"EOF";case 83:return"INVALID";case 84:console.log(e.yytext)}},rules:[/^(?:\s+)/,/^(?:\\space)/,/^(?:\\ )/,/^(?:[0-9]+\.?)/,/^(?:([0-9]+)?\.[0-9]+)/,/^(?:\*\*)/,/^(?:\*)/,/^(?:\\cdot|·)/,/^(?:\\times|×)/,/^(?:\\ast)/,/^(?:\/)/,/^(?:\\div|÷)/,/^(?:-)/,/^(?:−)/,/^(?:\+)/,/^(?:\^)/,/^(?:\()/,/^(?:\))/,/^(?:\\left\()/,/^(?:\\right\))/,/^(?:\[)/,/^(?:\])/,/^(?:\{)/,/^(?:\})/,/^(?:\\left\{)/,/^(?:\\right\})/,/^(?:_)/,/^(?:\|)/,/^(?:\\left\|)/,/^(?:\\right\|)/,/^(?:\!)/,/^(?:<=|>=|<>|<|>|=)/,/^(?:\\le)/,/^(?:\\ge)/,/^(?:\\leq)/,/^(?:\\geq)/,/^(?:=\/=)/,/^(?:\\ne)/,/^(?:\\neq)/,/^(?:≠)/,/^(?:≤)/,/^(?:≥)/,/^(?:\\frac)/,/^(?:\\dfrac)/,/^(?:sqrt|\\sqrt)/,/^(?:abs|\\abs)/,/^(?:ln|\\ln)/,/^(?:log|\\log)/,/^(?:sin|cos|tan)/,/^(?:csc|sec|cot)/,/^(?:sinh|cosh|tanh)/,/^(?:csch|sech|coth)/,/^(?:\\sin)/,/^(?:\\cos)/,/^(?:\\tan)/,/^(?:\\csc)/,/^(?:\\sec)/,/^(?:\\cot)/,/^(?:\\arcsin)/,/^(?:\\arccos)/,/^(?:\\arctan)/,/^(?:\\arccsc)/,/^(?:\\arcsec)/,/^(?:\\arccot)/,/^(?:arcsin|arccos|arctan)/,/^(?:arccsc|arcsec|arccot)/,/^(?:\\sinh)/,/^(?:\\cosh)/,/^(?:\\tanh)/,/^(?:\\csch)/,/^(?:\\sech)/,/^(?:\\coth)/,/^(?:pi)/,/^(?:π)/,/^(?:\\pi)/,/^(?:theta)/,/^(?:θ)/,/^(?:\\theta)/,/^(?:phi)/,/^(?:φ)/,/^(?:\\phi)/,/^(?:[a-zA-Z])/,/^(?:$)/,/^(?:.)/,/^(?:.)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84],inclusive:!0}}};function A(){this.yy={}}return E.lexer=I,new((A.prototype=E).Parser=A)}();t.parser=e}(KAS),function(t){var e=function(){var t=function(t,e,n,i){for(n=n||{},i=t.length;i--;n[t[i]]=e);return n},e=[1,11],n=[1,9],i=[8,17],r=[6,11],s=[6,11,13,17],a={trace:function(){},yy:{},symbols_:{error:2,unitvalue:3,magnitude:4,unit:5,EOF:6,float:7,POW:8,int:9,multatoms:10,DIV:11,expatom:12,MUL:13,atom:14,"^":15,nat:16,ATOM:17,FLOAT:18,NAT:19,NEG:20,$accept:0,$end:1},terminals_:{2:"error",6:"EOF",8:"POW",11:"DIV",13:"MUL",15:"^",17:"ATOM",18:"FLOAT",19:"NAT",20:"NEG"},productions_:[0,[3,3],[3,2],[4,3],[4,1],[5,3],[5,1],[10,3],[10,2],[10,1],[12,3],[12,1],[14,1],[7,1],[7,1],[16,1],[9,2],[9,1]],performAction:function(t,e,n,i,r,s,a){var o=s.length-1;switch(r){case 1:return{type:"unitMagnitude",magnitude:s[o-2],unit:s[o-1]};case 2:return{type:"unitStandalone",unit:s[o-1]};case 3:this.$=s[o-2]+"e"+s[o];break;case 4:case 13:case 14:case 15:case 17:this.$=s[o];break;case 5:this.$={num:s[o-2],denom:s[o]};break;case 6:this.$={num:s[o],denom:null};break;case 7:this.$=[s[o-2]].concat(s[o]);break;case 8:this.$=[s[o-1]].concat(s[o]);break;case 9:this.$=[s[o]];break;case 10:this.$={name:s[o-2],pow:s[o]};break;case 11:this.$={name:s[o],pow:1};break;case 12:this.$=t;break;case 16:this.$="-"+s[o]}},table:[{3:1,4:2,5:3,7:4,10:5,12:8,14:10,16:7,17:e,18:[1,6],19:n},{1:[3]},{5:12,10:5,12:8,14:10,17:e},{6:[1,13]},{8:[1,14],17:[2,4]},{6:[2,6],11:[1,15]},t(i,[2,13]),t(i,[2,14]),t(r,[2,9],{12:8,14:10,10:17,13:[1,16],17:e}),t([6,8,11,13,17],[2,15]),t(s,[2,11],{15:[1,18]}),t([6,11,13,15,17],[2,12]),{6:[1,19]},{1:[2,2]},{9:20,19:[1,22],20:[1,21]},{10:23,12:8,14:10,17:e},{10:24,12:8,14:10,17:e},t(r,[2,8]),{16:25,19:n},{1:[2,1]},{17:[2,3]},{19:[1,26]},{17:[2,17]},{6:[2,5]},t(r,[2,7]),t(s,[2,10]),{17:[2,16]}],defaultActions:{13:[2,2],19:[2,1],20:[2,3],22:[2,17],23:[2,5],26:[2,16]},parseError:function(t,e){if(!e.recoverable)throw new Error(t);this.trace(t)},parse:function(t){var e=this,n=[0],i=[null],r=[],s=this.table,a="",o=0,c=0,u=0,h=1,l=r.slice.call(arguments,1),f=Object.create(this.lexer),p={yy:{}};for(var y in this.yy)Object.prototype.hasOwnProperty.call(this.yy,y)&&(p.yy[y]=this.yy[y]);f.setInput(t,p.yy),p.yy.lexer=f,p.yy.parser=this,void 0===f.yylloc&&(f.yylloc={});var d=f.yylloc;r.push(d);var g=f.options&&f.options.ranges;"function"==typeof p.yy.parseError?this.parseError=p.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var m,v,x,_,w,b,k,M,S,E,I={};;){if(x=n[n.length-1],this.defaultActions[x]?_=this.defaultActions[x]:(null==m&&(E=void 0,"number"!=typeof(E=f.lex()||h)&&(E=e.symbols_[E]||E),m=E),_=s[x]&&s[x][m]),void 0===_||!_.length||!_[0]){var A="";for(b in S=[],s[x])this.terminals_[b]&&2<b&&S.push("'"+this.terminals_[b]+"'");A=f.showPosition?"Parse error on line "+(o+1)+":\n"+f.showPosition()+"\nExpecting "+S.join(", ")+", got '"+(this.terminals_[m]||m)+"'":"Parse error on line "+(o+1)+": Unexpected "+(m==h?"end of input":"'"+(this.terminals_[m]||m)+"'"),this.parseError(A,{text:f.match,token:this.terminals_[m]||m,line:f.yylineno,loc:d,expected:S})}if(_[0]instanceof Array&&1<_.length)throw new Error("Parse Error: multiple actions possible at state: "+x+", token: "+m);switch(_[0]){case 1:n.push(m),i.push(f.yytext),r.push(f.yylloc),n.push(_[1]),m=null,v?(m=v,v=null):(c=f.yyleng,a=f.yytext,o=f.yylineno,d=f.yylloc,0<u&&u--);break;case 2:if(k=this.productions_[_[1]][1],I.$=i[i.length-k],I._$={first_line:r[r.length-(k||1)].first_line,last_line:r[r.length-1].last_line,first_column:r[r.length-(k||1)].first_column,last_column:r[r.length-1].last_column},g&&(I._$.range=[r[r.length-(k||1)].range[0],r[r.length-1].range[1]]),void 0!==(w=this.performAction.apply(I,[a,c,o,p.yy,_[1],i,r].concat(l))))return w;k&&(n=n.slice(0,-1*k*2),i=i.slice(0,-1*k),r=r.slice(0,-1*k)),n.push(this.productions_[_[1]][0]),i.push(I.$),r.push(I._$),M=s[n[n.length-2]][n[n.length-1]],n.push(M);break;case 3:return!0}}return!0}},o={EOF:1,parseError:function(t,e){if(!this.yy.parser)throw new Error(t);this.yy.parser.parseError(t,e)},setInput:function(t,e){return this.yy=e||this.yy||{},this._input=t,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var t=this._input[0];return this.yytext+=t,this.yyleng++,this.offset++,this.match+=t,this.matched+=t,t.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),t},unput:function(t){var e=t.length,n=t.split(/(?:\r\n?|\n)/g);this._input=t+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-e),this.offset-=e;var i=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var r=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===i.length?this.yylloc.first_column:0)+i[i.length-n.length].length-n[0].length:this.yylloc.first_column-e},this.options.ranges&&(this.yylloc.range=[r[0],r[0]+this.yyleng-e]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(t){this.unput(this.match.slice(t))},pastInput:function(){var t=this.matched.substr(0,this.matched.length-this.match.length);return(20<t.length?"...":"")+t.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var t=this.match;return t.length<20&&(t+=this._input.substr(0,20-t.length)),(t.substr(0,20)+(20<t.length?"...":"")).replace(/\n/g,"")},showPosition:function(){var t=this.pastInput(),e=new Array(t.length+1).join("-");return t+this.upcomingInput()+"\n"+e+"^"},test_match:function(t,e){var n,i,r;if(this.options.backtrack_lexer&&(r={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(r.yylloc.range=this.yylloc.range.slice(0))),(i=t[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=i.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:i?i[i.length-1].length-i[i.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],n=this.performAction.call(this,this.yy,this,e,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),n)return n;if(this._backtrack){for(var s in r)this[s]=r[s];return!1}return!1},next:function(){if(this.done)return this.EOF;var t,e,n,i;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var r=this._currentRules(),s=0;s<r.length;s++)if((n=this._input.match(this.rules[r[s]]))&&(!e||n[0].length>e[0].length)){if(e=n,i=s,this.options.backtrack_lexer){if(!1!==(t=this.test_match(n,r[s])))return t;if(this._backtrack){e=!1;continue}return!1}if(!this.options.flex)break}return e?!1!==(t=this.test_match(e,r[i]))&&t:""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var t=this.next();return t||this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){return 0<this.conditionStack.length-1?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(t){return 0<=(t=this.conditionStack.length-1-Math.abs(t||0))?this.conditionStack[t]:"INITIAL"},pushState:function(t){this.begin(t)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(t,e,n,i){switch(n){case 0:return 11;case 1:return"(";case 2:return")";case 3:return 8;case 4:return 15;case 5:return 13;case 6:return 18;case 7:return 19;case 8:return 20;case 9:case 10:case 11:return 17;case 12:break;case 13:return 6}},rules:[/^(?:\/)/,/^(?:\()/,/^(?:\))/,/^(?:(\*|x|\u00d7|\u2219|\u22c5|\u00b7)\s*10\s*\^)/,/^(?:\^)/,/^(?:\*)/,/^(?:[0-9]+\.[0-9]+)/,/^(?:[0-9]+)/,/^(?:-)/,/^(?:\u00b0( ?)[cCfF])/,/^(?:fl\.? oz\.?)/,/^(?:[\u00b5]?([A-Za-z-]+|[\u2103\u2109\u212b]))/,/^(?:\s+)/,/^(?:$)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],inclusive:!0}}};function c(){this.yy={}}return a.lexer=o,new((c.prototype=a).Parser=c)}();t.unitParser=e}(KAS),function(c){var t=function(){throw new Error("Abstract method - must override for expr: "+this.print())},a=function(t){throw new Error(t)},y=function(t){return t!=t};function s(){}function o(){}function p(){1===arguments.length?this.terms=arguments[0]:this.terms=_.toArray(arguments)}function d(){1===arguments.length?this.terms=arguments[0]:this.terms=_.toArray(arguments)}function g(t,e){this.base=t,this.exp=e}function m(t,e){this.base=t,this.power=e}function v(t,e){this.type=t,this.arg=e}function r(t){this.arg=t}function x(t,e,n){this.left=t,this.type=e,this.right=n}function e(){}function w(t,e){this.symbol=t,this.arg=e}function b(t,e){this.symbol=t,this.subscript=e}function n(t){this.symbol=t}function k(){}function M(t,e){var n=t,i=e;i<0&&(n=-n,i=-i),this.n=n,this.d=i}function S(t){this.n=t}function u(t){this.n=t}_.extend(s.prototype,{func:t,args:t,construct:function(t){var e=new this.func;return this.func.apply(e,t),e},recurse:function(e){var n=Array.prototype.slice.call(arguments,1),t=_.map(this.args(),function(t){return _.isString(t)?t:t[e].apply(t,n)});return this.construct(t)},eval:t,codegen:t,compile:function(){var e=this.codegen();try{return new Function("vars","return "+e+";")}catch(t){throw new Error("Function did not compile: "+e)}},print:t,tex:t,asTex:function(t){t=t||{},_.defaults(t,{display:!0,dynamic:!0,times:!1});var e=this.tex();return t.display&&(e="\\displaystyle "+e),t.dynamic&&(e=(e=e.replace(/\(/g,"\\left(")).replace(/\)/g,"\\right)")),t.times&&(e=e.replace(/\\cdot/g,"\\times")),e},name:function(){return this.func.name?this.func.name:this.func.toString().match(/^function\s*([^\s(]+)/)[1]},repr:function(){return this.name()+"("+_.map(this.args(),function(t){return _.isString(t)?t:t.repr()}).join(",")+")"},strip:function(){return this.recurse("strip")},normalize:function(){return this.recurse("normalize")},dsort:function(){return this.recurse("dsort")},asort:function(){return this.recurse("asort")},expand:function(){return this.recurse("expand")},factor:function(t){return this.recurse("factor",t)},collect:function(t){return this.recurse("collect",t)},equals:function(t){return this.normalize().print()===t.normalize().print()},simplify:function(t){t=_.extend({once:!1},t);var e=this.factor(t),n=e.collect(t);e.equals(n)&&(n=this.collect(t));var i=n.expand(t),r=i.collect(t);i.equals(r)&&(r=n.collect(t));var s=r;return t.once||this.equals(s)?s:s.simplify(t)},isSimplified:function(){return this.equals(this.simplify())},exprArgs:function(){return _.filter(this.args(),function(t){return t instanceof s})},getVars:function(t){return _.uniq(_.flatten(_.invoke(this.exprArgs(),"getVars",t))).sort()},getConsts:function(){return _.uniq(_.flatten(_.invoke(this.exprArgs(),"getConsts"))).sort()},getUnits:function(){return _.flatten(_.invoke(this.exprArgs(),"getUnits"))},is:function(t){return this instanceof t},has:function(e){return this instanceof e||_.any(this.exprArgs(),function(t){return t.has(e)})},raiseToThe:function(t){return new g(this,t)},isSubtract:function(){return!1},isDivide:function(){return!1},isRoot:function(){return!1},needsExplicitMul:function(){return this.args()[0].needsExplicitMul()},sameVars:function(t){var e=this.getVars(),n=t.getVars(),i=function(t,e){return!_.difference(t,e).length},r=function(t){return _.uniq(_.invoke(t,"toLowerCase")).sort()};return{equal:i(e,n),equalIgnoringCase:i(r(e),r(n))}},compare:function(t){if(t instanceof x)return!1;var e=_.union(this.getVars(!0),t.getVars(!0)),n=function(t,e){var n,i,r=(n=t,i=e,Math.abs(n)<1||Math.abs(i)<1?Math.abs(n-i):Math.abs(1-n/i));return t===e||y(t)&&y(e)||r<Math.pow(10,-9)};if(!e.length&&!this.has(E)&&!t.has(E))return n(this.eval(),t.eval());var i=this.collect(),r=t.collect(),s=this.getUnits(),a=t.getUnits();if(!_.isEqual(s,a))return!1;for(var o=0;o<12;o++){var c,u={},h=Math.pow(10,1+Math.floor(3*o/12)),l=o%2==0;if(_.each(e,function(t){var e,n;u[t]=l?(n=h-(e=-h),Math.random()*n+e):_.random(-h,h)}),i.has(w)||r.has(w)||i.has(E)||r.has(E)){var f=i.partialEval(u),p=r.partialEval(u);c=f.simplify().equals(p.simplify())}else{c=n(f=i.eval(u),p=r.eval(u))}if(!c)return!1}return!0},partialEval:function(t){return this instanceof E?this:this.has(w)?this instanceof w?new w(this.symbol,this.arg.partialEval(t)):this.recurse("partialEval",t):new u(this.eval(t).toFixed(9)).collect()},sameForm:function(t){return this.strip().equals(t.strip())},findGCD:function(t){return this.equals(t)?t:k.One},getDenominator:function(){return k.One},asMul:function(){return new d(k.One,this)},isPositive:t,isNegative:function(){return!1},asPositiveFactor:function(){return this.isPositive()?this:k.One},addHint:function(t){if(!t)return this;var e=this.construct(this.args());return e.hints=_.clone(this.hints),e.hints[t]=!0,e},hints:{parens:!1},asExpr:function(){return this},completeParse:function(){return this.recurse("completeParse")},abs:t,negate:function(){return new d(k.Neg,this)}}),o.prototype=new s,_.extend(o.prototype,{args:function(){return this.terms},normalize:function(){var t=_.sortBy(_.invoke(this.terms,"normalize"),function(t){return t.print()});return new this.func(t)},dsort:function(){var t=_.sortBy(_.invoke(this.terms,"normalize"),function(t){var e=t.exprArgs(),n=0;if(0==e.length)n=t instanceof b?1:0;else if(e[1]instanceof S)n=e[1].n;else for(var i=0;i<e.length;i++)e[i]instanceof b?n+=1:e[i]instanceof g&&(n+=e[i].exp.n);return 100-n});return new this.func(t)},asort:function(){var t=_.sortBy(_.invoke(this.terms,"normalize"),function(t){var e=t.exprArgs(),n=0;if(0==e.length)n=t instanceof b?1:0;else if(e[1]instanceof S)n=e[1].n;else for(var i=0;i<e.length;i++)e[i]instanceof b?n+=1:e[i]instanceof g&&(n+=e[i].exp.n);return n});return new this.func(t)},expand:function(){return this.recurse("expand").flatten()},partition:function(){var t=_.groupBy(this.terms,function(t){return t instanceof k}),e=t[!0]||[],n=t[!1]||[];return[new this.func(e),new this.func(n)]},flatten:function(){var e=this,t=_.reject(this.terms,function(t){return t.equals(e.identity)});if(0===t.length)return e.identity;if(1===t.length)return t[0];var n=_.groupBy(t,function(t){return t instanceof e.func}),i=n[!0]||[],r=(n[!1]||[]).concat(_.flatten(_.pluck(i,"terms"),!0));return new e.func(r)},identity:void 0,reduce:t,isPositive:function(){var t=_.invoke(this.terms,"collect");return _.all(_.invoke(t,"isPositive"))},replace:function(t,e){var n;n=t instanceof s?_.indexOf(this.terms,t):t;var i=[];_.isArray(e)?i=e:e&&(i=[e]);var r=this.terms.slice(0,n).concat(i).concat(this.terms.slice(n+1));return new this.func(r)},remove:function(t){return this.replace(t)},getDenominator:function(){return new d(_.invoke(this.terms,"getDenominator")).flatten()}}),p.prototype=new o,_.extend(p.prototype,{func:p,eval:function(n,i){return _.reduce(this.terms,function(t,e){return t+e.eval(n,i)},0)},codegen:function(){return _.map(this.terms,function(t){return"("+t.codegen()+")"}).join(" + ")||"0"},print:function(){return _.invoke(this.terms,"print").join("+")},tex:function(){var e="";return _.each(this.terms,function(t){!e||t.isSubtract()?e+=t.tex():e+="+"+t.tex()}),e},collect:function(n){var t=_.invoke(this.terms,"collect",n),i=[];_.each(t,function(t){if(t instanceof d){var e=t.partition();i.push([e[1].flatten(),e[0].reduce(n)])}else t instanceof k?i.push([k.One,t]):i.push([t,k.One])});var e=_.groupBy(i,function(t){return t[0].normalize().print()});return new p(_.compact(_.map(e,function(t){var e=t[0][0];return new d(new p(_.zip.apply(_,t)[1]).reduce(n),e).collect(n)}))).flatten()},factor:function(t){t=_.extend({keepNegative:!1},t);var n,e=_.invoke(this.terms,"collect");n=e[0]instanceof d?e[0].terms:[e[0]],_.each(_.rest(this.terms),function(e){n=_.map(n,function(t){return e.findGCD(t)})}),!t.keepNegative&&this.isNegative()&&n.push(k.Neg),n=new d(n).flatten().collect();var i=_.map(e,function(t){return d.handleDivide(t,n).simplify()});return i=new p(i).flatten(),d.createOrAppend(n,i).flatten()},reduce:function(n){return _.reduce(this.terms,function(t,e){return t.add(e,n)},this.identity)},needsExplicitMul:function(){return!1},isNegative:function(){var t=_.invoke(this.terms,"collect");return _.all(_.invoke(t,"isNegative"))},negate:function(){return new p(_.invoke(this.terms,"negate"))}}),d.prototype=new o,_.extend(d.prototype,{func:d,eval:function(n,i){return _.reduce(this.terms,function(t,e){return t*e.eval(n,i)},1)},codegen:function(){return _.map(this.terms,function(t){return"("+t.codegen()+")"}).join(" * ")||"0"},print:function(){return _.map(this.terms,function(t){return t instanceof p?"("+t.print()+")":t.print()}).join("*")},getUnits:function(){var t=_(this.terms).chain().map(function(t){return t.getUnits()}).flatten().value();return t.sort(function(t,e){return t.unit<e.unit}),t},tex:function(){for(var t,n=" \\cdot ",e=_.groupBy(this.terms,function(t){return t.isDivide()?"inverse":t instanceof k?"number":"other"}),r=e.inverse||[],i=e.number||[],s=e.other||[],a="",o=0;o<i.length;o++){if(i[o]instanceof M&&!(i[o]instanceof S)&&0<s.length&&0<r.length){var c=i.slice();c.splice(o,1);var u=c.concat(r).concat(s);return i[o].tex()+new d(u).tex()}}if(0===(i=_.compact(_.map(i,function(t){var e=t instanceof M&&!(t instanceof S),n=!t.hints.fraction||0<r.length;if(e&&n){r.push(new g(new S(t.d),k.Div));var i=new S(t.n);return i.hints=t.hints,_.any(t.hints)?i:null}return t}))).length&&1===s.length)t=s[0].tex();else{var h="",l=!0;_.each(i,function(t){t.hints.subtract&&t.hints.entered?(l=!1,a+="-",h+=(h?n:"")+t.abs().tex()):t instanceof S&&-1===t.n&&(t.hints.negate||t.hints.subtract)?a+="-":h+=(h?n:"")+t.dsort().tex()}),_.each(s,function(t){if(void 0!==t.base)t.base.tex();if(!(t instanceof b||t instanceof g)||-1!=h&&1!=h)if(t instanceof g&&t.exp instanceof S&&t.exp.n<0){if(""==h)h=1;else if("("==h[0]&&")"==h[h.length-1]){var e=h.substring(1,h.length-1);-1===e.indexOf("(")&&-1===e.indexOf(")")&&(h=e)}h=-1===t.exp.n?"\\frac{"+h+"}{"+t.base.dsort().tex()+"}":"\\frac{"+h+"}{("+t.base.dsort().tex()+")^{"+-t.exp.n+"}}"}else t.needsExplicitMul()?h+=(h?n:"")+t.tex():h+=t instanceof p?"("+t.dsort().tex()+")":t.tex();else h=l&&-1==h?"-"+t.tex():t.tex()}),t=h||"1"}if(r.length){var f=new d(_.invoke(r,"asDivide")).flatten().tex();return a+"\\frac{"+t+"}{"+f+"}"}return a+t},strip:function(){return new d(_.map(this.terms,function(t){return t instanceof k?t.abs():t.strip()})).flatten()},expand:function(){var e=function(t){return t instanceof p},n=function(t){return t instanceof g&&t.exp.isNegative()},t=this.recurse("expand").flatten(),i=_.any(t.terms,e),r=_.any(t.terms,function(t){return n(t)&&e(t.base)});if(!i&&!r)return t;var s=_.groupBy(t.terms,n),a=s[!1]||[],o=s[!0]||[];if(i){var c=_.groupBy(a,e),u=c[!0]||[],h=c[!1]||[],l=_.reduce(u,function(t,n){return _.reduce(t,function(t,e){return t.concat(_.map(n.terms,function(t){return e.concat(t)}))},[])},[[]]);a=[new p(_.map(l,function(t){return new d(h.concat(t)).flatten()}))]}r&&(o=[new g(new d(_.invoke(o,"getDenominator")).flatten().expand(),k.Div)]);return new d(a.concat(o)).flatten()},factor:function(t){var e=this.recurse("factor",t).flatten();if(!(e instanceof d))return e;var n=_.groupBy(e.terms,function(t){return t instanceof M}),i=_.reduce(n[!0],function(t,e){return{n:t.n*e.n,d:t.d*e.d}},{n:1,d:1});return i=1===i.d?new S(i.n):new M(i.n,i.d),new d((n[!1]||[]).concat(i)).flatten()},collect:function(i){var t=this.recurse("collect",i).partition(),e=t[0].reduce(i);if(0===e.eval())return k.Zero;var n=t[1].flatten();if(!(n instanceof d))return new d(e,n).flatten();n=n.terms;var r=[];_.each(n,function(t){t instanceof g?r.push([t.base,t.exp]):r.push([t,k.One])});var s=_.groupBy(r,function(t){return t[0].normalize().print()}),a=_.compact(_.map(s,function(t){var e=t[0][0],n=new p(_.zip.apply(_,t)[1]).collect(i);return n instanceof k&&0===n.eval()?null:[e,n]})),o=(r=_.groupBy(a,function(t){return t[0]instanceof v&&t[0].isBasic()?"trig":t[0]instanceof m?"log":"expr"})).trig||[],c=r.log||[],u=r.expr||[];if(1<o.length){var h=_.groupBy(o,function(t){return t[0].arg.normalize().print()});o=[],_.each(h,function(t){var n=t[0][0].arg,e={sin:k.Zero,cos:k.Zero};_.each(t,function(t){e[t[0].type]=t[1]}),d.handleNegative(e.sin).collect(i).equals(e.cos)&&(e=e.cos.isNegative()?{tan:e.sin}:{cot:e.cos}),_.each(e,function(t,e){o.push([new v(e,n),t])})})}if(1<c.length){var l=_.groupBy(c,function(t){return t[0].base.normalize().print()});c=[],_.each(l,function(t){2===t.length&&d.handleNegative(t[0][1]).collect(i).equals(t[1][1])?t[0][1].isNegative()?c.push([new m(t[0][0].power,t[1][0].power),t[1][1]]):c.push([new m(t[1][0].power,t[0][0].power),t[0][1]]):c=c.concat(t)})}r=o.concat(c).concat(u);var f=_.map(r,function(t){return new g(t[0],t[1]).collect(i)});return new d([e].concat(f)).flatten()},isSubtract:function(){return _.any(this.terms,function(t){return t instanceof k&&t.hints.subtract})},factorIn:function(t){var e=this.partition()[0].terms;if(e.length&&_.all(e,function(t){return 0<t.n})){var n=e[0].negate();return n.hints=e[0].hints,this.replace(e[0],n.addHint(t))}return new d([k.negativeOne(t)].concat(this.terms))},factorOut:function(){var i=!1,t=_.compact(_.map(this.terms,function(t,e,n){return!i&&t instanceof k&&t.hints.divide?(i=!0,-1!==t.n?t.negate():null):t}));return 1===t.length?t[0]:new d(t)},reduce:function(n){return _.reduce(this.terms,function(t,e){return t.mul(e,n)},this.identity)},findGCD:function(t){return new d(_.invoke(this.terms,"findGCD",t)).flatten()},asMul:function(){return this},asPositiveFactor:function(){return this.isPositive()?this:new d(_.invoke(this.collect().terms,"asPositiveFactor")).flatten()},isNegative:function(){return _.any(_.invoke(this.collect().terms,"isNegative"))},fold:function(){return d.fold(this)},negate:function(){var t=function(t){return t instanceof k};if(_.any(this.terms,t)){var e=_.find(this.terms,t);return this.replace(e,e.negate())}return new d([k.Neg].concat(this.terms))}}),_.each([p,d],function(n){_.extend(n,{createOrAppend:function(t,e){return t instanceof n?new n(t.terms.concat(e)):new n(t,e)}})}),_.extend(d,{handleNegative:function(t,e){if(t instanceof k&&0<t.n){var n=t.negate();return n.hints=t.hints,n.addHint(e)}return t instanceof d?t.factorIn(e):new d(k.negativeOne(e),t)},handleDivide:function(t,e){if(e instanceof d){var n=d.handleDivide(t,e.terms[0]),i=new d(_.rest(e.terms)).flatten();return d.handleDivide(n,i)}var r=function(t){return t instanceof S};if(r(e)&&t instanceof d&&_.any(t.terms,r)){var s=t.terms.slice().reverse(),a=_.find(s,function(t){return t instanceof M});if(!r(a))return new d(t.terms.concat([new M(1,e.n).addHint("fraction")]));var o=new M(a.n,e.n);return o.hints=a.hints,a===s[0]&&(o=o.addHint("fraction")),a.n<0&&e.n<0?(o.d=-o.d,t.replace(a,[k.Neg,o])):t.replace(a,o)}var c=function(t,e){if(e instanceof S){if(t instanceof S)return t.n<0&&e.n<0?[k.Neg,new M(t.n,-e.n).addHint("fraction")]:[new M(t.n,e.n).addHint("fraction")];var n=new M(1,e.eval());return e.eval()<0?[t,n.addHint("negate")]:[t,n]}var i;if(e instanceof v&&e.exp){var r=e.exp;e.exp=void 0,e=new g(e,r)}return i=e instanceof g?new g(e.base,d.handleNegative(e.exp,"divide")):new g(e,k.Div),t instanceof S&&1===t.n?[i]:[t,i]};if(t instanceof d){var u=c(_.last(t.terms),e);return new d(_.initial(t.terms).concat(u))}return new d(u=c(t,e)).flatten()},fold:function(t){if(t instanceof d){var e=_.find(_.initial(t.terms),function(t){return(t instanceof v||t instanceof m)&&t.hints.open}),n=_.indexOf(t.terms,e);if(e){var i,r=_.last(t.terms);if(!(e.hints.parens||r.hints.parens||r.has(v)||r.has(m)))return i=e instanceof v?v.create([e.type,e.exp],d.createOrAppend(e.arg,r).fold()):m.create(e.base,d.createOrAppend(e.power,r).fold()),0===n?i:new d(t.terms.slice(0,n).concat(i)).fold();e.hints.open=!1}var s=t.partition()[0].terms,a=function(t){return 0<t.n},o=function(t){return-1===t.n&&t.hints.negate};if(1<s.length&&_.some(s,o)&&_.some(s,a)&&_.every(s,function(t){return a(t)||o(t)})){var c=_.indexOf(t.terms,_.find(t.terms,o)),u=_.indexOf(t.terms,_.find(t.terms,a));if(c<u)return t.replace(u,t.terms[u].negate()).remove(c)}}return t}}),g.prototype=new s,_.extend(g.prototype,{func:g,args:function(){return[this.base,this.exp]},eval:function(t,e){var n=this.base.eval(t,e),i=this.exp.eval(t,e);if(n<0){var r=this.exp.simplify();if(r instanceof u){var s=r.n,a=(s-s.toFixed()).toString().length-2,o=Math.pow(10,a);r=new M(s*o,o).simplify()}if(r instanceof M)if(Math.abs(r.d)%2==1)return(Math.abs(r.n)%2==1?-1:1)*Math.pow(-1*n,i)}return Math.pow(n,i)},getUnits:function(){return this.base.getUnits().map(function(t){return{unit:t.unit,pow:t.pow*this.exp.n}}.bind(this))},codegen:function(){return"Math.pow("+this.base.codegen()+", "+this.exp.codegen()+")"},print:function(){var t=this.base.print();return(this.base instanceof o||this.base instanceof g)&&(t="("+t+")"),t+"^("+this.exp.print()+")"},tex:function(){if(this.isDivide())return"\\frac{1}{"+this.asDivide().tex()+"}";if(this.isRoot())return 1!==this.exp.n&&a("Node marked with hint 'root' does not have exponent of form 1/x."),2===this.exp.d?"\\sqrt{"+this.base.tex()+"}":"\\sqrt["+this.exp.d+"]{"+this.base.tex()+"}";if(this.base instanceof v&&!this.base.isInverse()&&this.exp instanceof k&&this.exp.isSimple()&&0<=this.exp.eval()){var t=this.base.tex({split:!0});return t[0]+"^{"+this.exp.tex()+"}"+t[1]}if(this.exp instanceof M&&this.exp.n%2==1&&2===this.exp.d){var e=this.base.tex(),n="",i=Math.floor(this.exp.n/this.exp.d);if(1==i)n=e;else{var r=1==e.length?e:"("+e+")";1<i&&(n=r+"^{"+i+"}")}return n+"\\sqrt{"+e+"}"}if(this.exp instanceof S&&(this.exp.n<0||1===this.exp.n))return 1===this.exp.n?this.base.dsort().tex():-1===this.exp.n?"\\frac{1}{"+this.base.dsort().tex()+"}":"\\frac{1}{("+this.base.dsort().tex()+")^{"+-this.exp.n+"}}";var s=this.base.tex();return this.base instanceof o||this.base instanceof g||this.base instanceof k&&!this.base.isSimple()?s="("+s+")":(this.base instanceof v||this.base instanceof m)&&(s="["+s+"]"),s+"^{"+this.exp.tex()+"}"},needsExplicitMul:function(){return!this.isRoot()&&this.base.needsExplicitMul()},expand:function(){var e=this.recurse("expand");if(e.base instanceof d)return new d(_.map(e.base.terms,function(t){return new g(t,e.exp)})).expand();if(e.base instanceof p&&e.exp instanceof S&&1<e.exp.abs().eval()){for(var n=0<e.exp.eval(),t=e.exp.abs().eval(),i=function(t){return n?t:new g(t,k.Div)},r={1:e.base},s=2;s<=t;s*=2){var a=new d(r[s/2],r[s/2]);r[s]=a.expand().collect()}if(_.has(r,t))return i(r[t]);var o=_.map(t.toString(2).split(""),function(t,e,n){return Number(t)*Math.pow(2,n.length-e-1)});return o=_.without(o,0),i(a=new d(_.pick(r,o)).expand().collect())}return e.exp instanceof p?new d(_.map(e.exp.terms,function(t){return new g(e.base,t).expand()})).expand():e},factor:function(){var e=this.recurse("factor");return e.base instanceof d?new d(_.map(e.base.terms,function(t){return t instanceof S&&e.exp.equals(k.Div)?new M(1,t.n):new g(t,e.exp)})):e},collect:function(t){if(this.base instanceof g)return new g(this.base.base,r=d.createOrAppend(this.base.exp,this.exp)).collect(t);var e=this.recurse("collect",t),n=function(t){return t instanceof m&&t.base.equals(e.base)};if(e.exp instanceof k&&0===e.exp.eval())return k.One;if(e.exp instanceof k&&1===e.exp.eval())return e.base;if(n(e.exp))return e.exp.power;if(e.exp instanceof d&&_.any(e.exp.terms,n)){var i=_.find(e.exp.terms,n);return new g(i.power,r=e.exp.remove(i).flatten()).collect(t)}if(e.base instanceof k&&e.exp instanceof k){if(t&&t.preciseFloats){var r=e.exp.asRational();if(e.base.getDecimalPlaces()<new g(e.base,new M(1,r.d)).collect().getDecimalPlaces())return new g(new g(e.base,new S(r.n)).collect(),new M(1,r.d))}return e.base.raiseToThe(e.exp,t)}return e},isDivide:function(){var t=function(t){return t instanceof k&&t.hints.divide};return t(this.exp)||this.exp instanceof d&&_.any(this.exp.terms,t)},asDivide:function(){if(this.exp instanceof k){if(-1===this.exp.eval())return this.base;var t=this.exp.negate();return t.hints=_.clone(this.exp.hints),t.hints.divide=!1,new g(this.base,t)}if(this.exp instanceof d)return new g(this.base,this.exp.factorOut());a("called asDivide() on an Expr that wasn't a Num or Mul")},isRoot:function(){return this.exp instanceof M&&this.exp.hints.root},isSquaredTrig:function(){return this.base instanceof v&&!this.base.isInverse()&&this.exp instanceof k&&2===this.exp.eval()},getDenominator:function(){if(this.exp instanceof k&&-1===this.exp.eval())return d.createOrAppend(this.base,this.base.getDenominator()).flatten();if(this.exp.isNegative()){var t=new g(this.base,d.handleNegative(this.exp).collect());return d.createOrAppend(t,t.collect().getDenominator()).flatten()}return this.base instanceof k?new g(this.base.getDenominator(),this.exp).collect():k.One},findGCD:function(t){var e,n;if(t instanceof g?(e=t.base,n=t.exp):(e=t,n=k.One),this.base.equals(e)){if(this.exp.equals(n))return this;if(this.exp instanceof k&&n instanceof k)return new g(this.base,k.min(this.exp,n)).collect();if(this.exp instanceof k||n instanceof k)return k.One;var i=this.exp.asMul().partition(),r=n.asMul().partition();if(i[1].equals(r[1]))return new g(e,new d(k.min(i[0].reduce(),r[0].reduce()),i[1].flatten()).flatten()).collect()}return k.One},isPositive:function(){if(this.base.isPositive())return!0;var t=this.exp.simplify();return t instanceof S&&t.eval()%2==0},asPositiveFactor:function(){if(this.isPositive())return this;var t=this.exp.simplify();if(t instanceof S){var e=t.eval();if(2<e)return new g(this.base,new S(e-1));if(e<-2)return new g(this.base,new S(e+1))}return k.One}}),_.extend(g,{sqrt:function(t){return new g(t,k.Sqrt)},nthroot:function(t,e){return new g(t,d.fold(d.handleDivide(new S(1),e)).addHint("root"))}}),m.prototype=new s,_.extend(m.prototype,{func:m,args:function(){return[this.base,this.power]},eval:function(t,e){return Math.log(this.power.eval(t,e))/Math.log(this.base.eval(t,e))},codegen:function(){return"(Math.log("+this.power.codegen()+") / Math.log("+this.base.codegen()+"))"},print:function(){var t="("+this.power.print()+")";return this.isNatural()?"ln"+t:"log_("+this.base.print()+") "+t},tex:function(){var t="("+this.power.tex()+")";return this.isNatural()?"\\ln"+t:"\\log_{"+this.base.tex()+"}"+t},collect:function(t){var e=this.recurse("collect",t);return e.power instanceof k&&1===e.power.eval()?k.Zero:e.base.equals(e.power)?k.One:e.power instanceof g&&e.power.base.equals(e.base)?e.power.exp:e},expand:function(){var e=this.recurse("expand");return e.power instanceof d?new p(_.map(e.power.terms,function(t){return new m(e.base,t).expand()})):e.power instanceof g?new d(e.power.exp,new m(e.base,e.power.base).expand()).flatten():e.isNatural()?e:d.handleDivide(new m(n.e,e.power),new m(n.e,e.base))},hints:_.extend(m.prototype.hints,{open:!1}),isPositive:function(){var t=this.collect();return t.base instanceof k&&t.power instanceof k&&0<this.eval()},needsExplicitMul:function(){return!1},isNatural:function(){return this.base.equals(n.e)}}),_.extend(m,{natural:function(){return n.e},common:function(){return k.Ten},create:function(t,e){var n=new m(t,e);return e.hints.parens||(n=n.addHint("open")),n}}),v.prototype=new s,_.extend(v.prototype,{func:v,args:function(){return[this.type,this.arg]},functions:{sin:{eval:Math.sin,codegen:"Math.sin((",tex:"\\sin",expand:function(){return this}},cos:{eval:Math.cos,codegen:"Math.cos((",tex:"\\cos",expand:function(){return this}},tan:{eval:Math.tan,codegen:"Math.tan((",tex:"\\tan",expand:function(){return d.handleDivide(v.sin(this.arg),v.cos(this.arg))}},csc:{eval:function(t){return 1/Math.sin(t)},codegen:"(1/Math.sin(",tex:"\\csc",expand:function(){return d.handleDivide(k.One,v.sin(this.arg))}},sec:{eval:function(t){return 1/Math.cos(t)},codegen:"(1/Math.cos(",tex:"\\sec",expand:function(){return d.handleDivide(k.One,v.cos(this.arg))}},cot:{eval:function(t){return 1/Math.tan(t)},codegen:"(1/Math.tan(",tex:"\\cot",expand:function(){return d.handleDivide(v.cos(this.arg),v.sin(this.arg))}},arcsin:{eval:Math.asin,codegen:"Math.asin((",tex:"\\arcsin"},arccos:{eval:Math.acos,codegen:"Math.acos((",tex:"\\arccos"},arctan:{eval:Math.atan,codegen:"Math.atan((",tex:"\\arctan"},arccsc:{eval:function(t){return Math.asin(1/t)},codegen:"Math.asin(1/(",tex:"\\operatorname{arccsc}"},arcsec:{eval:function(t){return Math.acos(1/t)},codegen:"Math.acos(1/(",tex:"\\operatorname{arcsec}"},arccot:{eval:function(t){return Math.atan(1/t)},codegen:"Math.atan(1/(",tex:"\\operatorname{arccot}"},sinh:{eval:function(t){return(Math.exp(t)-Math.exp(-t))/2},codegen:function(t){return"((Math.exp("+t+") - Math.exp(-("+t+"))) / 2)"},tex:"\\sinh",expand:function(){return this}},cosh:{eval:function(t){return(Math.exp(t)+Math.exp(-t))/2},codegen:function(t){return"((Math.exp("+t+") + Math.exp(-("+t+"))) / 2)"},tex:"\\cosh",expand:function(){return this}},tanh:{eval:function(t){return(Math.exp(t)-Math.exp(-t))/(Math.exp(t)+Math.exp(-t))},codegen:function(t){return"((Math.exp("+t+") - Math.exp(-("+t+"))) / (Math.exp("+t+") + Math.exp(-("+t+"))))"},tex:"\\tanh",expand:function(){return d.handleDivide(v.sinh(this.arg),v.cosh(this.arg))}},csch:{eval:function(t){return 2/(Math.exp(t)-Math.exp(-t))},codegen:function(t){return"(2 / (Math.exp("+t+") - Math.exp(-("+t+"))))"},tex:"\\csch",expand:function(){return d.handleDivide(k.One,v.sinh(this.arg))}},sech:{eval:function(t){return 2/(Math.exp(t)+Math.exp(-t))},codegen:function(t){return"(2 / (Math.exp("+t+") + Math.exp(-("+t+"))))"},tex:"\\sech",expand:function(){return d.handleDivide(k.One,v.cosh(this.arg))}},coth:{eval:function(t){return(Math.exp(t)+Math.exp(-t))/(Math.exp(t)-Math.exp(-t))},codegen:function(t){return"((Math.exp("+t+") + Math.exp(-("+t+"))) / (Math.exp("+t+") - Math.exp(-("+t+"))))"},tex:"\\coth",expand:function(){return d.handleDivide(v.cosh(this.arg),v.sinh(this.arg))}}},isEven:function(){return _.contains(["cos","sec"],this.type)},isInverse:function(){return 0===this.type.indexOf("arc")},isBasic:function(){return _.contains(["sin","cos"],this.type)},eval:function(t,e){return(0,this.functions[this.type].eval)(this.arg.eval(t,e))},codegen:function(){var t=this.functions[this.type].codegen;if("function"==typeof t)return t(this.arg.codegen());if("string"==typeof t)return t+this.arg.codegen()+"))";throw new Error("codegen not implemented for "+this.type)},print:function(){return this.type+"("+this.arg.print()+")"},tex:function(t){var e=this.functions[this.type].tex,n="("+this.arg.tex()+")";return t&&t.split?[e,n]:e+n},hints:_.extend(v.prototype.hints,{open:!1}),isPositive:function(){return this.collect().arg instanceof k&&0<this.eval()},completeParse:function(){if(this.exp){var t=new g(this,this.exp);return this.exp=void 0,t}return this},needsExplicitMul:function(){return!1},expand:function(){var t=this.recurse("expand");if(t.isInverse())return t;var e=t.functions[t.type].expand;return _.bind(e,t)()},collect:function(t){var e,n=this.recurse("collect",t);return!n.isInverse()&&n.arg.isNegative()?(e=n.arg instanceof k?n.arg.abs():d.handleDivide(n.arg,k.Neg).collect(t),n.isEven()?new v(n.type,e):new d(k.Neg,new v(n.type,e))):n}}),_.extend(v,{create:function(t,e){var n=t[0],i=t[1];i&&i.equals(k.Neg)&&(n="arc"+n,i=void 0);var r=new v(n,e);return e.hints.parens||(r=r.addHint("open")),i&&(r.exp=i),r},sin:function(t){return new v("sin",t)},cos:function(t){return new v("cos",t)},sinh:function(t){return new v("sinh",t)},cosh:function(t){return new v("cosh",t)}}),r.prototype=new s,_.extend(r.prototype,{func:r,args:function(){return[this.arg]},eval:function(t,e){return Math.abs(this.arg.eval(t,e))},codegen:function(){return"Math.abs("+this.arg.codegen()+")"},print:function(){return"abs("+this.arg.print()+")"},tex:function(){return"\\left|"+this.arg.tex()+"\\right|"},collect:function(t){var e=this.recurse("collect",t);if(e.arg.isPositive())return e.arg;if(e.arg instanceof k)return e.arg.abs();if(e.arg instanceof d){var n=_.groupBy(e.arg.terms,function(t){return t.isPositive()?"positive":t instanceof k?"number":"other"}),i=n.positive.concat(_.invoke(n.number,"abs"));return n.other.length&&i.push(new r(new d(n.other).flatten())),new d(i).flatten()}return e},expand:function(){var t=this.recurse("expand");return t.arg instanceof d?new d(_.map(t.arg.terms,function(t){return new r(t)})):t},isPositive:function(){return!0}}),x.prototype=new s,_.extend(x.prototype,{func:x,args:function(){return[this.left,this.type,this.right]},needsExplicitMul:function(){return!1},print:function(){return this.left.print()+this.type+this.right.print()},signs:{"=":" = ","<":" < ",">":" > ","<>":" \\ne ","<=":" \\le ",">=":" \\ge "},tex:function(){return this.left.tex()+this.signs[this.type]+this.right.tex()},normalize:function(){var t=this.recurse("normalize");return _.contains([">",">="],t.type)?new x(t.right,t.type.replace(">","<"),t.left):t},asExpr:function(t){var e=function(t){return t instanceof k&&t.isSimple()&&0===t.eval()},n=[];this.left instanceof p?n=_.clone(this.left.terms):e(this.left)||(n=[this.left]),this.right instanceof p?n=n.concat(this.right.negate().terms):e(this.right)||n.push(this.right.negate());var i=!this.isEquality();n=_.invoke(n,"collect",{preciseFloats:!0});for(var r=0;r<n.length;r++){var s=n[r].getDenominator();i&&!s.isPositive()&&(s=s.asPositiveFactor()),s.equals(k.One)||(n=_.map(n,function(t){return d.createOrAppend(t,s).simplify({once:!0,preciseFloats:!0})}))}var a=new p(n).flatten();return t?a:this.divideThrough(a)},divideThrough:function(t){var e=!this.isEquality(),n=t.simplify({once:!0}),i=n.factor({keepNegative:e});if(!(i instanceof d))return t;var r=i.terms,s=_.groupBy(r,function(t){return t instanceof p}),a=s[!0]||[],o=s[!1]||[];if(a.length&&this.isEquality())return new d(a).flatten();var c=o;a.length||(c=_.reject(c,function(t){return!!t.getVars().length})),e&&(c=_.invoke(c,"asPositiveFactor")),c=_.reject(c,function(t){return t.equals(k.One)}),c=_.map(c,function(t){return new g(t,k.Div)});var u=new d(r.concat(c)).collect();return u.equals(i)?n:u},isEquality:function(){return _.contains(["=","<>"],this.type)},compare:function(t){if(!(t instanceof x))return!1;var e=this.normalize(),n=t.normalize();if(e.type!==n.type)return!1;var i=e.divideThrough(e.asExpr(!0).collect()),r=n.divideThrough(n.asExpr(!0).collect());return e.isEquality()?i.compare(r)||i.compare(d.handleNegative(r)):i.compare(r)},sameForm:function(t){var e=this.normalize(),n=t.normalize(),i=e.left.sameForm(n.left)&&e.right.sameForm(n.right);return e.isEquality()?i||e.left.sameForm(n.right)&&e.right.sameForm(n.left):i},isSimplified:function(){var t=this.asExpr(!0),e=this.divideThrough(t).simplify();return t.equals(e)&&this.left.isSimplified()&&this.right.isSimplified()}}),_.extend(x.prototype,{solveLinearEquationForVariable:function(t){var e=this.asExpr();if(!e.is(p)||2!==e.terms.length)throw new Error("Can only handle linear equations of the form a + bx (= 0)");var n,i,r;return(r=e.terms[0]).has(b)&&_.contains(r.getVars(),t.symbol)?(n=d.handleNegative(e.terms[1]),i=d.handleDivide(e.terms[0],t)):(n=d.handleNegative(e.terms[0]),i=d.handleDivide(e.terms[1],t)),d.handleDivide(n,i).simplify()}}),e.prototype=new s,_.extend(e.prototype,{needsExplicitMul:function(){return!1},findGCD:function(t){return t instanceof e||t instanceof k?this.equals(t)?this:k.One:t.findGCD(this)}}),w.prototype=new e,_.extend(w.prototype,{func:w,args:function(){return[this.symbol,this.arg]},print:function(){return this.symbol+"("+this.arg.print()+")"},tex:function(){return this.symbol+"("+this.arg.tex()+")"},eval:function(t,e){var n=this.arg,i=t[this.symbol],r=_.extend(_.clone(t),{x:n.eval(t,e)}),s=c.parse(i,e);return s.parsed?s.expr.eval(r,e):s},codegen:function(){return'vars["'+this.symbol+'"]('+this.arg.codegen()+")"},getUnits:function(){return this.arg.getUnits()},getVars:function(t){return t?this.arg.getVars():_.union(this.arg.getVars(),[this.symbol]).sort()},getConsts:function(){return this.arg.getConsts()}}),b.prototype=new e,_.extend(b.prototype,{func:b,args:function(){return[this.symbol,this.subscript]},exprArgs:function(){return[]},recurse:function(){return this},print:function(){var t="";return this.subscript&&(t="_("+this.subscript.print()+")"),this.symbol+t},prettyPrint:function(){var t=this.subscript;return t&&(t instanceof k||t instanceof e)?this.symbol+"_"+t.print():this.print()},tex:function(){var t="";return this.subscript&&(t="_{"+this.subscript.tex()+"}"),(1<this.symbol.length?"\\":"")+this.symbol+t},repr:function(){return"Var("+this.print()+")"},eval:function(t,e){return t[this.prettyPrint()]},codegen:function(){return'vars["'+this.prettyPrint()+'"]'},getVars:function(){return[this.prettyPrint()]},isPositive:function(){return!1}}),n.prototype=new e,_.extend(n.prototype,{func:n,args:function(){return[this.symbol]},recurse:function(){return this},eval:function(t,e){return"pi"===this.symbol?Math.PI:"e"===this.symbol?Math.E:void 0},codegen:function(){return"pi"===this.symbol?"Math.PI":"e"===this.symbol?"Math.E":void 0},print:function(){return this.symbol},tex:function(){return"pi"===this.symbol?"\\pi ":"e"===this.symbol?"e":void 0},isPositive:function(){return 0<this.eval()},abs:function(){return 0<this.eval()?this:d.handleNegative(this)},getConsts:function(){return[this.print()]}}),n.e=new n("e"),n.pi=new n("pi"),k.prototype=new s,_.extend(k.prototype,{repr:function(){return this.print()},strip:function(){return this.abs()},recurse:function(){return this},codegen:function(){return this.print()},add:t,mul:t,negate:t,isSubtract:function(){return this.hints.subtract},abs:t,needsExplicitMul:function(){return!0},findGCD:t,isPositive:function(){return 0<this.eval()},isNegative:function(){return this.eval()<0},asPositiveFactor:function(){return this.isPositive()?this:this.abs()},hints:_.extend(k.prototype.hints,{negate:!1,subtract:!1,divide:!1,root:!1,fraction:!1,entered:!1}),isSimple:t,getDecimalPlaces:function(){var t=(""+this.n).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return t?Math.max(0,(t[1]?t[1].length:0)-(t[2]?+t[2]:0)):0},asRational:t}),M.prototype=new k,_.extend(M.prototype,{func:M,args:function(){return[this.n,this.d]},eval:function(){return this.n/this.d},print:function(){return this.n.toString()+"/"+this.d.toString()},tex:function(){var t="\\frac{"+Math.abs(this.n).toString()+"}{"+this.d.toString()+"}";return this.n<0?"-"+t:t},add:function(t,e){return t instanceof M?new M(this.n*t.d+this.d*t.n,this.d*t.d).collect():t.add(this,e)},mul:function(t,e){return t instanceof M?new M(this.n*t.n,this.d*t.d).collect():t.mul(this,e)},collect:function(){var t=k.findGCD(this.n,this.d),e=this.n/t,n=this.d/t;return 1===n?new S(e):new M(e,n)},negate:function(){return new M(-this.n,this.d)},abs:function(){return new M(Math.abs(this.n),this.d)},findGCD:function(t){return t instanceof M?new M(k.findGCD(this.n*t.d,t.n*this.d),this.d*t.d).collect():t instanceof S?new M(k.findGCD(this.n,t.n),this.d):t.findGCD(this)},raiseToThe:function(t){if(t instanceof S){var e=0<t.eval(),n=t.abs().eval(),i=Math.pow(this.n,n),r=Math.pow(this.d,n);return e?new M(i,r).collect():new M(r,i).collect()}return new u(this.eval()).raiseToThe(t)},getDenominator:function(){return new S(this.d)},isSimple:function(){return!1},asRational:function(){return this}}),S.prototype=new M(0,1),_.extend(S.prototype,{func:S,args:function(){return[this.n]},print:function(){return this.n.toString()},tex:function(){return this.n.toString()},negate:function(){return new S(-this.n)},abs:function(){return new S(Math.abs(this.n))},isSimple:function(){return!0},findGCD:function(t){return t instanceof S?new S(k.findGCD(this.n,t.n)):t.findGCD(this)}}),_.extend(S,{create:function(t){return new S(t).addHint("entered")}}),u.prototype=new k,_.extend(u.prototype,{func:u,args:function(){return[this.n]},eval:function(){return this.n},print:function(){return this.n.toString()},tex:function(){return this.n.toString()},add:function(t,e){return e&&e.preciseFloats?u.toDecimalPlaces(this.n+t.eval(),Math.max(this.getDecimalPlaces(),t.getDecimalPlaces())):new u(this.n+t.eval()).fixCollect()},mul:function(t,e){return e&&e.preciseFloats?u.toDecimalPlaces(this.n*t.eval(),this.getDecimalPlaces()+t.getDecimalPlaces()):new u(this.n*t.eval()).fixCollect()},fixCollect:function(){var t=this.eval(),e=Number((Math.round(1e7*t)/1e7).toFixed(5));return e%1==0&&(t=e),new u(t).collect()},collect:function(){return this},negate:function(){return new u(-this.n)},abs:function(){return new u(Math.abs(this.n))},findGCD:function(t){return t instanceof k?new u(k.findGCD(this.eval(),t.eval())).collect():t.findGCD(this)},raiseToThe:function(t,e){return e&&e.preciseFloats&&t instanceof S&&1<t.n?u.toDecimalPlaces(new g(this,t).eval(),this.getDecimalPlaces()*t.n):new u(new g(this,t).eval()).collect()},asRational:function(){var t=this.n.toString().split(".");return 1===t.length?new M(this.n,1):new M(Number(t.join("")),Math.pow(10,t[1].length)).collect()},getDenominator:function(){return this.asRational().getDenominator()},isSimple:function(){return!0}}),_.extend(u,{create:function(t){return new u(t).addHint("entered")},toDecimalPlaces:function(t,e){return new u(+t.toFixed(Math.min(e,20))).collect()}}),_.extend(k,{negativeOne:function(t){return"subtract"===t?k.Sub:"divide"===t?k.Div:k.Neg},findGCD:function(t,e){var n;if(t=Math.abs(t),e=Math.abs(e),t!==Math.floor(t)||e!==Math.floor(e))return 1;for(;e;)n=t%e,t=e,e=n;return t},min:function(){return _.min(_.toArray(arguments),function(t){return t.eval()})},max:function(){return _.max(_.toArray(arguments),function(t){return t.eval()})}}),k.Neg=new S(-1).addHint("negate"),k.Sub=new S(-1).addHint("subtract"),k.Div=new S(-1).addHint("divide"),k.Sqrt=new M(1,2).addHint("root"),k.Zero=new S(0),k.One=new S(1),k.Ten=new S(10),p.prototype.identity=k.Zero,d.prototype.identity=k.One;var i=c.parser;function E(t){this.symbol=t}i.yy={Add:p,Mul:d,Pow:g,Log:m,Trig:v,Eq:x,Abs:r,Func:w,Const:n,Var:b,Int:S,Float:u,parseError:function(t,e){throw new Error(e.loc.first_column)},constants:["e"],symbolLexer:function(t){return _.contains(i.yy.constants,t)?"CONST":_.contains(i.yy.functions,t)?"FUNC":"VAR"}},c.parse=function(t,e){try{return e&&e.functions?i.yy.functions=_.without(e.functions,"i"):i.yy.functions=[],e&&e.decimal_separator&&(t=t.split(e.decimal_separator).join(".")),{parsed:!0,expr:i.parse(t).completeParse()}}catch(t){return{parsed:!1,error:t.message}}},E.prototype=new e;var h=function(e){if(_(l).has(e)||_(D).has(e))return new E(e);var t=_(_(f).keys()).find(function(t){return new RegExp("^"+t).test(e)});if(t){var n=e.replace(new RegExp("^"+t),"");if(_(l).has(n)||D[n]&&D[n].prefixes===I)return new d(f[t],new E(n));throw new Error(n+" does not allow prefixes")}return new E(e)};c.unitParse=function(t){try{var e=c.unitParser.parse(t),n=[];_(e.unit.num).each(function(t){n.push(new g(h(t.name),new S(t.pow)))}),_(e.unit.denom).each(function(t){n.push(new g(h(t.name),new S(-1*t.pow)))});var i=new d(n).flatten();return"unitMagnitude"===e.type?{parsed:!0,unit:i,expr:new d([new u(+e.magnitude)].concat(n)),coefficient:e.magnitude,type:e.type}:{parsed:!0,unit:i,type:e.type}}catch(t){return{parsed:!1,error:t.message}}},_.extend(E.prototype,{func:E,args:function(){return[this.symbol]},recurse:function(){return this},eval:function(t,e){return 1},getUnits:function(){return[{unit:this.symbol,pow:1}]},codegen:function(){return"1"},print:function(){return this.symbol},tex:function(){return this.symbol},collect:function(t){if(_(l).has(this.symbol))return this;if(_(D).has(this.symbol))return D[this.symbol].conversion;throw new Error("could not understand unit: "+this.symbol)}});var l={m:new E("m"),g:new E("g"),s:new E("s"),A:new E("A"),K:new E("K"),mol:new E("mol"),cd:new E("cd")},f={a:new g(new S(10),new S(-18)),f:new g(new S(10),new S(-15)),p:new g(new S(10),new S(-12)),n:new g(new S(10),new S(-9)),u:new g(new S(10),new S(-6)),m:new g(new S(10),new S(-3)),c:new g(new S(10),new S(-2)),d:new g(new S(10),new S(-1)),da:new S(10),h:new g(new S(10),new S(2)),k:new g(new S(10),new S(3)),M:new g(new S(10),new S(6)),G:new g(new S(10),new S(9)),T:new g(new S(10),new S(12)),P:new g(new S(10),new S(15)),E:new g(new S(10),new S(18)),hella:new g(new S(10),new S(27))},I={},A={},N=function(t,e){var n=t.split("|"),i=n[0].trim(),r=n[1].trim(),s=k.One;""!==i&&(s=c.parse(i).expr);var a=r.split("/"),o=[s];return a[0]&&a[0].split(" ").filter(function(t){return""!==t}).map(function(t){o.push(new E(t))}),a[1]&&a[1].split(" ").filter(function(t){return""!==t}).map(function(t){o.push(new g(new E(t),k.Div))}),{conversion:new d(o),prefixes:e}},D={Da:N("1.6605388628 x 10^-24 | g",I),u:N("| Da",A),meter:N("| m",A),meters:N("| m",A),in:N("254 / 10000 | m",A),ft:N("3048  / 10000 | m",A),yd:N("9144  / 10000 | m",A),mi:N("1609344 / 1000 | m",A),ly:N("9.4607 x 10^15 | m",A),nmi:N("1852 | m",A),"Å":N("10^-10 | m",A),pc:N("3.0857 x 10^16 | m",A),min:N("60 | s",A),hr:N("3600 | s",A),sec:N("| s",A),day:N("86400 | s",A),wk:N("604800 | s",A),fortnight:N("14 | day",A),shake:N("10^-8 | s",A),olympiad:N("126200000 | s",A),"°C":N("1 | K",A),"°F":N("5/9 | K",A),"°R":N("5/9 | K",A),e:N("1.6021765314 x 10^-19 | C",A),c:N("299792458 | m / s",A),kn:N("514/1000 | m / s",A),kt:N("| kn",A),knot:N("| kn",A),J:N("| N m",I),BTU:N("1060 | J",A),cal:N("4184 / 1000 | J",I),eV:N("1.602176514 x 10^-19 | J",I),erg:N("10^−7 | J",I),W:N("| J / s",I),"H-e":N("80 | W",A),N:N("1000 | g m / s s",I),lb:N("4448221615 / 1000000000 | N",A),dyn:N("10^-5 | N",A),Pa:N("1 | N / m m m",I),bar:N("10^5 | Pa",I),"㏔":N("1/1000 | bar",A),"㍴":N("| bar",A),atm:N("101325 | Pa",A),Torr:N("1/760 | atm",A),mmHg:N("| Torr",A),ha:N("10^4 | m m",A),b:N("10^−28 | m m",I),barn:N("| b",I),acre:N("4046.87 | m m",A),skilodge:N("10^-31 | m m",A),outhouse:N("10^-34 | m m",A),shed:N("10^-52 | m m",A),L:N("1/1000 | m m m",I),gal:N("3785/1000 | L",I),cup:N("1/16 | gal",A),qt:N("1/4 | gal",A),quart:N("| qt",A),p:N("1/8 | gal",A),pt:N("| p",A),pint:N("| p",A),"fl oz":N("1/8 | cup",A),"fl. oz.":N("1/8 | cup",A),tbsp:N("1/16 | cup",A),tsp:N("1/3 | tbsp",A),rev:N("2 pi | rad",A),deg:N("180 pi | rad",A),"°":N("| deg",A),arcminute:N("1/60 | deg",A),arcsec:N("1/3600 | deg",A),Hu:N("1000 | dB",I),dozen:N("12 |",A),mol:N("6.0221412927 x 10^23 |",I),"%":N("1/100 |",A),percent:N("| %",A),ppm:N("1/1000000 |",A),V:N("1000 | g m m / s s C",I),C:N("| A s",I),ampere:N("| A",A),"Ω":N("| V / A",I),ohm:N("| Ω",A),F:N("| C / V",I),H:N("| ohm s",I),T:N("1000 | g / C s",I),Wb:N("1000 | g m m / C s",I),lm:N("pi x 10^4 | cd / m m",A),lx:N("| lm / m m",A),nit:N("| cd / m m",A),sb:N("10^4 | cd / m m",A),stilb:N("1 | sb",A),apostilb:N("1 / pi x 10^(-4) | sb",A),blondel:N("| apostilb",A),asb:N("| apostilb",A),la:N("| lm",A),Lb:N("| lm",A),sk:N("10^-7 | lm",A),skot:N("| sk",A),bril:N("10^-11 | lm",A),Hz:N("| / s",I)};c.Add=p,c.Mul=d,c.Pow=g,c.Log=m,c.Eq=x,c.Trig=v,c.Abs=r,c.Func=w,c.Var=b,c.Const=n,c.Unit=E,c.Rational=M,c.Int=S,c.Float=u,c.Zero=k.Zero,c.One=k.One}(KAS),KAS.compare=function(t,e,n){var i={form:!1,simplify:!1};n=void 0!==n?_.extend(i,n):i;var r,s=t.sameVars(e);return s.equal?t.compare(e)?n.form&&!t.sameForm(e)?{equal:!1,message:"Your answer is not in the correct form."}:n.simplify&&!t.isSimplified()?{equal:!1,message:"Your answer is not fully expanded and simplified."}:{equal:!0,message:null}:{equal:!1,message:null}:(r=s.equalIgnoringCase?"Check your variables; one or more are using the wrong case (upper or lower).":"Check your variables; you may have used the wrong letter for one or more of them.",{equal:!1,wrongVariableCase:s.equalIgnoringCase,wrongVariableNames:!s.equalIgnoringCase,message:r})};
    String.prototype.replaceMe = function(find, replace, start) {
        if(start === undefined) start = 0;
        var string = this;
        var keyWord = string.match(new RegExp("\\\\(.*?)[{\\(\\)]",'g'));
        //console.log(keyWord);
        var arr = [];
        if(keyWord instanceof Array)
        for(var i = 0; i < keyWord.length; i++){
            var key = keyWord[i];
            var n = 0;
            do{
                n = string.indexOf(key, n);
                if(n > - 1){ 
                    for(var j = 0; j < key.length; j++) arr[n + j] = 1;
                    n += key.length;
                }
            }while( n > -1 );
        }
        var leng = find.length;
        start = string.indexOf(find, start);
        if(start == -1){
            return string;
        }
        else if(arr[start] !== 1){
            //var replaceTo = replace.charAt(0) === '-' ? '('+replace+')' : replace;
            if(replace.charAt(0) === '-' || replace.indexOf('dfrac') > -1  || replace.indexOf('+') > -1 || replace.indexOf('-') > -1  || replace.indexOf('frac') > -1 || replace.indexOf('sqrt') > -1 || replace.indexOf('sqr') > -1 )
            {
                var replaceTo = '\\left('+replace+'\\right)';
            }
            else var replaceTo = replace;
            //console.log(replaceTo);
            string = string.substring(0, start) + '.' + replaceTo+ string.substring(start+leng, string.length); 
        }
        else { start += leng; }
        return string.replaceMe(find, replace, start);
    };
    //Chuyển từ hỗn số sang phân số
    String.prototype.toFraction = function(){
        var string = this;
        var vars = string.match(/(\d+)\\dfrac{(\d+)}{(\d+)}/g);
        if(vars != null){
            $.each(vars, function( index, value ) {
                var arr = value.match(/(\d+)/g);
                if(arr.length === 3){
                    var ps = "\\dfrac{"+(parseInt(arr[2]) * parseInt(arr[0]) + parseInt(arr[1]))+"}{"+arr[2]+"}";
                    try {
                        string = string.replace(value, ps);
                    }
                    catch(err) {
                        alert("Lỗi btds trong xử lý hỗn số : "+ err.message);
                    }
                }
            });
        }
        return string;
    }
    var btds = function(_string_, inside){
        this.parsed = false;
        this.init = function(){
                //console.log(_string_);        
            if(inside === 1){
                var bt = _string_.toString().replace(/\^{}/g,"").replace(/--/g,"+").replace(new RegExp('\\+-', 'g'), "-");
                //console.log(bt);
            }
            else if(inside === 2){
                var bt = _string_.toString().replace(/\^{}/g,"").toFraction().replace(/\s/g,"").replace(/\[/g,"(").replace(/\]/g,")").replace(/--/g,"+").replace(new RegExp('\\+-', 'g'), "-");
            }
            else{
                var bt = _string_.toString().replace(/\^{}/g,"").toFraction().replace(/\s/g,"").replace(/\[/g,"(").replace(/\]/g,")").replace(/--/g,"+").replace(new RegExp('\\+-', 'g'), "-");
                //var chkNumber = /^[0-9.-]+$/;
                /*
                if(!bt.match(chkNumber)){
                    //Không phải là 1 số
                    bt = bt.replace(/\./g,"*");
                }
                */
                bt = bt.replace(/,/g,".");
            }//
            //console.log(bt);
            var parsed = KAS.parse(bt, {}).expr;
            if (parsed === undefined) { console.log("Biểu thức nhập vào không hợp lệ"); this.parsed = KAS.parse('0', {}).expr; }
            else this.parsed = parsed;
        }
        this.equal = function(eq){
            return KAS.compare(this.parsed, eq.parsed).equal;
        }
        this.compareBT = function(bt){
            _parsed = new btds(bt);
            return this.equal(_parsed); 
        }
        this.collect = function(){ //Sắp xếp theo số mũ tăng dần
            return new btds(this.parsed.collect().print(), 1);
        }
        this.expand = function(){   
            return new btds(this.parsed.expand().print(), 1);
        }
        this.factor = function(){
            return new btds(this.parsed.factor().print(), 1);   
        }
        this.simplify = function(){ //Phân tích thành đa thức rồi thu gọn
            return new btds(this.parsed.simplify().dsort().print(), 1);
        }
        this.negate = function(){
            return new btds(this.parsed.negate().print(), 1);
        }
        this.dsort = function()
        {
            return new btds(this.parsed.dsort().print(), 1);    
        }
        this.asort = function()
        {
            return new btds(this.parsed.asort().print(), 1);    
        }       
        this.rutgon = function(){
            return this.simplify();
        }
        this.khaitrien = function(){
            return this.expand();
        }
        //ngược dấu
        this.nguocdau = function(){
            return new btds("-("+this.parsed.print()+")", 1);
        }
        this.cong = function(bt){
            return new btds("("+this.parsed.print()+")+("+bt.parsed.print()+")", 1);
        }
        this.tru = function(bt){
            return new btds("("+this.parsed.print()+")-("+bt.parsed.print()+")", 1);
        }
        this.nhan = function(bt){
            //return new btds("("+this.parsed.print()+")("+bt.parsed.print()+")", true);
            return new btds("("+this.parsed.print()+")("+bt.parsed.print()+")", 1);
        }
        this.chia = function(bt){
            //return new btds("("+this.parsed.print()+")/("+bt.parsed.print()+")", true);
            return new btds("\\frac{"+this.parsed.print()+"}{"+bt.parsed.print()+"}", 1);
        }
        this.pow = function(n){
            return new btds("("+this.parsed.print()+")^{"+n+"}", 1);
        }
        this.tex = function(){
            //console.log(this.parsed.tex());
            return this.parsed.tex().replace(/\./g,",").replace(new RegExp('\\(', 'g'), '\\left(').replace(new RegExp('\\)', 'g'), '\\right)').replace(/\\cdot/g,".").replace(/--/g,"+").replace(new RegExp('\\+-', 'g'), "-");
        }
        this.print = function(){
            return this.parsed.print().replace(/\./g,",");
        }
        this.eval = function(objectValue){
            var val = this.parsed.eval(objectValue);
            //console.log(val);
            return this.fixFloat(val);
        }
        this.tinh = function(objectValue){
            return this.eval(objectValue);
        }
        this.giatri = function(objectValue){
            return this.eval(objectValue).toString().replace(".",",");
        }
        //Giá trị hữu tỉ
        this.giatriht = function(objectValue){
            var str = this.thayso(objectValue);
            str = str.replace(/\./g,"*");
            var gt = new btds( str );
            gt.parsed = gt.parsed.simplify();
            if(isNaN(gt.parsed.n)) return 0;
            else if(gt.parsed.n !== undefined && gt.parsed.n % 1 !== 0) return this.fixFloat(gt.parsed.n).toString().replace(".",",");
            else return gt.tex();
        }
        this.thayso = function(objectValue){
            var string = this.tex();
            var keyNames = Object.keys(objectValue);
            for(var i = 0; i < keyNames.length; i++){
                var _var = keyNames[i], ov = objectValue[_var].toString().replace(".",",");
                //string = string.replace(new RegExp(_var, 'g'), "."+ov);
                string = string.replaceMe(_var, ov);
            }
            if(string.charAt(0) == ".") string = string.substr(1);
            return string.replace(new RegExp('\\+\\.', 'g'), "+").replace(new RegExp('-\\.', 'g'), "-").replace(new RegExp('\\{\\.', 'g'), "{").replace(new RegExp('\\[\\.', 'g'), "[").replace(new RegExp('\\(\\.', 'g'), "(");
        }
        this.thay = function(objectValue){
            var str = this.thayso(objectValue);
            str = str.replace(/\./g,"*");
            return new btds( str );
        }   
        this.placeone = function(objectValue){
            var str = this.thayso(objectValue);
            str = str.replace(/\./g,"*");
            return new btds( str );
        }
        this.kas = function(){
            return this.parsed;
        }
        this.fixFloat = function(n){
            var LT=10000000;
            return Number((Math.round(n*LT)/LT).toFixed(5));
        }
        this.init();
    }
    var eqValue = function(_bt1, _bt2)
    {
        //so sánh 1 với 2
        // if(_bt1.length <= 2 || _bt2.length <= 2){
        //  return _bt1 == _bt2;
        // }
        // else{
            _bt1 = _bt1+ "";
            _bt2 = _bt2 + "";
            try{
                var bt1 = new btds(_bt1);
                var bt2 = new btds(_bt2);
                return bt1.equal(bt2);
            }
            catch(err){
                console.log("Lỗi: Biểu thức nhập vào không đúng!");
                return false;
            }
        //}
    }
    </script>
    
    <!-- Some function for rendering LaTeX -->
    <script>
        var p = new Object
      , Zone = !1
      , Cont = !1
      , CDN_URL = "https://olm.vn/"
      , Color = ["#fc9c00", "#00c933", "#ff6666", "#cf99cf", "#119dff", "#8fff16", "#16d0ff", "#1b66ff", "#ff7e00", "#ff2a2a", "#5674b9"]
      , Langs = []
      , speechUrl = "https://cdn2.olm.vn/tospeech.php?text=";
    Langs.vi = {
        guide: "<div class = 'guide'><b><a class = 'guide-toggle' href = 'javascript:;'>Hướng dẫn</a></b><div class = 'guide-more' style = 'display:none;'><ul><li>Kéo/thả phương án đúng vào ô cần điền.</li><li>Hoặc click vào ô cần điền để đánh dấu rồi click vào phương án đúng.</li><li>Để làm lại, ta click vào ô đã điền phương án rồi kéo ra hoặc click đúp vào đó.</li></ul></div></div>",
        click_to_read: "Click vào đây để đọc bài",
        correct: "Đúng",
        wrong: "Sai",
        notgiven: "KXĐ",
        summaries: "Tóm tắt",
        self_check: "Tự luận",
        write_answer: "Viết câu trả lời...",
        suggested_answer: "Hướng dẫn trả lời"
    },
    Langs.en = {
        guide: "",
        click_to_read: "Click to read the topic",
        correct: "T",
        wrong: "F",
        notgiven: "NG",
        summaries: "Summary",
        self_check: "Self check",
        write_answer: "Write your answer here...",
        suggested_answer: "Suggested answer"
    };
    var q_lang = !1
      , myrng = Math.random
      , librariesName = ["graphic", "mathtype", "btds", "svg", "svgdom", "controls", "audio", "recorder", "orange", "clock", "ckeditor"]
      , librariesValue = ["1", "14", "20", "21", "22", "3", "23", "24", "25", "6", "26"];
    function detectJS(html) {
        var tmp_elm = document.createElement("div");
        if (tmp_elm.innerHTML = html,
        0 < $(tmp_elm).find("div.coding").length) {
            var $elm = $(tmp_elm).find("div.coding-in")
              , code = $elm.text()
              , code = $.trim(code.replace(/\u200B/g, ""));
            try {
                eval(code)
            } catch (err) {
                console.error("Lỗi Code: " + err.message)
            }
            var content = tmp_elm.innerHTML
              , vars = content.match(/@(.*?)@/g);
            null != vars && $.each(vars, function(index, value) {
                var xval = value.replace(/@/g, "");
                try {
                    content = content.replace(value, eval(xval))
                } catch (err) {
                    console.error("Lỗi Code: " + err.message)
                }
            }),
            tmp_elm.innerHTML = content,
            $(tmp_elm).find("div.coding").remove()
        }
        return tmp_elm.innerHTML
    }
    function firstCodeDetect($container) {
        var content = $container.html();
        if (0 < $container.find("code.language-javascript").length) {
            var $elm = $container.find("code.language-javascript")
              , code = $elm.text()
              , code = $.trim(code.replace(/\u200B/g, ""));
            try {
                eval(code)
            } catch (err) {
                console.error("Lỗi Code: " + err.message)
            }
            var vars = content.match(/@(.*?)@/g);
            null != vars && $.each(vars, function(index, value) {
                var xval = value.replace(/@/g, "").replace(/\&nbsp;/g, "");
                try {
                    content = content.replace(value, eval(xval))
                } catch (err) {
                    console.error("Lỗi Code: " + err.message)
                }
            })
        }
        return content
    }
    function katexToHtml(t) {
        return katex.renderToString(t, {
            throwOnError: !1
        })
    }
    function katexRenderer(t) {
        t.get(0) && (t.find("span.math-q,span.math-tex").each(function(t, e) {
            var a = htmlDecode(a = e.innerHTML);
            /\\\(|\\\[/.test(a) || (e.innerHTML = "\\(" + a + "\\)"),
            $(e).removeClass("math-q").removeClass("math-tex")
        }),
        renderMathInElement(t.get(0), {
            delimiters: [{
                left: "$$",
                right: "$$",
                display: !0
            }, {
                left: "\\[",
                right: "\\]",
                display: !0
            }, {
                left: "$",
                right: "$",
                display: !1
            }, {
                left: "\\(",
                right: "\\)",
                display: !1
            }]
        }))
    }
    function getEq(t) {
        var a = [];
        return -1 < t.requires.indexOf("14") ? t.find(".math-eq").each(function(t, e) {
            e = (e = MathType.getLatex($(e))).toLowerCase().replace(/\s/g, "");
            a.push(e)
        }) : t.find("input").each(function(t, e) {
            e = (e = e.value).replace(/\s/g, "");
            a.push(e)
        }),
        a
    }
    function vnEqual(t) {
        return t.match(/^[0-9.-]+$/) || -1 == t.indexOf("*") && (t = t.replace(/\./g, "*")),
        t = t.replace(/,/g, ".")
    }
    function equalEq(t, e) {
        if (t += "",
        (e += "").length <= 2)
            return t == e;
        t = vnEqual(t),
        e = vnEqual(e);
        try {
            var a = new btds(t,2)
              , n = new btds(e,2);
            return a.equal(n)
        } catch (t) {
            return void console.log("Không tìm thấy thư viện btds hoặc biểu thức nhập vào không đúng!")
        }
    }
    function params(obj, isLib) {
        var str;
        p.isParamSetted || (str = "",
        $.each(obj, function(t, e) {
            (e instanceof Array || e instanceof Object) && (e = JSON.stringify(e)),
            str += "p." + t + "=" + e + ";"
        }),
        "" == window.jsparam ? window.jsparam = str : isLib && (window.jsparam += str)),
        eval(window.jsparam)
    }
    function saveParams(t, e) {
        params(t, e)
    }
    function require(t) {
        var e = librariesName.indexOf(t);
        -1 < e ? -1 === window.requires.indexOf(librariesValue[e]) && window.requires.push(librariesValue[e]) : console.error("Thư viện " + t + " không tồn tại!")
    }
    function result(t) {
        return t instanceof Array ? {
            answer: t[0],
            result: t[1]
        } : (console.error("Lỗi: Kết quả trả về không đúng cấu trúc!"),
        !1)
    }
    function random(t, e) {
        e = (e = null == e ? 0 : e) - t,
        e = Math.round(myrng() * e);
        return parseInt(t + e)
    }
    function randomArray(t, e, a) {
        if (!(t < 1 || Math.round(a - e) < t)) {
            for (var n = [], i = 0; i < t; i++) {
                do {
                    var r = random(e, a)
                } while (-1 < n.indexOf(r));
                n.push(r)
            }
            return n
        }
        console.error("Giá trị tạo mảng ngẫu nhiên không phù hợp, số phần tử của mảng phải nhỏ hơn miền giá trị. Hãy thay đổi lại.")
    }
    function img(t, e, a) {
        var n = "";
        return null != e && (n += " width = " + e),
        null != a && (n += " height = " + a),
        "<img src = '" + t + "' " + n + ">"
    }
    function imgs(t, e, a, n) {
        for (var i = "", r = 0; r < t; r++)
            i += img(e, a, n);
        return i
    }
    function simPlayer(t, e) {
        if ("show" != p.audioControl) {
            if (-1 < window.requires.indexOf("23") && (!p.audioEffect || -1 < p.audioEffect.indexOf(e))) {
                p.audioSize || (p.audioSize = 100),
                $(t).removeAttr("controls"),
                $(t).addClass("listen"),
                $(t).attr("preload", "none"),
                $(t).attr("data-size", p.audioSize);
                var a = null == e ? "b_player" : "b_player" + e;
                return a = random(1, 1e4) + a,
                $(t).wrap("<div class='mediPlayer " + a + "' data-id = '" + e + "'></div>"),
                void $("." + a).mediaPlayer()
            }
            $(t).removeAttr("controls");
            a = null == e ? "player" : "player" + e;
            $(t).before('<span class="simple-player-container ' + a + '">'),
            $(t).after("</span>");
            var a = $(t).parent().find("." + a).prepend('<a style="text-decoration: none;padding: 0!important;" class="start-button" title = "Phát âm thanh" href="javascript:void(0)"><span class="simpleplayer-play-control"></span></a>')
              , n = t
              , i = a.find("a.start-button");
            n.volume = .8,
            i.click(function() {
                n.paused ? ($.each($("audio"), function() {
                    this.pause(),
                    $(this).parent().find(".simpleplayer-stop-control").addClass("simpleplayer-play-control").removeClass("simpleplayer-stop-control")
                }),
                n.play(),
                $(this).find(".simpleplayer-play-control").addClass("simpleplayer-stop-control").removeClass("simpleplayer-play-control")) : (n.pause(),
                $(this).find(".simpleplayer-stop-control").addClass("simpleplayer-play-control").removeClass("simpleplayer-stop-control"))
            }),
            $(n).bind("ended", function(t) {
                n.pause(),
                i.find(".simpleplayer-stop-control").addClass("simpleplayer-play-control").removeClass("simpleplayer-stop-control")
            }),
            $(n).bind("timeupdate", function(t) {
                duration = this.duration,
                time = this.currentTime,
                fraction = time / duration,
                percent = 100 * fraction
            }),
            0 < n.duration && $(t).parent().css("display", "inline-block"),
            "autoplay" == $(t).attr("autoplay") && i.click()
        }
    }
    function isJson(t) {
        try {
            JSON.parse(t)
        } catch (t) {
            return
        }
        return 1
    }
    function getDigits(t) {
        return (t = Number((Math.round(1e7 * t) / 1e7).toFixed(5))).toString().replace(".", ",")
    }
    function getRound(t, e) {
        t = Math.round(t * Math.pow(10, e)) / Math.pow(10, e),
        t = e - ((e = t % 1 != 0 ? t.toString().replace(".", ",") : t.toString() + ",0").length - e.indexOf(",") - 1);
        return 0 < t && (e += (t = Math.pow(10, t).toString()).substring(1, t.length)),
        e
    }
    function rpsNum(t) {
        return 999 < t ? t <= 999999 ? Math.floor(t / 1e3).toString() + "," + Math.floor(t % 1e3 / 100).toString() + Math.floor(t % 100 / 10).toString() + (t % 10).toString() : Math.floor(t / 1e6).toString() + "," + Math.floor(t % 1e6 / 1e5).toString() + Math.floor(t % 1e5 / 1e4).toString() + Math.floor(t % 1e4 / 1e3).toString() + "," + Math.floor(t % 1e3 / 100).toString() + Math.floor(t % 100 / 10).toString() + (t % 10).toString() : t
    }
    function compare(t, e) {
        return e < t ? [">", "=", "<"] : t < e ? ["<", "=", ">"] : ["=", "<", ">"]
    }
    function rand(t, e, a, n) {
        var r = []
          , s = Math.min(e, a);
        for (right = Math.max(e, a),
        i = s; i <= right; i++)
            r.push(i);
        for (i = 0; i < n.length; i++)
            r.includes(n[i]) && r.splice(r.indexOf(n[i]), 1);
        if (!(t > r.length)) {
            if (t == r.length) {
                s = shuffle(r, !0);
                return 1 == t ? s[0] : s
            }
            var o = [];
            for (i = 0; i < r.length; i++)
                o.push(i);
            var c = shuffle(o, !0)
              , l = [];
            for (i = 0; i < t; i++)
                l.push(r[c[i]]);
            return 1 == t ? l[0] : l
        }
        console.error("mảng không phù hợp")
    }
    function setCanvas(t, e) {
        var a = document.createElement("canvas");
        return a.width = t,
        a.height = e,
        a
    }
    function drawCanvas(t, e) {
        p.canvasE.push(t),
        p.canvas.push(e)
    }
    function drawingCanvas(t, e) {
        for (var a = 0; a < p.canvasE.length; a++) {
            var n = p.canvas[a];
            t.find("." + p.canvasE[a]).each(function(t, e) {
                $(e).attr("width", n.width).attr("height", n.height),
                destinationCtx = e.getContext("2d"),
                destinationCtx.drawImage(n, 0, 0)
            })
        }
        p.event(t),
        1 < p.quizState && t.find("*").unbind("click"),
        e || p.svg(t),
        t.find("audio").each(function(t, e) {
            simPlayer(e, t)
        }),
        "object" == typeof p.hint && setTimeout(function() {
            t.find(".olm-hint").show()
        }, p.hint.time)
    }
    function viFilter(t) {
        var e = "àáạảãâầấậẩẫăằắặẳẵèéẹẻẽêềếệểễìíịỉĩòóọỏõôồốộổỗơờớợởỡùúụủũưừứựửữỳýỵỷỹđ";
        e += e.toUpperCase();
        var a = "aaaaaaaaaaaaaaaaaeeeeeeeeeeeiiiiiooooooooooooooooouuuuuuuuuuuyyyyyd";
        a += a.toUpperCase();
        for (var n = 0, i = e.length; n < i; n++)
            t = t.replace(new RegExp(e.charAt(n),"g"), a.charAt(n));
        return t = t.replace(/('|’|‘)/g, "")
    }
    function isMultiQuiz(t) {
        var e = /\d[\.\:]\s+/gm;
        return t.match(e) && 1 < t.match(e).length
    }
    function shuffle(t, e) {
        t = t.slice(0);
        if (0 == p.shuffle && !0 !== e)
            return t;
        var a, n, i = t.length;
        if (i)
            for (; --i; )
                a = t[n = Math.floor(myrng() * (i + 1))],
                t[n] = t[i],
                t[i] = a;
        return t
    }
    function imgToBg(t) {
        t.find("img").each(function(t, e) {
            var a = $(e).attr("src")
              , n = $(e).width()
              , i = $(e).height();
            $(e).replaceWith("<span style = 'display:block;width:" + n + "px; height:" + i + "px;background-image:url(" + a + "); '></span>")
        })
    }
    function htmlDecode(t) {
        return $("<div/>").html(t).text().replace(/\$/g, "")
    }
    function inputText(t, e, a) {
        $drag = $(e),
        $drop = $(t),
        "" == $drop.html() || a ? $drag.fadeOut(function() {
            $drag.appendTo($drop).show().fadeIn()
        }) : (t = $drag.html(),
        a = $drop.children().html(),
        $drag.html(a),
        $drop.children().html(t)),
        $drop.css({
            width: ""
        })
    }
    function dropOver(t, e) {
        var a = $(t).get(0).offsetWidth
          , e = e.get(0).offsetWidth;
        a < e && $(t).css({
            width: e
        })
    }
    function dropOut(t, e) {
        $(t).css({
            width: ""
        })
    }
    function fixedUntilPoint(e) {
        var a = Math.round(e.offset().top)
          , n = window.innerHeight;
        function t() {
            var t = !1;
            Math.round($(window).scrollTop()) + n < a ? t || (e.css({
                position: "fixed",
                "z-index": 999,
                bottom: "20px",
                "min-width": "789px"
            }),
            t = !0) : (e.css({
                position: "unset",
                "z-index": 0
            }),
            t = !1)
        }
        t(),
        $(function() {
            $(window).scroll(t),
            t()
        })
    }
    function loadScript(t) {
        var e = document.createElement("script");
        e.defer = "true",
        e.type = "text/javascript",
        e.src = t,
        document.head.appendChild(e)
    }
    function mergeVar(holder) {
        var content = holder.html()
          , vars = content.match(/@(.*?)@/g);
        null != vars && $.each(vars, function(index, value) {
            var xval = value.replace(/@/g, "").replace(/\&nbsp;/g, "");
            try {
                content = content.replace(value, eval(xval))
            } catch (err) {
                console.error("Lỗi Code: " + err.message)
            }
        }),
        holder.html(content)
    }
    function inherit(t, e) {
        function a() {}
        a.prototype = e.prototype,
        t.prototype = new a,
        (t.prototype.constructor = t).super = e
    }
    window.jsparam = "",
    window.requires = [],
    window.tmpScript = "",
    window.detectQuestion = function(content, __data, config) {
        void 0 === config ? config = {
            lang: "vi"
        } : "string" == typeof config && (config = {
            lang: config
        }),
        void 0 === config.lang && (config.lang = "vi"),
        q_lang = Langs[config.lang],
        myrng = void 0 !== config.seedrandom ? new Math.seedrandom(config.seedrandom) : new Math.seedrandom,
        config.cdn && (CDN_URL = config.cdn),
        void 0 === config.latex && (config.latex = !0),
        p = new Object,
        p.makeExp = !1,
        p.canvasE = [],
        p.canvas = [],
        p.shuffle = 1,
        p.audioControl = "hide",
        p.mathFont = !0,
        p.latex = config.latex,
        p.clickOnlyInQuiz = !1,
        p.quizState = 1,
        p.styles = !1,
        p.isParamSetted = !1;
        var container = document.createElement("div"), _params;
        $(container).html(content),
        p.canvasE = [],
        p.canvas = [],
        p.now = Math.round((new Date).getTime() % 1e7),
        p.event = function() {}
        ,
        p.svg = function() {}
        ,
        p.svgExp = function() {}
        ,
        p.check = !1,
        p.hint = !1,
        window.jsparam = "",
        window.requires = [],
        window.tmpScript = "",
        __data && ("{}" == __data.params && (__data.params = void 0),
        this.save_data = __data,
        __data.params && (_params = JSON.parse(__data.params),
        _params.js && (window.jsparam = _params.js,
        p.isParamSetted = !0))),
        p.innerContent = container.innerHTML,
        p.innerContent = firstCodeDetect($(container));
        var coding = !1, _html, vars, $elm;
        if (0 < $(container).find("code.language-javascript").length) {
            coding = !0;
            var $elm = $(container).find("code.language-javascript")
              , code = $elm.text()
              , code = $.trim(code.replace(/\u200B/g, ""));
            try {
                eval(code),
                "" !== window.tmpScript && eval(window.tmpScript)
            } catch (err) {
                console.error("Lỗi Code: " + err.message)
            }
            var vars = content.match(/@(.*?)@/g);
            null != vars && $.each(vars, function(index, value) {
                var xval = value.replace(/@/g, "").replace(/\&nbsp;/g, "");
                try {
                    content = content.replace(value, eval(xval))
                } catch (err) {
                    console.error("Lỗi Code: " + err.message)
                }
            })
        }
        "object" == typeof p.hint && (_html = "<div class = 'olm-hint' style = 'display:none;'><button class = 'btn btn-primary' onclick = 'return showReading(this);'><b class='icon icon-white icon-bookmark'></b> " + p.hint.title + "</button>",
        _html += "<div class='reading-in' style='display: none;background: #fff;border: solid #3b8dd4 2px;'>" + p.hint.content + "</div></div>",
        "bottom" === p.hint.position ? content += _html : content = _html + content,
        null == p.hint.time && (p.hint.time = 1),
        p.hint.time = 1e3 * p.hint.time),
        p.mathFont || (content = "<style>.mathdefault,.katex,.katex-html,.mathnormal{font-family: Muli, sans-serif!important;font-style: normal!important;}</style>" + content),
        p.styles && (content = "<style type='text/css'>" + p.styles + "</style>" + content),
        content = content.replace(/https:\/\/olm.vn\//g, CDN_URL),
        content = content.replace(/[\u200B-\u200D\uFEFF]/g, "").replace(/{matrix}/gm, "{aligned}"),
        content = content.replace(/\$&gt;/gm, "$ &gt;").replace(/\$&lt;/gm, "$ &lt;").replace(/’/gm, "'").replace(/\\mspace{\w+}/gm, ""),
        container.innerHTML = content,
        $(container).find("code.language-javascript").parent().remove(),
        $(container).find("code.language-html").each(function(t, e) {
            var a = $(e).html()
              , a = $("<div/>").html(a).text();
            $(e).parent().replaceWith(a)
        }),
        p.latex && (content = container.innerHTML,
        vars = content.match(/\$(.*?)\$/g),
        null != vars && $.each(vars, function(t, e) {
            var a = e.replace(/\$/g, "").replace(/\&nbsp;/g, "");
            try {
                content = content.replace(e, "$" + a.replace(/(<([^>]+)>)/gi, "") + "$")
            } catch (t) {
                console.error("Lỗi Latex rendering: " + t.message)
            }
        }),
        container.innerHTML = content),
        0 < $(container).find("div.reading").length && ($elm = $(container).find("div.reading"),
        $elm.find("h3").replaceWith("<button class = 'btn btn-success' onclick = 'return showReading(this);'><b class='icon icon-white icon-search'></b> " + q_lang.click_to_read + "</button>"),
        $elm.find("div.reading-in").hide(),
        $(container).prepend("<div>" + $elm.html() + "</div>"),
        $elm.remove()),
        0 < $(container).find("span.mark-audio").length && $(container).find("span.mark-audio").each(function(t, e) {
            var a = $.trim($(e).text());
            $(e).html("<audio controls src = '" + speechUrl + a + "' ></audio>")
        }),
        katexRenderer($(container)),
        $(container).find(".mpunct").each(function(t, e) {
            "," == $(e).text() && $(e).next().removeAttr("style")
        }),
        $(container).find("span.katex").css({
            "font-size": "1em"
        });
        var Boss = new Object;
        return 0 < $(container).find(".advance").length ? Boss = new Advance : 0 < $(container).find(".advance2").length ? Boss = new Advance2 : 1 === $(container).find(".quiz-list").length ? Boss = new QuizX : 1 < $(container).find(".quiz-list").length ? Boss = new QuizList : 0 < $(container).find(".dragtext").length ? Boss = new DragText : 0 < $(container).find(".dragmore").length ? Boss = new DragMore : 0 < $(container).find(".two-list").length ? Boss = new TwoList : 0 < $(container).find(".sort-list").length ? Boss = new SortList : 0 < $(container).find(".link-list").length ? Boss = new LinkList : 0 < $(container).find(".under-list").length ? Boss = new UnderList : 0 < $(container).find(".under-line").length ? Boss = new UnderLine : 0 < $(container).find(".group-list").length ? Boss = new GroupList : 0 < $(container).find(".merge-list").length ? Boss = new MergeList : 0 < $(container).find(".selecttext").length ? Boss = new SelectText : 0 < $(container).find(".findwrong").length ? Boss = new FindWrong : 0 < $(container).find(".true-false").length ? Boss = new TrueFalse : 0 < $(container).find(".theory").length ? Boss = new Theory : 0 < $(container).find(".flashcard").length ? Boss = new FlashCard : 0 < $(container).find(".recorder").length ? Boss = new Recorder : 0 < $(container).find("input").length ? Boss = new FillMe : (require("ckeditor"),
        Boss = new Paragraph,
        Boss.bttl = !0),
        Boss.init(container),
        Boss.p = p,
        Boss.isCode = coding,
        Boss.params.js = window.jsparam,
        Boss.requires = window.requires,
        null != __data && Boss.setSaveData(__data),
        Boss
    }
    ,
    window.showReading = function(t) {
        $(t).parent().find(".reading-in").toggle()
    }
    ;
    var Base = function() {
        this.bttl = !1,
        this.tmp = !1,
        this.save_data = !1,
        this.tmpHtml = "",
        this.params = {},
        this.exp = "",
        this.isTest = !1,
        this.isEditable = !1,
        this.viewans = !0,
        this.isTheory = !1,
        this.isFlashcard = !1,
        this.isCode = !1,
        this.fillFull = !1,
        this.accept = !1,
        this.multi = !1,
        this.start = 1,
        this.name_start = "Câu",
        this.setStart = function(t, e) {
            this.name_start = t,
            this.start = e
        }
        ,
        this.getExp = function(t) {
            !1 !== p.makeExp ? (Zone = t,
            p.makeExp(t)) : "" != this.exp && null != this.exp && t.html(this.exp),
            p.svgExp(t),
            drawingCanvas(t, !0)
        }
        ,
        this.hasExp = function() {
            return "" != this.exp && null != this.exp
        }
        ,
        this.getSaveData = function() {
            return this.save_data
        }
        ,
        this.getParams = function() {
            return this.params
        }
        ,
        this.setParams = function(t) {
            this.params = t,
            this.save_data = {},
            this.save_data.params = JSON.stringify(t)
        }
        ,
        this.setSaveData = function(t) {
            this.save_data = t
        }
        ,
        this.setTest = function(t) {
            t = t || !1,
            this.isTest = !0,
            this.viewans = t
        }
        ,
        this.setEdit = function() {
            this.isEditable = !0
        }
        ,
        this.setFill = function() {
            this.fillFull = !0
        }
        ,
        this.getCorrect = function() {
            return this.correct || !1
        }
        ,
        this.init = function(t) {
            this.tmp = $(t),
            this.tmpHtml = t.innerHTML,
            this.exp = $(t).find(".exp").html()
        }
        ,
        this.initQuestion = function(t, e) {
            return this.save_data && this.save_data.answer ? this.makeQuestionH(t) : this.makeQuestion(t)
        }
        ,
        this.getMany = function() {
            return [this]
        }
        ,
        this.getNumberQuiz = function() {
            return 1
        }
        ,
        this.getCorrectSign = function() {
            return ""
        }
        ,
        this.getHtmlQuestion = function() {
            return ""
        }
    }
      , QuizX = (inherit(Gd, Base),
    Gd);
    function Gd() {
        this.constructor.super.call(this),
        this.correct = [],
        this.qhtml = "",
        this.correctSign = [],
        this.tabStop = 1,
        this.QLABEL = ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M"],
        this.accept = !0;
        var k = this;
        this.idq = function() {
            return 1
        }
        ,
        this.initQuestion = function(t, e) {
            if (!1 === k.save_data || !k.save_data.answer)
                return this.makeQuestion(t, e.abcdSign, e.isAnswer);
            this.makeQuestion(t, e.abcdSign, e.isAnswer);
            var a, t = t.find(".quiz-list");
            2 != k.save_data.result && "" != k.save_data.answer && (a = 0 <= (a = k.save_data ? k.save_data.answer : "[]").indexOf(":") ? a.split(":") : JSON.parse(a),
            t.find(".qselect").each(function(t, e) {
                $e = $(e),
                "" != k.save_data.answer && -1 != a.indexOf($e.attr("data-ind")) && $e.addClass("qchecked")
            }))
        }
        ,
        this.makeQuestion = function(a, t, e) {
            p = k.p,
            k.tmpHtml = detectJS(k.tmpHtml),
            a.html(k.tmpHtml);
            var n = a.get(0).offsetWidth - 45;
            if (a.find(".exp").remove(),
            a.find("span.math-q").removeAttr("style"),
            a.find("li audio").css("width", "100px"),
            "" == k.qhtml) {
                var i = a.find(".quiz-list").addClass("abso")
                  , r = []
                  , s = []
                  , o = 0
                  , c = 0;
                i.find("li").each(function(t, e) {
                    var a = $(e).get(0);
                    a.offsetWidth > o && (o = a.offsetWidth),
                    a.offsetHeight > c && (c = a.offsetHeight),
                    r.push(e.innerHTML),
                    s.push(t),
                    $(e).hasClass("correctAnswer") && k.correct.push(t)
                }),
                k.save_data && void 0 !== k.save_data.params && null !== k.save_data.params ? k.params = JSON.parse(k.save_data.params) : void 0 === k.params.order && (k.params.order = shuffle(s)),
                o += 30;
                var l = 100;
                p.horizon ? l = Math.floor(100 / s.length) : (o * s.length < n ? l = Math.floor(100 / s.length) : o * s.length < 2 * n ? l = Math.floor(200 / s.length) : 2 * o < n && (l = 50),
                51 < l && (l = 100)),
                k.tabStop = Math.floor(100 / l);
                var d = 0 < a.find(".quiz-list .katex").length;
                null == p.withSelect && (p.withSelect = !1);
                var h = "<span class = 'qcheckbox'></span>";
                1 == k.correct.length && (h = "<span class = 'qiradio'></span>");
                var u = "qsign lala";
                (0 < a.find(".quiz-list img").length || 0 < a.find(".quiz-list svg").length) && !d && (p.withSelect || (h = ""),
                u = "qimage lala"),
                -1 < window.requires.indexOf("23") && 0 < a.find(".quiz-list audio").length && (p.withSelect || (h = ""),
                u = "qimage lala");
                for (var f = 0; f < k.params.order.length; f++) {
                    var m = r[k.params.order[f]]
                      , v = k.QLABEL[f];
                    1 == k.correct.length && 100 == l && c <= 41 && "" != h && d && !p.withSelect && (h = "<div class='mark'>" + v + "</div>");
                    var g = ""
                      , w = t ? "." : "";
                    -1 < k.correct.indexOf(k.params.order[f]) && e && (g = "qchecked"),
                    "abc" != p.withSelectX && !t || (h = "<div class='mark'>" + v + w + "</div>"),
                    k.qhtml += "<div data-ind='" + k.params.order[f] + "' class='qselect " + g + "'>" + h + "<div class = '" + u + "'>" + m + "</div></div>"
                }
                i.removeClass("abso").replaceWith("<div class = 'quiz-list'>" + k.qhtml + "</div>"),
                l < 100 && !p.vertical && (--l,
                (i = a.find(".quiz-list")).find(".qselect").each(function(t, e) {
                    $(e).css({
                        display: "inline-block",
                        width: l + "%"
                    })
                })),
                41 < c && a.find(".quiz-list>img").each(function(t, e) {
                    $(e).css({
                        height: c
                    })
                }),
                k.qhtml = a.find(".quiz-list").html()
            } else
                a.find(".quiz-list").replaceWith("<div class = 'quiz-list'>" + k.qhtml + "</div>");
            drawingCanvas(a),
            a.find(".qselect").each(function(t, e) {
                e.onclick = function() {
                    1 == k.correct.length && a.find("div.qchecked").removeClass("qchecked"),
                    $(this).hasClass("qchecked") ? $(this).removeClass("qchecked") : $(this).addClass("qchecked")
                }
            })
        }
        ,
        this.getHtmlQuestion = function(t) {
            var n = k.p.innerContent
              , e = n.match(/\$(.*?)\$/g);
            null != e && $.each(e, function(t, e) {
                var a = e.replace(/\$/g, "").trim();
                try {
                    n = n.replace(e, "$" + a.replace(/(<([^>]+)>)/gi, "") + "$")
                } catch (t) {
                    console.error("Lỗi Latex rendering: " + t.message)
                }
            });
            var e = document.createElement("div")
              , a = [];
            e.innerHTML = n.replace(/(\r\n|\n|\r|<p>(&nbsp;)+<\/p>|<p>\s+<\/p>|<o:\w><\/o:\w>)/gm, "").replace(/<o:p>/gm, "<span>").replace(/<\/o:p>/gm, "</span>"),
            $(e).find("p").removeAttr("class").removeAttr("style"),
            $(e).find("li").each(function(t, e) {
                a.push(e.innerHTML)
            }),
            $(e).find(".exp").remove(),
            $(e).find(".quiz-list").remove(),
            $(e).find(".language-javascript").remove(),
            e.innerHTML = "<div data-attr = 'Question'>" + e.innerHTML + "</div>";
            for (var i = "", r = "", s = "", o = 0; o < k.params.order.length; o++)
                r = k.QLABEL[o] + ".",
                "" !== s && (s += " &otab;"),
                s += "<strong>" + (r = t && -1 < k.correct.indexOf(k.params.order[o]) ? "<span data-attr = 'underlineBlue'>" + r + "</span>" : "<span data-attr = 'blueColor'>" + r + "</span>") + "</strong>&nbsp;" + a[k.params.order[o]],
                1 === k.tabStop ? (i += "<div data-attr = 'Tab1'>" + s + "</div>",
                s = "") : 2 === k.tabStop && (o + 1) % 2 == 0 ? (i += "<div data-attr = 'Tab2'>" + s + "</div>",
                s = "") : o + 1 === k.params.order.length && (i += "<div data-attr = 'Tab4'>" + s + "</div>");
            return e.innerHTML += i,
            e.innerHTML
        }
        ,
        this.makeQuestionH = function(t, e, a) {
            p.quizState = 2,
            this.makeQuestion(t, e, a);
            var n, a = t.find(".quiz-list");
            2 != k.save_data.result && "" != k.save_data.answer && (void 0 === (n = k.save_data ? k.save_data.answer : "[]") && (n = "[]"),
            n = 0 <= n.indexOf(":") ? n.split(":") : JSON.parse(n),
            a.find(".qselect").each(function(t, e) {
                $e = $(e),
                "" != k.save_data.answer && -1 != n.indexOf($e.attr("data-ind")) && $e.addClass("qchecked"),
                k.viewans && !k.isEditable && (e.onclick = null)
            }),
            k.viewans && t.find(".qselect ").each(function(t, e) {
                var a = $(this).data("ind");
                -1 < k.correct.indexOf(a) ? $(e).addClass("correctq") : $(e).hasClass("qchecked") && $(e).addClass("wrongq"),
                k.isEditable || (e.onclick = null)
            }))
        }
        ,
        this.makeCorrectAns = function(t) {
            p.quizState = 3,
            k.p.shuffle = 0,
            this.makeQuestion(t),
            t.find(".quiz-list").find(".qselect").each(function(t, e) {
                var a = $(this).data("ind");
                -1 < k.correct.indexOf(a) && $(e).addClass("qcorrect"),
                e.onclick = null
            })
        }
        ,
        this.check = function(t) {
            var e = 2
              , a = []
              , n = []
              , i = t.find(".qchecked");
            if (0 < i.length) {
                for (var r = 0; r < i.length; r++)
                    a.push(i[r].getAttribute("data-ind"));
                a.sort(),
                k.correct.sort();
                e = a.join(":") == k.correct.join(":") ? 1 : 0
            }
            for (r = 0; r < k.params.order.length; r++)
                for (var s = 0; s < a.length; s++)
                    k.params.order[r] == a[s] && n.push(k.QLABEL[r]);
            return k.save_data = {
                answer: JSON.stringify(a),
                label: n,
                params: JSON.stringify(k.params),
                result: e
            },
            2 == e || k.viewans && t.find(".qselect ").each(function(t, e) {
                var a = $(this).data("ind");
                -1 < k.correct.indexOf(a) ? $(e).addClass("correctq") : $(e).hasClass("qchecked") && $(e).addClass("wrongq"),
                e.onclick = null
            }),
            e
        }
        ,
        this.getCorrectSign = function() {
            return this.correctSign
        }
    }
    var FillMe = (inherit(df, Base),
    df);
    function df() {
        this.constructor.super.call(this),
        this.correct = [],
        this.correctx = [],
        this.mathq = !1,
        this.btds = !1,
        this.reCheck = !1,
        this.accept = !0,
        this.numberQuiz = 1,
        this.p = {};
        var c = this;
        this.idq = function() {
            return 2
        }
        ,
        this.getNumberQuiz = function() {
            return this.numberQuiz
        }
        ,
        this.getMany = function() {
            var t = document.createElement("div");
            t.innerHTML = c.tmpHtml,
            isMultiQuiz(t.innerText) ? c.numberQuiz = $(t).find("input").length : c.numberQuiz = 1
        }
        ,
        this.initQuestion = function(t, e) {
            if (!1 === c.save_data || !c.save_data.answer)
                return c.makeQuestion(t);
            var a, n;
            c.makeQuestion(t),
            n = c.save_data.answer instanceof Array ? c.save_data.answer : (a = htmlDecode(c.save_data.answer),
            console.log(c.save_data),
            JSON.parse(a)),
            c.mathq ? t.find(".math-eq").each(function(t, e) {
                t = (t = n[t]).toString().toLowerCase().replace(/\s/g, "");
                null == p.toolbar && (p.toolbar = ["sqrt", "x_sqrt", "sqr", "frac"]),
                null == p.toolbarPos && (p.toolbarPos = "bottom"),
                MathType.init($(e), {
                    position: p.toolbarPos,
                    toolbars: p.toolbar,
                    default: t
                })
            }) : t.find("input").each(function(t, e) {
                n[t] && ($(e).val(n[t]),
                size = 15 * $(e).val().length,
                20 < size && $(e).css("width", size))
            })
        }
        ,
        this.makeQuestion = function(t, e) {
            var a;
            c.tmpHtml = detectJS(c.tmpHtml),
            c.mathq = -1 < window.requires.indexOf("14"),
            c.btds = -1 < window.requires.indexOf("20"),
            "function" == typeof p.check && (c.reCheck = p.check),
            c.correct = [],
            c.correctx = [],
            a = p.noCheck || p.selfCheck ? "<div class = 'theorycal'><span class='right'> " + q_lang.self_check + " </span></div>" : "",
            (p.noCheck || p.selfCheck) && 1 === e && 3 === p.quizState && (a += "<p class = 'suggested-answer'><i>(" + q_lang.suggested_answer + ")</i></p>"),
            t.html("<div class = 'fill-me'>" + a + c.tmpHtml + "</div>"),
            t.find(".exp").remove(),
            t.find("span.math-q").removeAttr("style"),
            t.find("input").each(function(t, e) {
                var a = $(e).css("font-size")
                  , n = htmlDecode(n = $(e).attr("data-accept"));
                _correct = n.toLowerCase().replace(/\s/g, "").replace(/̀/g, "").replace(/́/g, ""),
                this.fillFull || (_correct = viFilter(_correct)),
                correctxs = 0 < _correct.indexOf("||") ? (corrects = _correct.split("||"),
                n.split("||")) : (corrects = _correct.split(";"),
                n.split(";"));
                for (var i = 0; i < corrects.length; i++)
                    corrects[i] = $.trim(corrects[i]);
                c.correct.push(corrects),
                c.correctx.push(correctxs),
                c.mathq ? $(e).replaceWith("<span class = 'math-eq'></span>") : ($(e).css("width", "20px"),
                $(e).get(0).type = "text",
                $(e).keyup(function() {
                    var t = 15 * $(this).val().length;
                    32 < a && (t = t * a / 32),
                    20 < t ? $(this).css("width", t) : $(this).css("width", 20)
                }),
                0 == t && $(e).focus(),
                $(e).removeAttr("data-accept"))
            }),
            1 != e && t.find(".math-eq").each(function(t, e) {
                null == p.toolbar && (p.toolbar = ["sqrt", "x_sqrt", "sqr", "frac"]),
                null == p.toolbarDefault && (p.toolbarDefault = ""),
                null == p.toolbarPos && (p.toolbarPos = "bottom"),
                MathType.init($(e), {
                    position: p.toolbarPos,
                    toolbars: p.toolbar,
                    default: p.toolbarDefault
                })
            }),
            t.find("foreignObject input").css({
                position: "absolute",
                margin: "8px"
            }),
            drawingCanvas(t)
        }
        ,
        this.makeQuestionH = function(t) {
            var e, i;
            p.quizState = 2,
            this.makeQuestion(t, 1),
            2 != c.save_data.result && "" != c.save_data.answer && (e = htmlDecode(c.save_data.answer),
            i = JSON.parse(e),
            c.mathq ? (t.find(".math-eq").each(function(t, e) {
                var a = c.correct[t]
                  , t = i[t];
                t && (t = t.toString().toLowerCase().replace(/\s/g, ""),
                e.innerHTML = katex.renderToString(t, {
                    throwOnError: !1
                }),
                "function" != typeof p.check && (c.btds ? equalEq(a[0], t) ? $(e).addClass("ocorrect") : $(e).addClass("owrong") : -1 == a.indexOf(t) ? $(e).addClass("owrong") : $(e).addClass("ocorrect")))
            }),
            t.find(".mpunct").each(function(t, e) {
                "," == $(e).text() && $(e).next().removeAttr("style")
            })) : t.find("input").each(function(t, e) {
                var a = c.correct[t]
                  , n = i[t];
                n && ($(e).val(i[t]),
                size = 15 * $(e).val().length,
                20 < size && $(e).css("width", size),
                "function" != typeof p.check && (c.btds ? equalEq(a[0], n) ? $(e).addClass("ocorrect") : $(e).addClass("owrong") : (n = n.toString().toLowerCase().replace(/\s/g, ""),
                this.fillFull || (n = viFilter(n)),
                -1 == a.indexOf(n) ? $(e).addClass("owrong") : $(e).addClass("ocorrect")))),
                $(e).prop("disabled", !0)
            }))
        }
        ,
        this.makeCorrectAns = function(t) {
            p.quizState = 3,
            this.makeQuestion(t, 1),
            c.mathq ? (t.find(".math-eq").each(function(t, e) {
                e.innerHTML = katex.renderToString(c.correctx[t][0], {
                    throwOnError: !1
                })
            }),
            t.find(".mpunct").each(function(t, e) {
                "," == $(e).text() && $(e).next().removeAttr("style")
            })) : t.find("input").each(function(t, e) {
                $(e).val(c.correctx[t][0]),
                size = 15 * $(e).val().length,
                20 < size && $(e).css("width", size),
                $(e).prop("disabled", !0)
            })
        }
        ,
        this.check = function(t) {
            if (!1 !== c.reCheck)
                return Zone = t,
                p = c.p,
                Zone.requires = c.requires,
                (i = c.reCheck()).answer instanceof Array || (i.answer = [i.answer]),
                c.save_data = {
                    answer: JSON.stringify(i.answer),
                    params: JSON.stringify(c.params),
                    result: i.result
                },
                i.result;
            var i = []
              , r = 0
              , s = 1
              , o = [];
            return c.mathq ? t.find(".math-eq").each(function(t, e) {
                var a = MathType.getLatex($(e))
                  , n = /\\text{(\d+(?:[.,]\d+)?)}/;
                n.test(a) && (a = n.exec(a)[1]),
                "" == (a = a.toLowerCase().replace(/\s/g, "").replace(/\$/g, "")) && 0 == r && (r = 2);
                n = c.correct[t];
                i.push(a),
                c.btds ? equalEq(n[0], a) ? o[t] = 1 : (s = 0,
                o[t] = 0) : -1 == n.indexOf(a) ? (c.viewans && $(e).addClass("owrong"),
                s = 0,
                o[t] = 0) : (o[t] = 1,
                c.viewans && $(e).addClass("ocorrect"))
            }) : t.find("input").each(function(t, e) {
                var a = (a = e.value).toLowerCase().replace(/\s/g, "");
                this.fillFull || (a = viFilter(a)),
                "" == a && 0 == r && (r = 2);
                var n = c.correct[t];
                i.push(e.value),
                c.btds ? equalEq(n[0], a) ? o[t] = 1 : (s = 0,
                o[t] = 0) : -1 == n.indexOf(a) ? (c.viewans && $(e).addClass("owrong"),
                s = 0,
                o[t] = 0) : (o[t] = 1,
                c.viewans && $(e).addClass("ocorrect"))
            }),
            2 == r && (s = 2),
            (p.noCheck || p.selfCheck) && (s = 4),
            c.save_data = {
                answer: JSON.stringify(i),
                params: JSON.stringify(c.params),
                result: o
            },
            s
        }
    }
    var DragText = (inherit(mg, Base),
    mg);
    function mg() {
        this.constructor.super.call(this),
        this.correct = [],
        this.selects = [],
        this.style = "",
        this.accept = !0,
        this.numberQuiz = 1;
        var l = this;
        this.idq = function() {
            return 3
        }
        ,
        this.getNumberQuiz = function() {
            return this.numberQuiz
        }
        ,
        this.getMany = function() {
            var t = document.createElement("div");
            t.innerHTML = l.tmpHtml,
            isMultiQuiz(t.innerText) ? l.numberQuiz = $(t).find(".dragtext").length : l.numberQuiz = 1
        }
        ,
        this.initQuestion = function(t, e) {
            if (!1 === l.save_data || !l.save_data.answer)
                return l.makeQuestion(t);
            l.makeQuestion(t);
            var a = JSON.parse(l.save_data.answer);
            t.find(".dragtext").each(function(t, e) {
                null != a[t] && (t = "<span class = 'drag-select'>" + (t = "<span " + l.style + " data-id = '" + a[t] + "'>" + l.selects[a[t]] + "</span>") + "</span>",
                e.innerHTML = t)
            }),
            t.find(".item-drag .drag-select").each(function(t, e) {
                -1 < a.indexOf($(e).find("span").attr("data-id")) && $(e).remove()
            })
        }
        ,
        this.makeQuestion = function(e, t) {
            l.tmpHtml = detectJS(l.tmpHtml),
            l.selects = [],
            l.correct = [],
            e.html(l.tmpHtml),
            e.find(".exp").remove();
            var a = [];
            e.find(".dragtext").each(function(t, e) {
                $(e).attr("ondrop", "drop(event)").attr("ondragover", "allowDrop(event)").attr("ondragleave", "dragLeave(event)").attr("canreturn", "false");
                var a = e.innerHTML;
                a = 0 < (a = htmlDecode(a)).indexOf("||") ? a.split("||") : a.split(";"),
                l.correct.push(a[0]),
                l.selects = l.selects.concat(a),
                e.innerHTML = "",
                $(e).css({
                    padding: 0
                }),
                $(e).removeAttr("data-accepts")
            });
            for (var n = 0; n < l.selects.length; n++)
                a.push(n);
            var i = l.style = "";
            l.save_data && void 0 !== l.save_data.params && null !== l.save_data.params ? l.params = JSON.parse(l.save_data.params) : void 0 === l.params.order && (l.params.order = shuffle(a));
            if (i += "<div style = 'clear: both;'><div class = 'item-drag' ondrop='drop(event)' ondragover='allowDrop(event)' canreturn = 'true'>",
            2 != t && 1 != t)
                for (n = 0; n < l.selects.length; n++)
                    i += "<span id = 'de" + p.now + random(1, 1e3) + "' class = 'drag-select' draggable='true' ondragstart='drag(event)'><span data-id = '" + l.params.order[n] + "' " + l.style + ">" + l.selects[l.params.order[n]] + "</span></span>";
            i += "</div><p style = 'font-size: 14px;'><i>(Kéo thả hoặc click vào để điền)</i></p></div>",
            e.append(i),
            t || this.isTest || fixedUntilPoint(e.find(".item-drag"));
            var r, s = e.find(".item-drag"), o = e.find(".dragtext"), c = [];
            if (e.find(".dragtext").each(function(t, e) {
                (r = $(e).attr("data-id")) && (c[parseInt(r)] = o[t])
            }),
            o.length === c.length)
                for (n = 0; n < o.length; n++)
                    o[n] = c[n];
            o.first().addClass("selectpoint"),
            o.on("click", function(t, e) {
                o.removeClass("selectpoint"),
                $(this).addClass("selectpoint"),
                0 < $(this).find(".drag-select").length && inputText(s, $(this).find(".drag-select"), !0)
            }),
            e.find(".item-drag>.drag-select").on("click", function() {
                var t, a;
                $(this).parent().hasClass("dragtext") || 0 < (t = e.find(".selectpoint")).length && (inputText(t, this),
                a = !1,
                setTimeout(function() {
                    for (var t = 0; t < o.length; t++) {
                        var e = o[t];
                        if ($(e).hasClass("selectpoint") && ($(e).removeClass("selectpoint"),
                        a = !0),
                        a)
                            if (0 == (e = t === o.length - 1 ? $(o[0]) : $(o[t + 1])).find("span").length) {
                                e.addClass("selectpoint");
                                break
                            }
                    }
                }, 700))
            }),
            e.find(".guide-toggle").on("click", function() {
                e.find(".guide-more").toggle()
            }),
            drawingCanvas(e)
        }
        ,
        this.makeQuestionH = function(t) {
            var n;
            p.quizState = 2,
            this.makeQuestion(t, 1),
            "" != l.save_data.answer && (n = JSON.parse(l.save_data.answer),
            t.find(".dragtext").each(function(t, e) {
                var a;
                null != n[t] && (a = "<span class = 'drag-select'>" + (a = "<span " + l.style + " data-id = '" + n[t] + "'>" + l.selects[n[t]] + "</span>") + "</span>",
                e.innerHTML = a,
                l.selects[n[t]] != l.correct[t] ? $(e).addClass("xwrong") : $(e).addClass("xcorrect"))
            }))
        }
        ,
        this.makeCorrectAns = function(t) {
            p.quizState = 3,
            this.makeQuestion(t, 2),
            t.find(".dragtext").each(function(t, e) {
                t = "<span class = 'drag-select'>" + (t = "<span " + l.style + ">" + l.correct[t] + "</span>") + "</span>";
                e.innerHTML = t
            })
        }
        ,
        this.check = function(t) {
            var n = []
              , i = 0
              , r = 1
              , s = [];
            return t.find(".dragtext").each(function(t, e) {
                $e = $(e).children();
                var a = $e.text()
                  , e = $e.find("span").attr("data-id");
                n.push(e),
                "" == a && 0 == i && (i = 2),
                $.trim(a) != $.trim(l.correct[t]) ? (this.viewans && $e.addClass("xwrong"),
                r = 0,
                s[t] = 0) : (this.viewans && $e.addClass("xcorrect"),
                s[t] = 1)
            }),
            2 == i && (r = 2),
            l.save_data = {
                params: JSON.stringify(l.params),
                answer: JSON.stringify(n),
                result: s
            },
            r
        }
    }
    var TwoList = (inherit(mh, Base),
    mh);
    function mh() {
        this.constructor.super.call(this),
        this.right = [],
        this.left = [],
        this.correct = [],
        this.qhtml = "",
        this.accept = !0;
        var s = this;
        this.idq = function() {
            return 4
        }
        ,
        this.initQuestion = function(t, e) {
            if (!1 === s.save_data || !s.save_data.answer)
                return s.makeQuestion(t);
            s.makeQuestion(t);
            var n = JSON.parse(s.save_data.answer);
            t.find(".two-column-right").each(function(t, e) {
                s.right[n[t]] && (t = "<span class = 'drag-select'>" + s.right[n[t]] + "</span>",
                $(e).html(t))
            }),
            t.find(".item-drag .drag-select").each(function(t, e) {
                var a = parseInt($(e).find("span").attr("data-id"));
                -1 < n.indexOf(a) && $(e).remove()
            })
        }
        ,
        this.makeQuestion = function(e, t) {
            if (s.tmpHtml = detectJS(s.tmpHtml),
            e.html(s.tmpHtml),
            e.find(".exp").remove(),
            s.left = [],
            s.right = [],
            s.correct = [],
            e.find(".two-list > li").each(function(t, e) {
                e = e.innerHTML;
                e = 0 < e.indexOf("||") ? e.split("||") : e.split("#"),
                s.left.push($.trim(e[0])),
                s.right.push("<span class = 'left-value' data-id = '" + t + "'>" + $.trim(e[1]) + "</span>"),
                s.correct.push(t)
            }),
            "" == s.qhtml) {
                s.qhtml = "<div class = 'merge-two-columns'>";
                for (var a = 0; a < s.left.length; a++)
                    s.qhtml += "<div class = 'two-column-row'>",
                    s.qhtml += "<div class = 'two-column-left'><span>" + s.left[a] + "</span></div>",
                    s.qhtml += "<div class = 'two-column-middle'><div class = 'two-middle-line'></div></div>",
                    s.qhtml += "<div class = 'two-column-right' ondrop='drop(event)' ondragleave = 'dragLeave(event)' ondragover='allowDrop(event)' canreturn = 'false'></div>",
                    s.qhtml += "</div>";
                s.qhtml += "</div><span class='clearfix'></span>"
            }
            e.find(".two-list").replaceWith(s.qhtml),
            s.save_data && void 0 !== s.save_data.params && null !== s.save_data.params ? s.params = JSON.parse(s.save_data.params) : void 0 === s.params.order && (s.params.order = shuffle(s.correct.slice(0)));
            var n = "<div><div class = 'item-drag' ondrop='drop(event)' ondragover='allowDrop(event)' canreturn = 'true'>";
            if (2 != t && 1 != t)
                for (a = 0; a < s.params.order.length; a++)
                    n += "<span id = 'dt" + p.now + random(1, 1e3) + "' class = 'drag-select' draggable='true' ondragstart='drag(event)'>" + s.right[s.params.order[a]] + "</span>";
            n += "</div></div>",
            n += "</div><p style = 'font-size: 14px;'><i>(Kéo thả hoặc click vào để điền)</i></p></div>",
            e.append(n),
            t || this.isTest || fixedUntilPoint(e.find(".item-drag"));
            var i = e.find(".item-drag")
              , r = e.find(".two-column-right");
            r.first().addClass("selectpoint"),
            r.on("click", function(t, e) {
                r.removeClass("selectpoint"),
                $(this).addClass("selectpoint"),
                0 < $(this).find(".drag-select").length && inputText(i, $(this).find(".drag-select"), !0)
            }),
            e.find(".item-drag>.drag-select").on("click", function() {
                var t, a;
                $(this).parent().hasClass("dragtext") || 0 < (t = e.find(".selectpoint")).length && (inputText(t, this),
                a = !1,
                setTimeout(function() {
                    for (var t = 0; t < r.length; t++) {
                        var e = r[t];
                        if ($(e).hasClass("selectpoint") && ($(e).removeClass("selectpoint"),
                        a = !0),
                        a)
                            if (0 == (e = t === r.length - 1 ? $(r[0]) : $(r[t + 1])).find("span").length) {
                                e.addClass("selectpoint");
                                break
                            }
                    }
                }, 700))
            }),
            e.find(".guide-toggle").on("click", function() {
                e.find(".guide-more").toggle()
            }),
            drawingCanvas(e)
        }
        ,
        this.makeQuestionH = function(t) {
            var n;
            p.quizState = 2,
            this.makeQuestion(t, 1),
            2 != s.save_data.result && "" != s.save_data.answer && (n = JSON.parse(s.save_data.answer),
            t.find(".two-column-right").each(function(t, e) {
                var a;
                s.right[n[t]] && (a = "<span class = 'drag-select'>" + s.right[n[t]] + "</span>",
                $(e).html(a),
                n[t] == t ? $(e).addClass("xcorrect") : $(e).addClass("xwrong"))
            }))
        }
        ,
        this.makeCorrectAns = function(t) {
            p.quizState = 3,
            this.makeQuestion(t, 2),
            t.find(".two-column-right").each(function(t, e) {
                t = "<span class = 'drag-select'>" + s.right[t] + "</span>";
                $(e).html(t)
            })
        }
        ,
        this.check = function(t) {
            var n = []
              , e = 0
              , a = [];
            t.find(".two-column-right .left-value").each(function(t, e) {
                var a = $(e).data("id");
                n.push(a),
                a == t ? this.viewans && $(e).addClass("xcorrect") : this.viewans && $(e).addClass("xwrong")
            });
            for (var i = 0; i < s.correct.length; i++)
                console.log(n[i], s.correct[i]),
                void 0 !== n[i] && n[i] == s.correct[i] ? a[i] = 1 : a[i] = 0;
            return console.log(a),
            n.length < s.correct.length ? e = 2 : n.join(":") == s.correct.join(":") && (e = 1),
            s.save_data = {
                params: JSON.stringify(s.params),
                answer: JSON.stringify(n),
                result: a
            },
            e
        }
    }
    var SortList = (inherit(gi, Base),
    gi);
    function gi() {
        this.constructor.super.call(this),
        this.correct = [],
        this.correctText = [],
        this.list = [],
        this.text = !0,
        this.accept = !0;
        var r = this;
        this.idq = function() {
            return 5
        }
        ,
        this.initQuestion = function(t, e) {
            if (!1 === r.save_data || !r.save_data.answer)
                return r.makeQuestion(t);
            r.makeQuestion(t);
            var a = JSON.parse(r.save_data.answer);
            t.find(".sortable-list>.sortable").each(function(t, e) {
                r.text ? $(e).html("<span class = 'sort-value' data-id = '" + t + "'>" + a[t] + "</span>") : $(e).html("<span class = 'sort-value' data-id = '" + t + "'>" + r.list[a[t]] + "</span>")
            })
        }
        ,
        this.makeQuestion = function(t, e) {
            p.shuffle = 1,
            r.tmpHtml = detectJS(r.tmpHtml),
            r.correct = [],
            t.html(r.tmpHtml),
            t.find(".exp").remove(),
            r.list = [];
            var a = "vertical";
            if (0 < t.find(".horizon").length && (a = "horizon"),
            t.find(".sort-list > li").each(function(t, e) {
                var a = e.innerHTML;
                r.list.push("<span class = 'sort-value' data-id = '" + t + "'>" + $.trim(a) + "</span>"),
                0 < $(e).find("img").length || 0 < $(e).find("svg").length || 0 < $(e).find(".math-q").length || 0 < $(e).find(".math-tex").length || 0 < $(e).find("audio").length || 0 < $(e).find(".katex").length ? r.text = !1 : r.correctText[t] = $(e).text(),
                r.correct.push(t)
            }),
            r.save_data && void 0 !== r.save_data.params && null !== r.save_data.params)
                r.params = JSON.parse(r.save_data.params);
            else if (void 0 === r.params.order)
                if (1 == r.correct.length)
                    r.params.order = r.correct.slice(0);
                else
                    for (; r.params.order = shuffle(r.correct.slice(0)),
                    r.params.order.join(":") == r.correct.join(":"); )
                        ;
            for (var n = "<ul class = 'sortable-list'>", i = 0; i < r.list.length; i++)
                n += "<li class = 'sortable " + a + "'>" + r.list[r.params.order[i]] + "</li>";
            n += "</ul><span class='clearfix'></span>",
            t.find(".sort-list").replaceWith(n),
            e || ($(".sortable-list").sortable({
                placeholder: "ui-state-highlight ui-sort-highlight " + a
            }),
            drawingCanvas(t))
        }
        ,
        this.makeQuestionH = function(t) {
            if (p.quizState = 2,
            this.makeQuestion(t, 1),
            2 != r.save_data.result) {
                if ("" == r.save_data.answer)
                    return;
                var a = JSON.parse(r.save_data.answer);
                t.find(".sortable-list>.sortable").each(function(t, e) {
                    r.text ? $(e).html("<span class = 'sort-value' data-id = '" + t + "'>" + a[t] + "</span>") : $(e).html("<span class = 'sort-value' data-id = '" + t + "'>" + r.list[a[t]] + "</span>")
                })
            }
            drawingCanvas(t)
        }
        ,
        this.makeCorrectAns = function(t) {
            p.quizState = 3,
            this.makeQuestion(t, 1),
            t.find(".sortable-list>.sortable").each(function(t, e) {
                $(e).html(r.list[t]).css({
                    float: "unset"
                })
            }),
            drawingCanvas(t)
        }
        ,
        this.check = function(t) {
            var n = []
              , i = []
              , e = 0;
            return t.find(".sortable>.sort-value").each(function(t, e) {
                var a;
                i = r.text ? (a = $(e).text(),
                n[t] = a,
                r.correctText.slice(0)) : (a = $(e).data("id"),
                n[t] = a,
                r.correct.slice(0))
            }),
            n.length < i.length ? e = 2 : n.join(":") == i.join(":") && (e = 1),
            r.save_data = {
                params: JSON.stringify(r.params),
                answer: JSON.stringify(n),
                result: e
            },
            e
        }
    }
    var LinkList = (inherit(Ni, Base),
    Ni);
    function Ki(t, e, a, n) {
        var i = t.getBoundingClientRect()
          , t = e.getBoundingClientRect()
          , o = e.getAttribute("data-pos");
        !function(t, e, a, n) {
            var i, r;
            "left" == o ? (r = a,
            i = n) : (i = a,
            r = n);
            for (var s = 0; s < r.length; s++)
                void 0 !== r[s] && void 0 === r[s].link && (r[s] = void 0);
            for (void 0 !== r[t] && void 0 !== r[t].link && (i[r[t].link] = void 0,
            r[t].link = void 0),
            s = 0; s < i.length; s++)
                void 0 !== i[s] && void 0 === i[s].link && (i[s].link = t,
                e.link = s);
            r[t] = e
        }(parseInt(e.getAttribute("data-id")), {
            x: ("left" === o ? t.right : t.left) - i.left,
            y: t.top + t.height / 2 - i.top
        }, a, n)
    }
    function Mi(t, e, a) {
        var n = t.getContext("2d");
        n.clearRect(0, 0, t.width, t.height);
        for (var i = 0; i < a.length; i++)
            void 0 !== a[i] && (n.beginPath(),
            n.arc(a[i].x, a[i].y, 1, 0, +Math.PI),
            n.fillStyle = "green",
            n.fill(),
            n.strokeStyle = "green",
            n.stroke());
        for (i = 0; i < e.length; i++)
            null != e[i] && (n.beginPath(),
            n.arc(e[i].x, e[i].y, 1, 0, +Math.PI),
            n.fillStyle = "green",
            n.fill(),
            n.strokeStyle = "green",
            n.stroke(),
            void 0 !== e[i].link && (n.beginPath(),
            n.lineWidth = 3,
            n.moveTo(e[i].x, e[i].y),
            n.lineTo(a[e[i].link].x, a[e[i].link].y),
            n.stroke()))
    }
    function Ni() {
        this.constructor.super.call(this),
        this.correct = [],
        this.right = [],
        this.left = [],
        this.aleft = [],
        this.aright = [],
        this.accept = !0,
        this.numberQuiz = 1;
        var o = this;
        this.idq = function() {
            return 6
        }
        ,
        this.getNumberQuiz = function() {
            return this.numberQuiz
        }
        ,
        this.getMany = function() {
            var t = document.createElement("div");
            t.innerHTML = o.tmpHtml,
            isMultiQuiz(t.innerText) ? o.numberQuiz = $(t).find(".link-list > li").length : o.numberQuiz = 1
        }
        ,
        this.initQuestion = function(t, e) {
            if (!1 === o.save_data || !o.save_data.answer)
                return o.makeQuestion(t);
            o.makeQuestion(t, 3)
        }
        ,
        this.makeQuestion = function(n, i) {
            o.tmpHtml = detectJS(o.tmpHtml),
            o.correct = [],
            n.html(o.tmpHtml),
            n.find(".exp").remove(),
            o.left = [],
            o.right = [],
            n.find(".link-list > li").each(function(t, e) {
                e = e.innerHTML;
                e = 0 < e.indexOf("||") ? e.split("||") : e.split("#"),
                o.left.push($.trim(e[0])),
                o.right.push($.trim(e[1])),
                o.correct.push(t)
            }),
            o.save_data && void 0 !== o.save_data.params && null !== o.save_data.params ? o.params = JSON.parse(o.save_data.params) : (void 0 === o.params.order && (o.params.order = shuffle(o.correct.slice(0))),
            o.params.c = random(0, Color.length));
            var t = "<div class='question-board'></div><span class='clearfix'></span>";
            n.find(".link-list").replaceWith(t);
            var r = document.createElement("div");
            r.className = "text-board";
            var s = document.createElement("canvas");
            s.className = "canvas-board",
            t = "";
            for (var e = 0; e < o.params.order.length; e++)
                t += "<div class= 'row-board'>",
                t += "<div class = 'boxlink left' data-pos = 'left' data-id = '" + e + "'>" + o.left[e] + "</div>",
                t += "<div class = 'middle'></div>",
                t += "<div class = 'boxlink right' data-pos = 'right' data-id = '" + o.params.order[e] + "'>" + o.right[o.params.order[e]] + "</div>",
                t += "</div>";
            r.innerHTML = t,
            n.find(".question-board").append(s).append(r),
            o.aleft = [],
            o.aright = [],
            setTimeout(function() {
                var t = r.getBoundingClientRect();
                if (s.width = t.width,
                s.height = t.height,
                n.find(".question-board").height(t.height),
                n.find(".row-board>.boxlink").css("border", "2px solid " + Color[o.params.c]),
                i)
                    if (o.aleft = [],
                    o.aright = [],
                    n.find(".text-board .boxlink").each(function(t, e) {
                        Ki(s, e, o.aleft, o.aright)
                    }),
                    1 != i && 3 != i || 2 == o.save_data.result) {
                        if (2 == i) {
                            for (a = 0; a < o.aleft.length; a++)
                                o.aleft[a].link = a;
                            Mi(s, o.aleft, o.aright)
                        }
                    } else {
                        for (var e = JSON.parse(o.save_data.answer), a = 0; a < o.aleft.length; a++)
                            o.aleft[a].link = e[a];
                        Mi(s, o.aleft, o.aright),
                        3 == i && n.find(".row-board>.boxlink").on("click", function() {
                            Ki(s, this, o.aleft, o.aright),
                            Mi(s, o.aleft, o.aright)
                        })
                    }
                else {
                    if (p.help && 0 < p.help.length) {
                        n.find(".text-board .boxlink").each(function(t, e) {
                            Ki(s, e, o.aleft, o.aright)
                        });
                        for (var a = 0; a < o.aleft.length; a++)
                            -1 < p.help.indexOf(a) ? o.aleft[a].link = a : (o.aleft[a] = void 0,
                            o.aright[a] = void 0);
                        Mi(s, o.aleft, o.aright)
                    }
                    n.find(".row-board>.boxlink").on("click", function() {
                        Ki(s, this, o.aleft, o.aright),
                        Mi(s, o.aleft, o.aright)
                    })
                }
            }, 500),
            drawingCanvas(n)
        }
        ,
        this.makeQuestionH = function(t) {
            p.quizState = 2,
            this.makeQuestion(t, 1)
        }
        ,
        this.makeCorrectAns = function(t) {
            p.quizState = 3,
            this.makeQuestion(t, 2)
        }
        ,
        this.check = function(t) {
            for (var e = [], a = 1, n = 0, i = [], r = 0; r < o.right.length; r++) {
                if (void 0 === o.aleft[r]) {
                    n = 2;
                    break
                }
                if (void 0 === o.aleft[r].link) {
                    n = 2;
                    break
                }
                o.aleft[r].link != r ? (a = 0,
                i[r] = 0) : i[r] = 1,
                e[r] = o.aleft[r].link
            }
            return 2 == n && (a = 2),
            o.save_data = {
                params: JSON.stringify(o.params),
                answer: JSON.stringify(e),
                result: i
            },
            a
        }
    }
    var MergeList = (inherit(Oj, Base),
    Oj);
    function Oj() {
        this.constructor.super.call(this),
        this.correct = [],
        this.width = 0,
        this.height = 0,
        this.accept = !0;
        var s = this;
        this.idq = function() {
            return 7
        }
        ,
        this.initQuestion = function(t, e) {
            if (!1 === s.save_data || !s.save_data.answer)
                return s.makeQuestion(t);
            s.makeQuestion(t, 3)
        }
        ,
        this.makeQuestion = function(i, r) {
            s.tmpHtml = detectJS(s.tmpHtml),
            s.correct = [],
            i.html(s.tmpHtml),
            i.find(".exp").remove();
            var a = []
              , n = [];
            i.find(".merge-list > li").each(function(t, e) {
                e = e.innerHTML;
                e = 0 < e.indexOf("||") ? e.split("||") : e.split("#"),
                a.push($.trim(e[0])),
                n.push($.trim(e[1])),
                s.correct.push(t)
            }),
            s.save_data && void 0 !== s.save_data.params && null !== s.save_data.params ? s.params = JSON.parse(s.save_data.params) : void 0 === s.params.order && (s.params.order = shuffle(s.correct.slice(0))),
            html = "";
            var t = s.params.order.slice(0);
            1 != r && 3 != r || "[]" == s.save_data.answer || (t = JSON.parse(s.save_data.answer)),
            2 == r && (t = s.correct.slice(0));
            for (var e = 0; e < a.length; e++)
                html += "<div class= 'merge-row'>",
                html += "<div class = 'block left' data-pos = 'left' data-id = '" + e + "'>",
                html += "<div class = 'svg'></div>",
                html += "<div class = 'merge-ct'><div>" + a[e] + "</div></div></div>",
                html += "<div class = 'block right' data-pos = 'right' data-id = '" + e + "'>",
                html += "<div class = 'svg'></div>",
                html += "<div class = 'merge-ct' data-id = '" + t[e] + "'><div>" + n[t[e]] + "</div></div></div>",
                html += "</div>";
            i.find(".merge-list").replaceWith("<div class = 'merge-board'>" + html + "</div><span class='clearfix'></span>"),
            setTimeout(function() {
                var a = 0
                  , n = 0;
                0 == s.width && 0 == s.height ? (i.find(".block").each(function(t, e) {
                    e = $(e).get(0).getBoundingClientRect();
                    e.width > a && (a = e.width),
                    e.height > n && (n = e.height)
                }),
                s.width = a,
                s.height = n) : (a = s.width,
                n = s.height),
                i.find(".block").each(function(t, e) {
                    $(e).css({
                        width: a,
                        height: n
                    })
                });
                var t = '<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="' + a + '" height="' + n + '" focusable="false"><path class="fill" d="M 0 4.7 l 0 ' + (n - 11.6) + " q 0 4.7 4.7 4.7 l " + (a - 9.4) + " 0 q 4.7 0 4.7 -4.7 l 0 -" + (n - 11.6 - 14) / 2 + " q 0 -2 -2 -2 l -5.15 0 q -1.7 5 -4.85 5 q -6 0 -6 -10 q 0 -10 6 -10 q 3.15 0 4.85 5 l 5.15 0 q 2 0 2 -2 l 0 -" + (n - 11.6 - 14) / 2 + " q 0 -4.7 -4.7 -4.7 l -" + (a - 9.4) + ' 0 q -4.7 0 -4.7 4.7"></path></svg>'
                  , e = '<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="' + a + '" height="' + n + '" focusable="false"><path class="fill" d="M 18 4.7 q 0 -4.7 4.7 -4.7 l ' + (a - 27.4) + " 0 q 4.7 0 4.7 4.7 l 0 " + (n - 11.6) + " q 0 4.7 -4.7 4.7 l -" + (a - 27.4) + " 0 q -4.7 0 -4.7 -4.7 l 0 -" + (n - 11.6 - 15) / 2 + " q 0 -2 -2 -2 l -3.15 0 q -2.05 5 -5.85 5 q -7 0 -7 -11 q 0 -11 7 -11 q 3.8 0 5.85 5 l 3.15 0 q 2 0 2 -2 l 0 -" + (n - 11.6 - 15) / 2 + '"></path></svg>';
                i.find(".left>.svg").html(t),
                i.find(".right>.svg").html(e),
                (1 != r && 3 != r || "[]" == s.save_data.answer) && 2 != r || i.find(".merge-row>.right").each(function(t, e) {
                    $(e).css({
                        "margin-left": "-33px"
                    })
                }),
                r && 3 != r || (i.find(".right").draggable({
                    revert: !0,
                    cursor: "move",
                    zIndex: 100
                }),
                i.find(".left").droppable({
                    hoverClass: "merge-hover",
                    tolerance: "touch",
                    drop: function(t, e) {
                        var a, n;
                        a = this,
                        (n = e.draggable).fadeOut(function() {
                            var t = document.createElement("div");
                            $(a).parent().find(".right").children().appendTo($(t)),
                            $(n).children().appendTo($(a).parent().find(".right").html("")),
                            $(t).children().appendTo($(n).html("").show().css({
                                top: "0",
                                left: "0",
                                "margin-left": ""
                            })),
                            $(a).parent().find(".right").css({
                                "margin-left": "-33px"
                            })
                        })
                    },
                    activate: function(t, e) {
                        $(e.draggable).css({
                            "margin-left": ""
                        })
                    }
                }))
            }, 500),
            drawingCanvas(i)
        }
        ,
        this.makeQuestionH = function(t) {
            p.quizState = 2,
            this.makeQuestion(t, 1)
        }
        ,
        this.makeCorrectAns = function(t) {
            p.quizState = 3,
            this.makeQuestion(t, 2)
        }
        ,
        this.check = function(t) {
            var a = []
              , e = 0
              , n = [];
            return t.find(".right>.merge-ct").each(function(t, e) {
                e = $(e).data("id");
                a.push(e),
                e == s.correct[t] ? n[t] = 1 : n[t] = 0
            }),
            a.length < s.correct.length ? e = 2 : a.join(":") == s.correct.join(":") && (e = 1),
            s.save_data = {
                params: JSON.stringify(s.params),
                answer: JSON.stringify(a),
                result: n
            },
            e
        }
    }
    var UnderList = (inherit(Dk, Base),
    Dk);
    function Dk() {
        this.constructor.super.call(this),
        this.correct = [],
        this.accept = !0;
        var s = this;
        this.idq = function() {
            return 8
        }
        ,
        this.initQuestion = function(t, e) {
            if (!1 === s.save_data || !s.save_data.answer)
                return s.makeQuestion(t);
            s.makeQuestion(t);
            var a = JSON.parse(s.save_data.answer);
            t.find(".select-text").each(function(t, e) {
                -1 < a.indexOf(t) && ($(e).addClass("under-mark"),
                $(e).removeClass("correctAnswer"))
            })
        }
        ,
        this.makeQuestion = function(t) {
            s.tmpHtml = detectJS(s.tmpHtml),
            s.correct = [],
            t.html(s.tmpHtml),
            t.find(".exp").remove();
            var a = [];
            txt = [],
            t.find(".under-list > li").each(function(t, e) {
                $(e).hasClass("correctAnswer") && s.correct.push(t),
                a.push($(e).html()),
                txt.push($(e).text())
            });
            for (var e, n, i = "<p>", r = 0; r < a.length; r++)
                n = a[r],
                i += "#" == (e = txt[r]) || "" == e ? "<span class = 'select-text' style = 'display:none;'></span></p><p>" : "<span class = 'select-text'>" + n + "</span>&nbsp";
            i += "</p>",
            t.find(".under-list").replaceWith("<div>" + i + "</div>"),
            t.find(".select-text").on("click", function() {
                $(this).hasClass("under-mark") ? $(this).removeClass("under-mark") : $(this).addClass("under-mark")
            }),
            drawingCanvas(t)
        }
        ,
        this.makeQuestionH = function(t) {
            var a;
            p.quizState = 2,
            this.makeQuestion(t),
            2 != s.save_data.result && "" != s.save_data.answer && (a = JSON.parse(s.save_data.answer),
            t.find(".select-text").each(function(t, e) {
                -1 < a.indexOf(t) && ($(e).addClass("under-mark"),
                $(e).removeClass("correctAnswer"),
                -1 < s.correct.indexOf(t) ? $(e).addClass("xcorrect") : $(e).addClass("xwrong"))
            }))
        }
        ,
        this.makeCorrectAns = function(t) {
            p.quizState = 3,
            this.makeQuestion(t),
            t.find(".select-text").each(function(t, e) {
                -1 < s.correct.indexOf(t) && ($(e).addClass("under-mark"),
                $(e).removeClass("correctAnswer"))
            })
        }
        ,
        this.check = function(t) {
            var a = []
              , e = 0
              , n = []
              , i = !1;
            if (t.find(".select-text").each(function(t, e) {
                $(e).hasClass("under-mark") && (a.push(t),
                -1 < s.correct.indexOf(t) ? this.viewans && $(e).addClass("xcorrect") : (this.viewans && $(e).addClass("xwrong"),
                i = !0))
            }),
            i)
                for (var r = 0; r < s.correct.length; r++)
                    n[r] = 0;
            else
                for (r = 0; r < s.correct.length; r++)
                    -1 < a.indexOf(s.correct[r]) ? n[r] = 1 : n[r] = 0;
            return a.join(":") == s.correct.join(":") && (e = 1),
            s.save_data = {
                params: JSON.stringify(s.params),
                answer: JSON.stringify(a),
                result: n
            },
            e
        }
    }
    var UnderLine = (inherit(hl, Base),
    hl);
    function hl() {
        this.constructor.super.call(this),
        this.correct = [],
        this.accept = !0;
        var s = this;
        this.idq = function() {
            return 9
        }
        ,
        this.initQuestion = function(t, e) {
            if (!1 === s.save_data || !s.save_data.answer)
                return s.makeQuestion(t);
            s.makeQuestion(t);
            var a = JSON.parse(s.save_data.answer);
            t.find(".under-line").each(function(t, e) {
                -1 < a.indexOf(t) && ($(e).addClass("under-mark"),
                $(e).removeClass("correctAnswer"))
            })
        }
        ,
        this.makeQuestion = function(t) {
            s.tmpHtml = detectJS(s.tmpHtml),
            s.correct = [],
            t.html(s.tmpHtml),
            t.find(".exp").remove(),
            t.find(".under-line").each(function(t, e) {
                $(e).hasClass("correctAnswer") && s.correct.push(t)
            }),
            t.find(".under-line").on("click", function() {
                var t = $(this).closest(".border-word");
                1 == t.length ? (t.find(".under-mark").each(function() {
                    (1 <= $(this).children(".under-line").length ? $(this).children(".under-line") : $(this)).removeClass("under-mark")
                }),
                (1 <= $(this).children(".under-line").length ? $(this).children(".under-line") : $(this)).addClass("under-mark")) : $(this).hasClass("under-mark") ? (1 <= $(this).children(".under-line").length ? $(this).children(".under-line") : $(this)).removeClass("under-mark") : (1 <= $(this).children(".under-line").length ? $(this).children(".under-line") : $(this)).addClass("under-mark")
            }),
            drawingCanvas(t)
        }
        ,
        this.makeQuestionH = function(t) {
            var a;
            p.quizState = 2,
            this.makeQuestion(t),
            2 != s.save_data.result && "" != s.save_data.answer && (a = JSON.parse(s.save_data.answer),
            t.find(".under-line").each(function(t, e) {
                -1 < a.indexOf(t) && ($(e).addClass("under-mark"),
                $(e).removeClass("correctAnswer"),
                -1 < s.correct.indexOf(t) ? $(e).addClass("xcorrect") : $(e).addClass("xwrong"))
            }))
        }
        ,
        this.makeCorrectAns = function(t) {
            p.quizState = 3,
            this.makeQuestion(t),
            t.find(".under-line").each(function(t, e) {
                -1 < s.correct.indexOf(t) && ($(e).addClass("under-mark"),
                $(e).removeClass("correctAnswer"))
            })
        }
        ,
        this.check = function(t) {
            var a = []
              , e = 0
              , n = []
              , i = !1;
            if (t.find(".under-line").each(function(t, e) {
                $(e).hasClass("under-mark") && (a.push(t),
                -1 < s.correct.indexOf(t) ? this.viewans && $(e).addClass("xcorrect") : (i = !0,
                this.viewans && $(e).addClass("xwrong")))
            }),
            i)
                for (var r = 0; r < s.correct.length; r++)
                    n[r] = 0;
            else
                for (r = 0; r < s.correct.length; r++)
                    -1 < a.indexOf(s.correct[r]) ? n[r] = 1 : n[r] = 0;
            return a.join(":") == s.correct.join(":") && (e = 1),
            s.save_data = {
                params: JSON.stringify(s.params),
                answer: JSON.stringify(a),
                result: n
            },
            e
        }
    }
    var GroupList = (inherit(Il, Base),
    Il);
    function Il() {
        this.constructor.super.call(this),
        this.list = [],
        this.height = 0,
        this.others = 0,
        this.accept = !0;
        var l = this;
        this.idq = function() {
            return 10
        }
        ,
        this.initQuestion = function(t, e) {
            if (!1 === l.save_data || !l.save_data.answer)
                return l.makeQuestion(t);
            l.makeQuestion(t);
            var s = t.find(".group-item")
              , o = JSON.parse(l.save_data.answer);
            t.find(".drop-into").each(function(t, e) {
                for (var a = $(e).find(".item-in"), e = $(e).data("id"), n = o[e], i = 0; i < n.length; i++) {
                    var r = s.find("[data-stt='" + n[i] + "']");
                    r[0] && (a.append(r[0].outerHTML),
                    r.remove())
                }
            })
        }
        ,
        this.makeQuestion = function(i) {
            l.tmpHtml = detectJS(l.tmpHtml),
            i.html(l.tmpHtml),
            i.find(".exp").remove();
            var r = []
              , s = []
              , o = 0;
            l.list = [],
            i.find(".group-list > li").each(function(t, e) {
                var a, e = e.innerHTML;
                a = 0 < e.indexOf("||") ? e.split("||") : e.split("#");
                for (var n, i = 0; i < a.length; i++)
                    0 == i ? "" == (n = $.trim(a[i])).replace(/&nbsp;/g, "") ? l.others = a.length - 1 : r.push(n) : (l.list.push("<li data-id = '" + t + "' data-stt = '" + o + "' class = 'a-item drag-select ui-widget-content ui-corner-tr'>" + $.trim(a[i]) + "</li>"),
                    s.push(o),
                    o++)
            });
            var t = "<div><ul class = 'group-item ui-helper-reset ui-helper-clearfix'>"
              , s = shuffle(s);
            l.save_data && void 0 !== l.save_data.params && null !== l.save_data.params ? l.params = JSON.parse(l.save_data.params) : void 0 === l.params.order && (l.params.order = s.slice(0));
            for (var e = 0; e < l.list.length; e++)
                t += l.list[s[e]];
            if (t += "</ul></div><div class = 'clearfix'></div><div>",
            1 == r.length)
                t += "<div class = 'drop-into' data-id = '0' style = 'display:inline-block;width:50%;'><h2>" + r[0] + "</h2><ul class = 'item-in'></ul></div>";
            else
                for (var a = Math.floor(100 / r.length) - 3, e = 0; e < r.length; e++)
                    t += "<div class = 'drop-into' data-id = '" + e + "' style = 'display:inline-block;width:" + a + "%;margin-right:10px;'><h2>" + r[e] + "</h2><ul class = 'item-in'></ul></div>";
            t += "</div>",
            i.find(".group-list").replaceWith("<div>" + t + "</div>"),
            0 == l.height && i.find(".drop-into>h2").each(function(t, e) {
                $(e).get(0).offsetHeight > l.height && (l.height = $(e).get(0).offsetHeight)
            }),
            i.find(".drop-into>h2").each(function(t, e) {
                $(e).css({
                    height: l.height
                })
            }),
            i.find(".drag-select").draggable({
                revert: !0,
                cursor: "move",
                drag: function(t, e) {
                    $(this).off("click").css({
                        "z-index": 20
                    })
                },
                stop: function(t, e) {
                    $(this).css({
                        "z-index": 1
                    })
                }
            }),
            i.find(".item-in").droppable({
                hoverClass: "ui-state-highlight",
                classes: {
                    "ui-droppable": "highlight"
                },
                drop: function(t, e) {
                    inputText(this, e.draggable, !0)
                },
                over: function(t, e) {
                    dropOver(this, e.draggable)
                }
            }),
            i.find(".group-item").droppable({
                hoverClass: "ui-state-highlight",
                classes: {
                    "ui-droppable": "highlight"
                },
                drop: function(t, e) {
                    inputText(this, e.draggable, !0),
                    $(e.draggable).removeAttr("style")
                }
            }),
            i.find(".item-in").on("click", function(t, e) {
                i.find(".item-in").removeClass("selectpoint"),
                $(this).addClass("selectpoint");
                var a = this
                  , n = i.find(".group-item");
                i.find(".drag-select").off("click"),
                i.find(".group-item>.drag-select").on("click", function() {
                    inputText(a, this, !0)
                }),
                $(a).children().on("click", function() {
                    inputText(n, this, !0)
                })
            }),
            i.find(".guide-toggle").on("click", function() {
                i.find(".guide-more").toggle()
            }),
            drawingCanvas(i)
        }
        ,
        this.makeQuestionH = function(t) {
            p.quizState = 2,
            this.makeQuestion(t);
            var o, c = t.find(".group-item");
            2 != l.save_data.result && "" != l.save_data.answer && (o = JSON.parse(l.save_data.answer),
            t.find(".drop-into").each(function(t, e) {
                for (var a = $(e).find(".item-in"), n = $(e).data("id"), i = o[n], r = 0; r < i.length; r++) {
                    var s = c.find("[data-stt='" + i[r] + "']");
                    s[0] && (s.data("id") == n ? s.addClass("xcorrect") : s.addClass("xwrong"),
                    a.append(s[0].outerHTML),
                    s.remove())
                }
            }))
        }
        ,
        this.makeCorrectAns = function(t) {
            p.quizState = 3,
            this.makeQuestion(t);
            var i = t.find(".group-item");
            t.find(".drop-into").each(function(t, e) {
                var a = $(e).find(".item-in")
                  , n = $(e).data("id");
                i.find(".a-item").each(function(t, e) {
                    $(e).data("id") == n && a.append($(e)[0].outerHTML)
                })
            }),
            i.remove()
        }
        ,
        this.check = function(t) {
            var i = []
              , r = 1
              , s = 0;
            return t.find(".drop-into").each(function(t, e) {
                var a = $(e).data("id")
                  , n = [];
                $(e).find(".a-item").each(function(t, e) {
                    miss = 1,
                    n.push($(e).data("stt")),
                    $(e).data("id") == a ? this.viewans && $(e).addClass("xcorrect") : (this.viewans && $(e).addClass("xwrong"),
                    r = 0)
                }),
                s += n.length,
                i.push(n)
            }),
            0 == s ? r = 2 : s < l.params.order.length - l.others && (r = 0),
            l.save_data = {
                params: JSON.stringify(l.params),
                answer: JSON.stringify(i),
                result: r
            },
            r
        }
    }
    var SelectText = (inherit(_m, Base),
    _m);
    function _m() {
        this.constructor.super.call(this),
        this.accept = !0,
        this.numberQuiz = 1;
        var s = this;
        this.idq = function() {
            return 11
        }
        ,
        this.getNumberQuiz = function() {
            return this.numberQuiz
        }
        ,
        this.getMany = function() {
            var t = document.createElement("div");
            t.innerHTML = s.tmpHtml,
            isMultiQuiz(t.innerText) ? s.numberQuiz = $(t).find(".selecttext").length : s.numberQuiz = 1
        }
        ,
        this.initQuestion = function(t, e) {
            if (!1 === s.save_data || !s.save_data.answer)
                return s.makeQuestion(t);
            s.makeQuestion(t);
            var a = JSON.parse(s.save_data.answer);
            t.find(".select-option").each(function(t, e) {
                t = a[t];
                $(e).val(t)
            })
        }
        ,
        this.makeQuestion = function(t) {
            s.tmpHtml = detectJS(s.tmpHtml),
            t.html(s.tmpHtml),
            t.find(".exp").remove();
            var i = []
              , r = [];
            t.find(".selecttext").each(function(t, e) {
                var a, e = e.innerHTML;
                a = 0 < (e = htmlDecode(e)).indexOf("||") ? e.split("||") : e.split(";");
                for (var n = [], t = 0; t < a.length; t++)
                    n.push(t),
                    a[t] = $.trim(a[t]);
                i.push(a),
                r.push(shuffle(n))
            }),
            t.find(".selecttext").each(function(t, e) {
                for (var a = "<select class = 'select-option'>", n = 0; n < r[t].length; n++)
                    a += "<option value = '" + r[t][n] + "'>" + i[t][r[t][n]] + "</option>";
                a += "<option value = '-1' selected ></option></select>",
                $(e).replaceWith(a)
            }),
            drawingCanvas(t)
        }
        ,
        this.makeQuestionH = function(t) {
            console.log("HHHHHH"),
            p.quizState = 2,
            this.makeQuestion(t);
            var a = JSON.parse(s.save_data.answer);
            t.find(".select-option").each(function(t, e) {
                t = a[t];
                $(e).val(t),
                0 != t ? $(e).addClass("owrong") : $(e).addClass("ocorrect"),
                $(e).prop("disabled", !0)
            })
        }
        ,
        this.makeCorrectAns = function(t) {
            p.quizState = 3,
            this.makeQuestion(t),
            t.find(".select-option").each(function(t, e) {
                $(e).val(0),
                $(e).prop("disabled", !0)
            })
        }
        ,
        this.check = function(t) {
            var a = []
              , n = 1
              , i = [];
            return t.find(".select-option").each(function(t, e) {
                e = $(e).val();
                -1 == e ? n = 3 : 0 == e || 1 == n && (n = 0),
                i[t] = 0 == e ? 1 : 0,
                a.push(e)
            }),
            s.save_data = {
                answer: JSON.stringify(a),
                params: JSON.stringify(s.params),
                result: i
            },
            s.viewans && t.find(".select-option").each(function(t, e) {
                var a = $(e).val();
                -1 == a || (0 == a ? $(e).addClass("ocorrect") : $(e).addClass("owrong"),
                $(e).prop("disabled", !0))
            }),
            n
        }
    }
    var FindWrong = (Pn = 2,
    inherit(Qn, Base),
    Qn), Pn;
    function Qn() {
        this.constructor.super.call(this),
        this.accept = !0;
        var h = this;
        this.idq = function() {
            return 12
        }
        ,
        this.initQuestion = function(t, e) {
            if (!1 === h.save_data || !h.save_data.answer)
                return h.makeQuestion(t);
            var n = JSON.parse(h.save_data.answer);
            0 == n.length ? h.makeQuestion(t) : (h.makeQuestion(t, 1),
            t.find(".findwrong .select-option").each(function(t, e) {
                var a = $(e).data("id")
                  , a = n[a];
                $(e).val(a)
            }))
        }
        ,
        this.makeQuestion = function(c, l) {
            h.tmpHtml = detectJS(h.tmpHtml),
            c.html(h.tmpHtml),
            c.find(".exp").remove(),
            l || c.append("<div  class = 'limit'>(Bạn còn <span>" + Pn + "</span> lựa chọn)</div>");
            var d = !1;
            c.find(".findwrong>.findwrong-choose").each(function(t, e) {
                var a, n = e.innerHTML;
                a = 0 < (n = htmlDecode(n)).indexOf("||") ? n.split("||") : n.split(";");
                for (var i = [], r = 0; r < a.length; r++)
                    i.push(r),
                    a[r] = $.trim(a[r]);
                i = shuffle(i);
                var s = $(e).parent();
                $(e).remove(),
                s.html("<span>" + s.html() + "</span>");
                for (var o = "<span class = 'select-ans'><select class = 'select-option' data-id = '" + t + "'>", r = 0; r < a.length; r++)
                    o += "<option value = '" + i[r] + "'>" + a[i[r]] + "</option>";
                o += "</select></span>",
                l ? ($(s).addClass("under-mark"),
                h.save_data ? (e = JSON.parse(h.save_data.answer),
                2 != l && null == e[t] || $(s).append(o)) : 2 == l && $(s).html(o)) : $(s).one("click", function() {
                    d = !0,
                    Pn = 2,
                    c.find(".limit>span").html(Pn),
                    $(s).addClass("under-mark"),
                    setTimeout(function() {
                        $(s).append(o)
                    }, 900)
                }).on("click", function() {
                    d = !0
                })
            }),
            c.find("p").each(function(t, e) {
                $(e).on("click", function() {
                    d ? d = !1 : (--Pn,
                    c.find(".limit>span").html(Pn),
                    0 == Pn && (c.find(".limit").html("<span>Bạn đã hết quyền trả lời :(</span>").removeClass("limit").addClass("limit-up"),
                    $(e).find(".findwrong").unbind("click")))
                })
            }),
            drawingCanvas(c)
        }
        ,
        this.makeQuestionH = function(t) {
            p.quizState = 2,
            this.makeQuestion(t, 1);
            var n = JSON.parse(h.save_data.answer);
            t.find(".findwrong .select-option").each(function(t, e) {
                var a = $(e).data("id")
                  , a = n[a];
                $(e).val(a),
                0 != a ? $(e).addClass("owrong") : $(e).addClass("ocorrect"),
                $(e).prop("disabled", !0)
            })
        }
        ,
        this.makeCorrectAns = function(t) {
            p.quizState = 3,
            this.makeQuestion(t, 2),
            t.find(".findwrong .select-option").each(function(t, e) {
                $(e).val(0),
                $(e).prop("disabled", !0)
            })
        }
        ,
        this.check = function(t) {
            var i = []
              , r = 1
              , s = 0
              , e = t.find(".findwrong").length;
            return t.find(".findwrong .select-option").each(function(t, e) {
                var a = $(e).data("id")
                  , n = $(e).val();
                0 != n ? (r = 0,
                this.viewans && $(e).addClass("owrong")) : this.viewans && $(e).addClass("ocorrect"),
                i[a] = n,
                s += 1
            }),
            0 == s ? r = 2 : s < e && (r = 0),
            h.save_data = {
                answer: JSON.stringify(i),
                params: JSON.stringify(h.params),
                result: r
            },
            r
        }
    }
    var TrueFalse = (inherit(Fo, Base),
    Fo);
    function Fo() {
        this.constructor.super.call(this),
        this.correct = [],
        this.hasNotGiven = !1,
        this.accept = !0;
        var c = this;
        this.idq = function() {
            return 13
        }
        ,
        this.initQuestion = function(t, e) {
            if (console.log("SAcve", c.save_data),
            !1 === c.save_data || !c.save_data.answer)
                return c.makeQuestion(t);
            c.makeQuestion(t);
            var n = JSON.parse(c.save_data.answer);
            console.log(n),
            t.find(".tf-row").each(function(t, e) {
                var a = $(e).data("id");
                $(e).find("[data-value='" + n[a] + "']").addClass("qchecked")
            })
        }
        ,
        this.makeQuestion = function(t, e) {
            c.tmpHtml = detectJS(c.tmpHtml),
            c.correct = [],
            t.html(c.tmpHtml);
            t.get(0).offsetWidth;
            t.find(".exp").remove(),
            t.find("span.math-q").removeAttr("style");
            var a = t.find(".true-false")
              , n = []
              , i = ""
              , r = [];
            a.find("li").each(function(t, e) {
                n.push(e.innerHTML),
                r.push(t),
                $(e).hasClass("correctAnswer") ? c.correct[t] = 1 : $(e).hasClass("notGivenAnswer") ? (c.correct[t] = 2,
                c.hasNotGiven = !0) : c.correct[t] = 0
            }),
            c.save_data && void 0 !== c.save_data.params && null !== c.save_data.params ? c.params = JSON.parse(c.save_data.params) : void 0 === c.params.order && (c.params.order = shuffle(r));
            var a = ""
              , s = "";
            c.hasNotGiven && (a = "<th>" + q_lang.notgiven + "</th>",
            s = "<td><div class = 'qselect' data-value = '2'><span class='qiradio'></span></div></td>"),
            i = "<table class='table table-hover'><thead><tr><th></th><th>" + q_lang.correct + "</th><th>" + q_lang.wrong + "</th>" + a + "</tr></thead><tbody>";
            for (var o = 0; o < n.length; o++)
                i += "<tr class = 'tf-row' data-id = '" + c.params.order[o] + "'><td><span class = 'clause'>" + n[c.params.order[o]] + "</span></td><td><div class = 'qselect' data-value = '1'><span class='qiradio'></span></div></td><td><div class = 'qselect' data-value = '0'><span class='qiradio'></span></div></td>" + s + "</tr>";
            i += "</tbody></table>",
            t.find(".true-false").replaceWith("<div class = 'true-false'>" + i + "</div>"),
            void 0 === e && t.find(".qselect").each(function(t, e) {
                e.onclick = function() {
                    $(this).parent().parent().find(".qchecked").removeClass("qchecked"),
                    $(this).addClass("qchecked")
                }
            }),
            drawingCanvas(t)
        }
        ,
        this.makeQuestionH = function(t) {
            var n;
            p.quizState = 2,
            this.makeQuestion(t, !0),
            2 != c.save_data.result && "" != c.save_data.answer && (n = JSON.parse(c.save_data.answer),
            t.find(".tf-row").each(function(t, e) {
                var a = $(e).data("id")
                  , e = $(e).find("[data-value='" + n[a] + "']").addClass("qchecked");
                n[a] != c.correct[a] ? (right = 0,
                e.addClass("xwrong")) : e.addClass("xcorrect")
            }))
        }
        ,
        this.makeCorrectAns = function(t) {
            p.quizState = 3,
            this.makeQuestion(t),
            t.find(".tf-row").each(function(t, e) {
                var a = $(e).data("id");
                $(e).find("[data-value='" + c.correct[a] + "']").addClass("qcorrect")
            })
        }
        ,
        this.check = function(t) {
            var i = []
              , r = 1
              , s = [];
            return t.find(".tf-row").each(function(t, e) {
                var a = $(e).data("id")
                  , n = $(e).find(".qchecked")
                  , e = n.data("value");
                (i[a] = e) != c.correct[a] ? (r = 0,
                this.viewans && n.addClass("xwrong"),
                s[t] = 0) : (this.viewans && n.addClass("xcorrect"),
                s[t] = 1)
            }),
            t.find(".qchecked").length < c.correct.length && (r = 2),
            c.save_data = {
                answer: JSON.stringify(i),
                params: JSON.stringify(c.params),
                result: s
            },
            r
        }
    }
    var Theory = (inherit(vp, Base),
    vp);
    function vp() {
        this.constructor.super.call(this),
        this.isTheory = !0;
        var a = this;
        this.idq = function() {
            return 14
        }
        ,
        this.makeQuestion = function(t) {
            a.tmpHtml = detectJS(a.tmpHtml);
            var e = document.createElement("div");
            e.innerHTML = a.tmpHtml,
            $(e).find(".theory>h2").remove(),
            t.html("<div class = 'theorycal'><span class='right'> " + q_lang.summaries + " </span></div>"),
            t.append($(e).html()),
            drawingCanvas(t)
        }
        ,
        this.makeQuestionH = function(t) {
            p.quizState = 2,
            this.makeQuestion(t)
        }
        ,
        this.makeCorrectAns = function(t) {
            p.quizState = 3,
            this.makeQuestion(t)
        }
        ,
        this.check = function(t) {
            return a.save_data = {
                answer: JSON.stringify([]),
                params: JSON.stringify(a.params),
                result: 1
            },
            1
        }
    }
    var FlashCard = (inherit(Ep, Base),
    Ep);
    function Dp(t, e) {
        return setInterval(function() {
            e = e ? 0 : 10,
            t.style.transform = "translateY(" + e + "px)"
        }, 1500)
    }
    function Ep() {
        this.constructor.super.call(this),
        this.isFlashcard = !0;
        var r = this;
        this.idq = function() {
            return 15
        }
        ,
        this.makeQuestion = function(t) {
            r.tmpHtml = detectJS(r.tmpHtml),
            t.html(r.tmpHtml);
            var e = t.find(".flashcard")
              , a = [];
            e.find("li").each(function(t, e) {
                a.push(e.innerHTML)
            });
            e = "<div class = 'cardwrap'><div class='flashcard'><div class='fcard'><div class='card-front'><div class='layer'>" + a[0] + "<div class='corner'></div><div class='corner'></div><div class='corner'></div><div class='corner'></div></div><div class = 'footer'>Click vào hình để lật flashcard</div></div><div class='card-back'><div class='layer'><div>" + a[1] + "</div></div></div></div></div></div>";
            t.find(".flashcard").replaceWith(e);
            var n = t.find(".fcard").get(0)
              , i = Dp(n, 0);
            $(n).on("click", function() {
                $(this).hasClass("flipped") ? ($(this).removeClass("flipped"),
                i = Dp(n, 0)) : ($(this).addClass("flipped"),
                clearInterval(i),
                n.style.transform = "")
            }),
            drawingCanvas(t)
        }
        ,
        this.makeQuestionH = function(t) {
            p.quizState = 2,
            this.makeQuestion(t)
        }
        ,
        this.makeCorrectAns = function(t) {
            p.quizState = 3,
            this.makeQuestion(t)
        }
        ,
        this.check = function(t) {
            return r.save_data = {
                answer: JSON.stringify([]),
                params: JSON.stringify(r.params),
                result: 1
            },
            1
        }
    }
    var Advance = function() {
        var idq = 16
          , cls = function() {
            this.constructor.super.call(this),
            this.reCheck = !1,
            this.p = {};
            var that = this;
            this.idq = function() {
                return idq
            }
            ,
            this.makeQuestion = function(t) {
                that.reCheck = p.check,
                that.tmpHtml = detectJS(that.tmpHtml),
                t.html(that.tmpHtml),
                t.find(".exp").remove(),
                Zone = t.find(".advance"),
                p.makeQuestion(),
                katexRenderer(t),
                drawingCanvas(t)
            }
            ,
            this.makeQuestionH = function($con) {
                p.quizState = 2,
                $con.html(that.tmpHtml),
                p.tmpHtml = that.tmpHtml,
                Zone = $con.find(".advance"),
                p.answer = isJson(that.save_data.answer) ? eval(that.save_data.answer) : that.save_data.answer,
                p.makeHistory(),
                katexRenderer($con),
                drawingCanvas($con)
            }
            ,
            this.makeCorrectAns = function(t) {
                p.quizState = 3,
                t.html(that.tmpHtml),
                p.tmpHtml = that.tmpHtml,
                Zone = t.find(".advance"),
                Cont = t,
                p.makeCorrect(),
                katexRenderer($("body")),
                drawingCanvas(t)
            }
            ,
            this.check = function(t) {
                (Zone = t).requires = that.requires,
                p = that.p;
                t = that.reCheck();
                return (t.answer instanceof Array || t.answer instanceof Object) && (t.answer = JSON.stringify(t.answer)),
                that.save_data = {
                    answer: t.answer,
                    params: JSON.stringify(that.params),
                    result: t.result
                },
                t.result
            }
            ,
            this.getExp = function(t) {
                "" != that.exp && null != that.exp ? t.html(that.exp) : "function" == typeof p.makeExp ? (Zone = t,
                p.makeExp(),
                katexRenderer(t),
                drawingCanvas(t)) : console.log("Not undefined Exp of this question")
            }
        };
        return inherit(cls, Base),
        cls
    }()
      , DragMore = (inherit($p, Base),
    $p);
    function $p() {
        this.constructor.super.call(this),
        this.correct = [],
        this.selects = [],
        this.style = "",
        this.accept = !0,
        this.numberQuiz = 1;
        var d = this;
        this.idq = function() {
            return 17
        }
        ,
        this.getNumberQuiz = function() {
            return this.numberQuiz
        }
        ,
        this.getMany = function() {
            var t = document.createElement("div");
            t.innerHTML = d.tmpHtml,
            isMultiQuiz(t.innerText) ? d.numberQuiz = $(t).find(".dragmore").length : d.numberQuiz = 1
        }
        ,
        this.initQuestion = function(t, e) {
            if (!1 === d.save_data || !d.save_data.answer)
                return d.makeQuestion(t);
            d.makeQuestion(t);
            var a = JSON.parse(d.save_data.answer);
            t.find(".dragmore").each(function(t, e) {
                null != a[t] && (t = "<span class = 'drag-select'>" + (t = "<span data-id = '" + a[t] + "'>" + d.selects[a[t]] + "</span>") + "</span>",
                e.innerHTML = t)
            }),
            t.find(".item-drag .drag-select").each(function(t, e) {
                -1 < a.indexOf($(e).find("span").attr("data-id")) && $(e).remove()
            })
        }
        ,
        this.makeQuestion = function(e, t) {
            d.tmpHtml = detectJS(d.tmpHtml),
            d.selects = [],
            d.correct = [],
            e.html(d.tmpHtml),
            e.find(".exp").remove();
            var a = [];
            e.find(".dragmore").each(function(t, e) {
                $(e).attr("ondrop", "drop(event)").attr("ondragover", "allowDrop(event)").attr("ondragleave", "dragLeave(event)").attr("canreturn", "false");
                var a = e.clientWidth
                  , n = e.clientHeight
                  , i = e.innerHTML
                  , i = (i = $.trim(i)).split("||");
                d.correct.push(d.selects.length),
                d.selects = d.selects.concat(i),
                0 == n && (n = 34),
                i.length,
                e.innerHTML = "",
                $(e).css({
                    width: "auto",
                    height: n,
                    "line-height": n + "px",
                    padding: 0
                }),
                $(e).parent().is("p") && $(e).parent().css({
                    display: "block"
                })
            });
            for (var n = 0; n < d.selects.length; n++)
                a.push(n);
            d.style = "";
            var i = e.find(".dragmore")[0].closest("p");
            $(i).find("span").each(function(t, e) {
                e = $(e).attr("style");
                void 0 !== e && (d.style += e)
            }),
            "" != d.style && (d.style = " style = '" + d.style + "' ");
            var r = "";
            d.save_data && void 0 !== d.save_data.params && null !== d.save_data.params ? d.params = JSON.parse(d.save_data.params) : void 0 === d.params.order && (d.params.order = shuffle(a));
            if (r += "<div><div class = 'item-drag' ondrop='drop(event)' ondragover='allowDrop(event)' canreturn = 'true'>",
            2 != t && 1 != t)
                for (n = 0; n < d.selects.length; n++)
                    r += "<span id = 'dx" + p.now + random(1, 1e3) + "' class = 'drag-select' draggable='true' ondragstart='drag(event)'><span data-id = '" + d.params.order[n] + "' >" + d.selects[d.params.order[n]] + "</span></span>";
            if (r += "</div><p style = 'font-size: 14px;'><i>(Kéo thả hoặc click vào để điền)</i></p></div>",
            e.append(r),
            !t) {
                this.isTest || fixedUntilPoint(e.find(".item-drag"));
                var s, o = e.find(".item-drag"), c = e.find(".dragmore"), l = [];
                if (e.find(".dragmore").each(function(t, e) {
                    (s = $(e).attr("data-id")) && (l[parseInt(s)] = c[t])
                }),
                c.length === l.length)
                    for (n = 0; n < c.length; n++)
                        c[n] = l[n];
                c.first().addClass("selectpoint"),
                c.on("click", function(t, e) {
                    c.removeClass("selectpoint"),
                    $(this).addClass("selectpoint"),
                    0 < $(this).find(".drag-select").length && inputText(o, $(this).find(".drag-select"), !0)
                }),
                e.find(".item-drag>.drag-select").on("click", function() {
                    var t, a;
                    $(this).parent().hasClass("dragmore") || 0 < (t = e.find(".selectpoint")).length && (inputText(t, this),
                    a = !1,
                    setTimeout(function() {
                        for (var t = 0; t < c.length; t++) {
                            var e = c[t];
                            if ($(e).hasClass("selectpoint") && ($(e).removeClass("selectpoint"),
                            a = !0),
                            a)
                                if (0 == (e = t === c.length - 1 ? $(c[0]) : $(c[t + 1])).find("span").length) {
                                    e.addClass("selectpoint");
                                    break
                                }
                        }
                    }, 700))
                }),
                e.find(".guide-toggle").on("click", function() {
                    e.find(".guide-more").toggle()
                })
            }
            drawingCanvas(e)
        }
        ,
        this.makeQuestionH = function(t) {
            var n;
            p.quizState = 2,
            this.makeQuestion(t, 1),
            "" != d.save_data.answer && (n = JSON.parse(d.save_data.answer),
            t.find(".dragmore").each(function(t, e) {
                var a;
                null != n[t] && (a = "<span class = 'drag-select'>" + (a = "<span data-id = '" + n[t] + "'>" + d.selects[n[t]] + "</span>") + "</span>",
                e.innerHTML = a,
                n[t] != d.correct[t] ? $(e).addClass("xwrong") : $(e).addClass("xcorrect"))
            }))
        }
        ,
        this.makeCorrectAns = function(t) {
            p.quizState = 3,
            this.makeQuestion(t, 2),
            t.find(".dragmore").each(function(t, e) {
                t = "<span class = 'drag-select'>" + (t = "<span>" + d.selects[d.correct[t]] + "</span>") + "</span>";
                e.innerHTML = t
            })
        }
        ,
        this.check = function(t) {
            var a = []
              , n = 0
              , i = 1
              , r = [];
            return t.find(".dragmore").each(function(t, e) {
                $e = $(e).find(".drag-select").children();
                e = $e.attr("data-id");
                a.push(e),
                null == e && 0 == n && (n = 2),
                e != d.correct[t] ? (this.viewans && $e.addClass("xwrong"),
                i = 0,
                r[t] = 0) : (this.viewans && $e.addClass("xcorrect"),
                r[t] = 1)
            }),
            2 == n && (i = 2),
            d.save_data = {
                params: JSON.stringify(d.params),
                answer: JSON.stringify(a),
                result: r
            },
            i
        }
    }
    var Paragraph = (inherit(dr, Base),
    dr);
    function dr() {
        this.constructor.super.call(this),
        this.correct = [],
        this.style = "",
        this.isSelfCheck = !0,
        this.cke = !1,
        this.accept = !0;
        var i = this;
        this.idq = function() {
            return 18
        }
        ,
        this.initQuestion = function(t, e) {
            if (!1 === i.save_data || !i.save_data.answer)
                return i.makeQuestion(t);
            this.makeQuestion(t, "init")
        }
        ,
        this.makeQuestion = function(t, e) {
            var a;
            i.selects = [],
            i.correct = [],
            t.html("<div class = 'theorycal'><span class='right'> " + q_lang.self_check + " </span></div>" + i.tmpHtml),
            i.exp = void 0,
            t.find(".exp .exp-in").each(function(t, e) {
                e = $(e).html();
                i.correct.push(e)
            }),
            0 === i.correct.length && t.append("<h3 class = 'bttl-cke'>Bài làm:</h3><div class = 'exp'></div>"),
            i.correct.length <= 1 && (i.cke = !0),
            "review" === e ? (a = i.save_data.answer instanceof Array || i.save_data.answer instanceof Object ? i.save_data.answer : JSON.parse(i.save_data.answer),
            t.find(".exp").each(function(t, e) {
                $(e).html("<div class = 'typing-para'>" + a[t] + "</div>")
            }),
            katexRenderer(t)) : "init" === e ? (a = i.save_data.answer instanceof Array || i.save_data.answer instanceof Object ? i.save_data.answer : JSON.parse(i.save_data.answer),
            t.find(".exp").each(function(t, e) {
                $(e).html("<textarea class = 'typing-para text-para' rows = '2' placeholder = '" + q_lang.write_answer + "'>" + a[t] + "</textarea>")
            }),
            i.cke && (console.log("CKE"),
            CKEDITOR.env.isCompatible = !0,
            t.find("textarea").ckeditor({
                toolbar: "Student",
                allowedContent: !0,
                imgurClientId: "ae5cff9f2dddc66",
                cdnUpload: "https://cdn4.olm.vn/olmupload.php",
                folderImg: "img_student",
                folderMp3: "audio_student"
            }),
            i.cke = !1)) : (t.find(".exp").html("<textarea class = 'typing-para text-para' rows = '2' placeholder = '" + q_lang.write_answer + "'></textarea>"),
            t.find(".typing-para").on("input", function() {
                this.style.height = "auto",
                this.style.height = this.scrollHeight + "px"
            })),
            i.cke && t.find("textarea").on("click", function() {
                CKEDITOR.env.isCompatible = !0,
                t.find("textarea").ckeditor({
                    toolbar: "Student",
                    allowedContent: !0,
                    imgurClientId: "ae5cff9f2dddc66",
                    cdnUpload: "https://cdn4.olm.vn/olmupload.php",
                    folderImg: "img_student",
                    folderMp3: "audio_student"
                })
            }),
            drawingCanvas(t)
        }
        ,
        this.getHtmlQuestion = function(t) {
            var n = i.p.innerContent
              , e = n.match(/\$(.*?)\$/g);
            null != e && $.each(e, function(t, e) {
                var a = e.replace(/\$/g, "").trim();
                try {
                    n = n.replace(e, "$" + a.replace(/(<([^>]+)>)/gi, "") + "$")
                } catch (t) {
                    console.error("Lỗi Latex rendering: " + t.message)
                }
            });
            e = document.createElement("div");
            return e.innerHTML = n.replace(/(\r\n|\n|\r|<p>(&nbsp;)+<\/p>|<p>\s+<\/p>|<o:\w><\/o:\w>)/gm, "").replace(/<o:p>/gm, "<span>").replace(/<\/o:p>/gm, "</span>"),
            $(e).find("p").removeAttr("class").removeAttr("style"),
            $(e).find(".exp").remove(),
            $(e).find(".quiz-list").remove(),
            $(e).find(".language-javascript").remove(),
            e.innerHTML = "<div data-attr = 'Question'>" + e.innerHTML + "</div>",
            e.innerHTML
        }
        ,
        this.makeQuestionH = function(t) {
            p.quizState = 2,
            this.makeQuestion(t, "review")
        }
        ,
        this.makeCorrectAns = function(t) {
            p.quizState = 3,
            t.html("<p class = 'suggested-answer'><i>(" + q_lang.suggested_answer + ")</i></p>"),
            t.append(i.tmpHtml),
            0 < i.correct.length ? t.find(".exp").each(function(t, e) {
                $(e).html("<div class = 'typing-para text-para' style = 'padding-top: 7px;line-height: 20px;'>" + i.correct[t] + "</div>")
            }) : t.append("<p style = 'color:red;'>Câu hỏi này chưa có đáp án!</p>"),
            drawingCanvas(t)
        }
        ,
        this.check = function(t) {
            var a = [];
            return t.find(".typing-para").each(function(t, e) {
                a.push($(e).val())
            }),
            result = 4,
            i.save_data = {
                params: JSON.stringify(i.params),
                answer: a,
                result: result
            },
            result
        }
    }
    var Recorder = (inherit(Jr, Base),
    Jr);
    function Jr() {
        this.constructor.super.call(this),
        this.correct = [],
        this.p = {};
        var s = this;
        this.idq = function() {
            return 19
        }
        ,
        this.initQuestion = function(t, e) {
            if (!1 === s.save_data || !s.save_data.answer)
                return s.makeQuestion(t);
            this.makeQuestion(t, 2)
        }
        ,
        this.makeQuestion = function(t, e) {
            var a;
            t.html(s.tmpHtml),
            t.find("span.recorder").each(function(t, e) {
                s.correct[t] = $(e).html()
            }),
            2 === e ? (a = JSON.parse(s.save_data.answer),
            t.find(".recorder").each(function(t, e) {
                $(e).html("<audio class = 'new' controls src='" + a[t] + "'></audio>")
            }),
            drawingCanvas(t)) : 3 == e ? (t.find(".recorder").each(function(t, e) {
                $(e).html("<audio class = 'new' controls src='" + speechUrl + s.correct[t] + "'></audio>")
            }),
            drawingCanvas(t)) : (drawingCanvas(t),
            AU.init(".recorder", s.correct))
        }
        ,
        this.makeQuestionH = function(t) {
            p.quizState = 2,
            this.makeQuestion(t, p.quizState)
        }
        ,
        this.makeCorrectAns = function(t) {
            p.quizState = 3,
            this.makeQuestion(t, p.quizState)
        }
        ,
        this.check = function(t) {
            for (var e = AU.getResult(), a = [], n = 0; n < e.length; n++)
                e[n] && e[n].audio ? a[n] = e[n].audio : a[n] = "";
            var i = 1;
            if (p.noCheck || p.selfCheck)
                i = 4;
            else {
                for (var r = !0, n = 0; n < s.correct.length; n++) {
                    if (!e[n]) {
                        r = !1;
                        break
                    }
                    e[n].text.toLowerCase().replace(/\s/g, "") != s.correct[n].toLowerCase().replace(/\s/g, "") && (i = 0)
                }
                r || (i = 2)
            }
            return s.save_data = {
                answer: JSON.stringify(a),
                params: JSON.stringify(s.params),
                result: i
            },
            i
        }
    }
    var Advance2 = function() {
        var idq = 20
          , cls = function() {
            this.constructor.super.call(this),
            this.reCheck = !1,
            this.p = {};
            var that = this;
            this.idq = function() {
                return idq
            }
            ,
            this.makeQuestion = function(t) {
                t.html(that.tmpHtml),
                t.find(".exp").remove(),
                p.makeQuestion(t.find(".advance2")),
                katexRenderer(t),
                drawingCanvas(t)
            }
            ,
            this.makeQuestionH = function($con) {
                p.quizState = 2,
                $con.html(that.tmpHtml),
                p.tmpHtml = that.tmpHtml,
                p.answer = isJson(that.save_data.answer) ? eval(that.save_data.answer) : that.save_data.answer,
                p.makeHistory($con.find(".advance2")),
                katexRenderer($con),
                drawingCanvas($con)
            }
            ,
            this.makeCorrectAns = function(t) {
                p.quizState = 3,
                t.html(that.tmpHtml),
                p.tmpHtml = that.tmpHtml,
                p.makeCorrect(t),
                katexRenderer(t),
                drawingCanvas(t)
            }
            ,
            this.check = function(t) {
                t = (p = that.p).check(t);
                return (t.answer instanceof Array || t.answer instanceof Object) && (t.answer = JSON.stringify(t.answer)),
                that.save_data = {
                    answer: t.answer,
                    params: JSON.stringify(that.params),
                    result: t.result
                },
                t.result
            }
            ,
            this.getExp = function(t) {
                "" != that.exp && null != that.exp ? t.html(that.exp) : "function" == typeof p.makeExp ? (p.makeExp(t),
                katexRenderer(t),
                drawingCanvas(t)) : console.log("Not undefined Exp of this question")
            }
        };
        return inherit(cls, Base),
        cls
    }()
      , QuizList = (inherit(ls, Base),
    ls);
    function ls() {
        this.constructor.super.call(this),
        this.correct = [],
        this.correctSign = [],
        this.tabStop = 1,
        this.quizl = [],
        this.quizl_order = [],
        this.runAll = [],
        this.quocte = "",
        this.fixed = !1,
        this.longquocte = !1,
        this.accept = !0,
        this.multi = !0;
        var d = this;
        this.idq = function() {
            return 21
        }
        ,
        this.getNumberQuiz = function() {
            return this.quizl.length
        }
        ,
        this.getMany = function() {
            /\[FIX\]|\[FIXED\]/gim.test(d.tmpHtml) && (d.fixed = !0,
            d.tmpHtml = d.tmpHtml.replace(/\[FIX\]|\[FIXED\]/gim, "")),
            d.tmpHtml = d.tmpHtml.replace(/<p[^>]*>(<\w+>|<o:p>)*\s*\[HR\]\s*(<\/\w+>|<\/o:p>)*<\/p>/gim, "||");
            var t = d.tmpHtml.split("||");
            1 < t.length && (d.tmpHtml = t[1],
            d.quocte = t[0]);
            t = document.createElement("div");
            if (t.innerHTML = d.quocte,
            450 < t.innerText.length && (d.longquocte = !0),
            t.innerHTML = d.tmpHtml,
            ($(t).find(".exp").length === $(t).find(".quiz-list").length && 0 < $(t).find(".exp").length ? $(t).find(".exp") : $(t).find(".quiz-list")).after("||"),
            d.quizl = $(t).html().split("||"),
            d.quizl.pop(),
            d.save_data) {
                var e, a = !!d.save_data.answer && JSON.parse(d.save_data.answer), t = JSON.parse(d.save_data.params);
                void 0 !== t.order ? (e = t.prs,
                d.quizl_order = t.order) : (e = t,
                d.quizl_order = JSON.parse(e.pop()))
            } else {
                for (var n = [], i = 0; i < d.quizl.length; i++)
                    n[i] = i;
                d.fixed ? d.quizl_order = n : d.quizl_order = shuffle(n)
            }
            for (var r, s = [], i = 0; i < d.quizl_order.length; i++)
                r = d.quizl[d.quizl_order[i]],
                (r = d.save_data && e ? detectQuestion(r, {
                    answer: a ? a[i] : "[]",
                    params: e ? e[i] : []
                }) : detectQuestion(r)).isTest = d.isTest,
                r.viewans = d.viewans,
                r.isEditable = d.isEditable,
                s.push(r);
            return s
        }
        ,
        this.initQuestion = function(t, a) {
            if (!1 === d.save_data || !d.save_data.answer)
                return this.makeQuestion(t, a.abcdSign, a.isAnswer);
            var e;
            d.runAll = this.getMany(),
            t.html(d.quocte);
            for (var n = 0; n < d.runAll.length; n++)
                e = d.start + n,
                t.append("<div class = 'title-itm'>" + d.name_start + " " + e + ": <span class = 'ans_choose' id = 'itm_ch" + e + "'></span></div><div class = 'quiz-itm' data-stt  = '" + e + "'></div>");
            t.find(".quiz-itm").each(function(t, e) {
                d.runAll[t].initQuestion($(e), a),
                "" !== d.save_data.labels[t] && $("#itm_ch" + (t + d.start)).html(d.save_data.labels[t])
            }),
            t.find(".qselect").on("click", function() {
                t.find(".quiz-itm").removeClass("focus"),
                $(this).closest(".quiz-itm").addClass("focus")
            })
        }
        ,
        this.makeQuestion = function(t, a, n) {
            d.runAll = this.getMany();
            var i, e, r = [];
            t.html(d.quocte);
            for (var s = "", o = 0; o < d.runAll.length; o++)
                e = d.start + o,
                s += "<div class = 'title-itm'>" + d.name_start + " " + e + ": <span class = 'ans_choose' id = 'itm_ch" + e + "'></span></div><div class = 'quiz-itm' data-stt  = '" + e + "'></div>";
            t.append("<div class = 'quiz-many'>" + s + "</div>"),
            t.find(".quiz-itm").each(function(t, e) {
                (i = d.runAll[t]).makeQuestion($(e), a, n),
                r[t] = JSON.stringify(i.getParams()),
                d.correctSign.push(i.getCorrectSign().join(","))
            }),
            d.params = {
                prs: r,
                order: d.quizl_order
            },
            d.save_data.params = JSON.stringify(d.params),
            d.longquocte && t.find(".quiz-many").css({
                "max-height": "22rem",
                overflow: "scroll"
            }),
            t.find(".qselect").on("click", function() {
                t.find(".quiz-itm").removeClass("focus"),
                $(this).closest(".quiz-itm").addClass("focus")
            })
        }
        ,
        this.getHtmlQuestion = function(t) {
            for (var e, a, n = d.quocte, i = 0; i < d.runAll.length; i++)
                e = d.runAll[i],
                a = d.start + i,
                e = e.getHtmlQuestion(t),
                /<p>/.test(e) ? n += e.replace(/<p>/, '<p><strong><span data-attr = "blueColor">' + d.name_start + " " + a + ":</span></strong>&nbsp;") : (n += '<p><strong><span data-attr = "blueColor">' + d.name_start + " " + a + ":</span></strong>&nbsp;</p>",
                n += e);
            return n
        }
        ,
        this.makeQuestionH = function(t, a, n) {
            var i, e;
            p.quizState = 2,
            d.runAll = this.getMany(),
            t.html(d.quocte);
            for (var r = "", s = 0; s < d.runAll.length; s++)
                e = d.start + s,
                r += "<div class = 'title-itm'>" + d.name_start + " " + e + ":</div><div class = 'quiz-itm'></div>";
            t.append("<div class = 'quiz-many'>" + r + "</div>"),
            t.find(".quiz-itm").each(function(t, e) {
                (i = d.runAll[t]).makeQuestionH($(e), a, n),
                d.correctSign.push(i.getCorrectSign().join(","))
            }),
            d.longquocte && t.find(".quiz-many").css({
                "max-height": "22rem",
                overflow: "scroll"
            })
        }
        ,
        this.makeCorrectAns = function(t) {
            var e;
            p.quizState = 3,
            d.runAll = this.getMany(),
            t.html(d.quocte);
            for (var a = 0; a < d.runAll.length; a++)
                e = d.start + a,
                t.append("<div class = 'title-itm'>" + d.name_start + " " + e + ":</div><div class = 'quiz-itm'></div>");
            t.find(".quiz-itm").each(function(t, e) {
                d.runAll[t].makeCorrectAns($(e))
            })
        }
        ,
        this.check = function(t) {
            var a, n = [], i = [], r = [], s = [], e = 1, o = 1, c = 1;
            t.find(".quiz-itm").each(function(t, e) {
                a = d.runAll[t],
                a.check($(e)),
                a = a.getSaveData(),
                n[t] = a.answer,
                i[t] = a.label.join("|"),
                s[t] = a.params,
                r[t] = a.result,
                a.result > o && (o = a.result),
                a.result < c && (c = a.result)
            }),
            2 == o ? e = 2 : 0 == c && (e = 0);
            var l = ""
              , t = t.find(".quiz-itm.focus").data("stt");
            return t && (l = [t + i[t - d.start]],
            $("#itm_ch" + t).html(i[t - d.start])),
            d.save_data = {
                answer: JSON.stringify(n),
                label: l,
                labels: i,
                params: JSON.stringify({
                    prs: s,
                    order: d.quizl_order
                }),
                result: r
            },
            e
        }
        ,
        this.getCorrectSign = function() {
            return this.correctSign
        }
    }
    </script>
    
    <!-- Place encrypted content here -->
    <script>
        var insert_key_here;
        var fetch_key = fetch("https://olm.vn/?g=math.q_quiz_enc&id_skill=" + localStorage.getItem("id_skill"));
        fetch_key.then(response => response.json().then(data => insert_key_here = data));
        
        N = {
                _keyStr: "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",
                decode: function(t) {
                    var e, i, n, a, o, r = "", c = 0;
                    for (t = t.replace(/[^A-Za-z0-9+/=]/g, ""); c < t.length; )
                        e = this._keyStr.indexOf(t.charAt(c++)) << 2 | (n = this._keyStr.indexOf(t.charAt(c++))) >> 4,
                        i = (15 & n) << 4 | (a = this._keyStr.indexOf(t.charAt(c++))) >> 2,
                        n = (3 & a) << 6 | (o = this._keyStr.indexOf(t.charAt(c++))),
                        r += String.fromCharCode(e),
                        64 != a && (r += String.fromCharCode(i)),
                        64 != o && (r += String.fromCharCode(n));
                    return r = N._utf8_decode(r)
                },
                _utf8_decode: function(t) {
                    for (var e = "", i = 0, n = c1 = c2 = 0; i < t.length; )
                        (n = t.charCodeAt(i)) < 128 ? (e += String.fromCharCode(n),
                        i++) : 191 < n && n < 224 ? (c2 = t.charCodeAt(i + 1),
                        e += String.fromCharCode((31 & n) << 6 | 63 & c2),
                        i += 2) : (c2 = t.charCodeAt(i + 1),
                        c3 = t.charCodeAt(i + 2),
                        e += String.fromCharCode((15 & n) << 12 | (63 & c2) << 6 | 63 & c3),
                        i += 3);
                    return e
                }
            }
        
        function searchquestion() {
            var counter = 0;
            
            for (var i_var = 0; i_var < insert_key_here.length; i_var++) {
                var this_question = N.decode(insert_key_here[i_var]['content']);
                if (this_question.search(document.getElementById("cauhoi").value) != -1) {
                    counter += 1;
                    localStorage.setItem("n"+i_var.toString(), this_question);
                }
            }
            
            if (counter == 0) {
                counter = 1;
                localStorage.setItem("n0", '<h1><b>Ảo thật đấy, chả có câu nào như thế cả!</b></h1><p>Hãy:<br>+ Nhập có dấu<br>+ Đừng nhập số, chỉ nhập phần chữ<br>+ Giảm bớt chữ đi thử xem<br>+ Không được thì bấm xem tất cả ý.</p><br><button onclick="showall()">Hiển thị tất (đau đầu đấy :))</button>');
            }
            
            localStorage.setItem("counter", counter);
            location.reload();
        }
        
        function showall() {
            localStorage.setItem("counter", insert_key_here.length);
            for (var i_var = 0; i_var < insert_key_here.length; i_var++) {
                localStorage.setItem("n"+i_var.toString(), N.decode(insert_key_here[i_var]['content']));
            }
            location.reload();
        }
        
        function calculate_answer(question_no) {
            // Re-random until the user find the same question!
            
            var this_question = N.decode(insert_key_here[question_no]['content']);
            
            localStorage.setItem("counter", 1); // Print the question on next reload
            
            let temp_div = document.createElement("div"); // Create temporarily tag
            temp_div.innerHTML = this_question;
            
            // Find the question and its variables
            question_lines = temp_div.getElementsByTagName("p");
            
            // Execute the script
            
            var my_script = temp_div.getElementsByClassName("language-javascript")[0].innerText;
            
            var script_array = my_script.split('\n');
            
            // Execute until it matches the value
            for (var j1 = 0; j1 < question_lines.length; j1++) {
                var matches = question_lines[j1].innerText.match(/(?<=\@)(.*?)(?=\@)/g); // RegEx for finding string between '@@' like '@p.ngay1@'
                
                if (!matches)
                    continue;
                
                try {
                    for (var j2 = 0; j2 < matches.length; j2+=2) {
                        for (var j3 = 0; j3 < script_array.length; j3++) {
                            if (script_array[j3].indexOf(matches[j2]) != -1 && script_array[j3].indexOf('random') != -1) {
                                // Random number
                                script_array[j3] = matches[j2] + ' = ' + document.getElementById(matches[j2]).value;
                            } else if (script_array[j3].indexOf(matches[j2]) != -1 && script_array[j3].indexOf('randomArray') != -1) {
                                this_question = "Chưa giải được cái này :("
                            }
                        }
                    }
                } catch (err) {
                    console.log(err);
                }
            }
            
            my_script = script_array.join('\n');
            
            eval(my_script); // Execute it
            
            // Find regex matches to replace between @@
            var matches = this_question.match(/(?<=\@)(.*?)(?=\@)/g); // RegEx for finding string between '@@' like '@p.ngay1@'
            
            for (var j2 = 0; j2 < matches.length; j2++) {
                try {
                    var result = eval(matches[j2]);
                    this_question = this_question.replaceAll("@" + matches[j2] + "@", result.toString());
                }
                catch (err) {
                    console.log(err);
                    console.log(matches[j2]);
                    //console.log(eval(matches[j2]))
                }
            }
            
            // Remove $$
            var matches = this_question.match(/(?<=\$)(.*?)(?=\$)/g); // RegEx for finding string between '$$' like '$x=1$', used in old LaTeX codes
            
            if (matches) {
                for (var j2 = 0; j2 < matches.length; j2++) {
                    try {
                        this_question = this_question.replaceAll("$" + matches[j2] + "$", matches[j2]);
                    }
                    catch (err) {
                        console.log(err);
                        console.log(matches[j2]);
                        //console.log(eval(matches[j2]))
                    }
                }
            }
            
            localStorage.setItem("n0", this_question); // Print on next reload
            location.reload(); // Reload
        }
        
        function get_vars() {
            // Well we have a randomized question!
            
            var question_no = localStorage.getItem("cal_question");
            
            var this_question = N.decode(insert_key_here[question_no]['content']);
            
            let temp_div = document.createElement("div"); // Create temporarily tag
            temp_div.innerHTML = this_question;
            
            // Find the question and its variables
            question_lines = temp_div.getElementsByTagName("p");
            
            document.write("Nhập biến:");
            
            for (var counter2 = 0; counter2 < question_lines.length; counter2++) {
                // Find regex matches to replace between @@
                
                var matches = question_lines[counter2].innerText.match(/(?<=\@)(.*?)(?=\@)/g); // RegEx for finding string between '@@' like '@p.ngay1@'
                
                localStorage.setItem("matches" + counter2.toString(), matches);
                
                if (!matches)
                    break;
                
                for (var counter3 = 0; counter3 < matches.length; counter3+=2) {
                    document.write('<p>Nhập số liệu cho biến ' + matches[counter3] + '</p><input id="' + matches[counter3] + '"></input>');
                }
                
                document.write('<button onclick="calculate_answer(' + question_no + ')">Tính kết quả</button>')
            }
        }
        
        function set_cal(num) {
            localStorage.setItem("counter", 1);
            localStorage.setItem("calculating", 1);
            localStorage.setItem("cal_question", num);
            
            var this_question = N.decode(insert_key_here[num]['content']);
            
            let temp_div = document.createElement("div"); // Create temporarily tag
            temp_div.innerHTML = this_question;
            
            // Find the question and its variables
            question_lines = temp_div.getElementsByTagName("p");
            
            var large_string = '<b><p>Đây là một câu hỏi động (người ta random đề bài khác nhau) nên hãy nhập số vào:</p></b><br><p>Câu hỏi với biến:</p>';
            
            for (var counter2 = 0; counter2 < question_lines.length; counter2++)
                large_string += question_lines[counter2].innerText;
            
            localStorage.setItem("n0", large_string);
            
            location.reload(); // Reload page
        }
        
        if (!Number(localStorage.getItem("counter"))) {
            // Print prompt
            $("body").empty();
            
            // Print a prompt for searching question
            document.write('<center><h3>Nhập câu hỏi</h3></center>');
            document.write('<center><p><b>Lưu ý là nhập cái phần không có số của câu hỏi, vì số nó có thể khác nhau</b></p></center>');
            document.write('<center><p><b>Hãy nhập có dấu, làm ơn!</b></p></center>');
            document.write('<center><input id="cauhoi" type="search"></input><button onclick="searchquestion()">Tìm</button></center>');
            document.write('<center><button onclick="showall()">Hiển thị tất</button></center>');
        } else {
            // Request to print the question
            var counter = Number(localStorage.getItem("counter"));
            
            document.write('<button onclick="location.reload()">Về trang tìm kiếm</button>')
            
            for (var counter1 = 0; counter1 < counter; counter1++){
                
                var this_question = localStorage.getItem("n"+counter1.toString());
                
                let temp_div = document.createElement("div"); // Create temporarily tag
                temp_div.innerHTML = this_question;
                
                if (temp_div.getElementsByClassName("language-javascript").length && !Number(localStorage.getItem("calculating"))) {
                    document.write('<button onclick="set_cal(' + counter1.toString() + ')">Tính câu này</button>');
                }
                
                if (this_question.includes("||"))
                {
                    document.write("<b>Nếu có kí tự || thì chọn đáp án trước kí tự đó</b>");
                }
                
                document.write(this_question);
                document.write("<hr>"); // Break line!
                
                if (Number(localStorage.getItem("calculating"))) {
                    get_vars();
                }
                
                localStorage.removeItem("n"+counter1.toString());
            }
            
            localStorage.setItem("counter", 0);
            localStorage.setItem("calculating", 0);
            localStorage.setItem("cal_question", 0);
        }
        
        /*
        for (var i_var = 0; i_var < a.length; i_var++) {
            var this_question = N.decode(a[i_var]['content']);
            
            // Execute included Javascript code
            let temp_div = document.createElement("div"); // Create temporarily tag
            temp_div.innerHTML = this_question;
            var jscodes = temp_div.getElementsByClassName("language-javascript");
            
            for (var j1 = 0; j1 < jscodes.length; j1++) {
                eval(jscodes[j1].innerText);
            }
            
            var 
            
            // Find regex matches to replace between @@
            var matches = this_question.match(/(?<=\@)(.*?)(?=\@)/g); // RegEx for finding string between '@@' like '@p.ngay1@'
            
            if (!matches)
                continue;
            
            for (var j2 = 0; j2 < matches.length; j2++) {
                try {
                    var result = eval(matches[j2]);
                    this_question = this_question.replaceAll("@" + matches[j2] + "@", result.toString());
                }
                catch(err) {
                    console.log(err);
                    console.log(matches[j2]);
                    //console.log(eval(matches[j2]))
                }
            }
            
            // Remove $$
            var matches = this_question.match(/(?<=\$)(.*?)(?=\$)/g); // RegEx for finding string between '$$' like '$x=1$', used in old LaTeX codes
            if (!matches)
                continue;
            
            for (var j2 = 0; j2 < matches.length; j2++) {
                try {
                    this_question = this_question.replaceAll("$" + matches[j2] + "$", matches[j2]);
                }
                catch(err) {
                    console.log(err);
                    console.log(matches[j2]);
                    //console.log(eval(matches[j2]))
                }
            }
            
            //document.write(this_question+"<hr>");
        }*/
        
        //$('code').replaceWith(function(){
            //return $("<noscript />", {html: $(this).html()});
        //});
    </script>
    
</head>
<body>
    <script>
        // Add the text
        var x = document.getElementsByClassName("correctAnswer");
        for (var i = 0; i < x.length; i++) {
            x[i].innerHTML += " (đáp án)";
        }
    </script>
</body>
</html>
